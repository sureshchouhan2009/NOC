"use strict";(self.webpackChunketihadrailapp=self.webpackChunketihadrailapp||[]).push([[7728],{18300:function(e,t,n){n.d(t,{L:function(){return u},b:function(){return c}});var i,r,a=n(30168),s=n(66127),o=n(98634),l=n(64201);function c(e){var t=new l.kG;return t.include(s.j,e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add((0,o.H)(i||(i=(0,a.Z)(["void main() {\nvec3 pos = mix(start, end, extrude.x);\nvec4 viewPos = uModelViewMatrix * vec4(pos, 1);\nvec4 projPos = uProjectionMatrix * viewPos;\nvec2 ndcPos = projPos.xy / projPos.w;\nvec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\nvec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\nvec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\nvec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\nndcPos += length(lxy) * projExtrudeDir;\nvec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\nvec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\nvViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;\nvViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;\nvViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\nfloat xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\nndcPos.x += xPaddingPixels * pixelToNDC.x;\nuv = ndcPos * 0.5 + 0.5;\ngl_Position = vec4(ndcPos, 0, 1);\n}"])))),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add((0,o.H)(r||(r=(0,a.Z)(["float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\nvec3 origin = mix(start, end, 0.5);\nvec3 basis = end - origin;\nvec3 posAtOrigin = pos - origin;\nfloat x = dot(normalize(basis), posAtOrigin);\nfloat y = dot(plane.xyz, posAtOrigin);\nfloat dx = max(abs(x) - length(basis), 0.0);\nfloat dy = y;\nfloat dist = length(vec2(dx, dy));\nfloat width = fwidth(y);\nfloat maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\nfloat pixelDist = dist / min(width, maxPixelDistance);\nreturn abs(pixelDist);\n}\nvoid main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nfloat distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\nvec4 color = laserlineProfile(distance);\nfloat alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\ngl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n}"])))),t}var u=Object.freeze({__proto__:null,build:c})},83671:function(e,t,n){n.d(t,{L:function(){return P},b:function(){return y},d:function(){return b}});var i,r,a,s,o,l,c,u,h,d,f=n(30168),p=n(16889),v=n(66127),g=n(74321),m=n(98634),_=n(64201),b=(0,p.Vl)(6);function y(e){var t=new _.kG;return t.extensions.add("GL_OES_standard_derivatives"),t.include(g.k),t.include(v.j,e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add((0,m.H)(i||(i=(0,f.Z)(["float planeDistancePixels(vec4 plane, vec3 pos) {\nfloat dist = dot(plane.xyz, pos) + plane.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"])))),e.pointDistanceEnabled&&t.fragment.code.add((0,m.H)(r||(r=(0,f.Z)(["float sphereDistancePixels(vec4 sphere, vec3 pos) {\nfloat dist = distance(sphere.xyz, pos) - sphere.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"])))),e.intersectsLineEnabled&&t.fragment.code.add((0,m.H)(a||(a=(0,f.Z)(["float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\nfloat dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\nreturn abs(dist) - radius;\n}"])))),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add((0,m.H)(s||(s=(0,f.Z)(["bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\nvec3 dir = end - start;\nfloat t2 = dot(dir, pos - start);\nfloat l2 = dot(dir, dir);\nreturn t2 >= 0.0 && t2 <= l2;\n}"])))),t.fragment.code.add((0,m.H)(o||(o=(0,f.Z)(["void main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nvec4 color = vec4(0, 0, 0, 0);"])))),e.heightManifoldEnabled&&t.fragment.code.add((0,m.H)(l||(l=(0,f.Z)(["{\nfloat heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\nvec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));\ncolor = max(color, heightManifoldColor * heightManifoldAlpha);\n}"])))),e.pointDistanceEnabled&&t.fragment.code.add((0,m.H)(c||(c=(0,f.Z)(["{\nfloat pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\nvec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\nfloat pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\ncolor = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n}"])))),e.lineVerticalPlaneEnabled&&t.fragment.code.add((0,m.H)(u||(u=(0,f.Z)(["{\nif (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\nfloat lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\nvec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\nfloat lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\ncolor = max(color, lineVerticalColor * lineVerticalAlpha);\n}\n}"])))),e.intersectsLineEnabled&&t.fragment.code.add((0,m.H)(h||(h=(0,f.Z)(["{\nif (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\nfloat intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\nvec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\nfloat intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\ncolor = max(color, intersectsLineColor * intersectsLineAlpha);\n}\n}"])))),t.fragment.code.add((0,m.H)(d||(d=(0,f.Z)(["gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n}"])))),t}var P=Object.freeze({__proto__:null,defaultAngleCutoff:b,build:y})},72511:function(e,t,n){n.d(t,{S:function(){return E},b:function(){return w}});var i,r,a,s,o,l,c,u,h,d=n(30168),f=n(43505),p=n(33280),v=n(94951),g=n(21002),m=n(15226),_=n(10763),b=n(116),y=n(98634),P=n(64201);function w(e){var t=new P.kG;return t.include(v.w,{linearDepth:!1}),t.include(f.A,{}),t.include(p.p2,e),t.fragment.include(b.Y),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add((0,y.H)(i||(i=(0,d.Z)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&t.vertex.code.add((0,y.H)(r||(r=(0,d.Z)(["vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;"])))),t.vertex.code.add((0,y.H)(a||(a=(0,d.Z)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),e.multipassTerrainEnabled&&(t.fragment.include(g.S),t.include(m.l,e)),t.fragment.code.add((0,y.H)(s||(s=(0,d.Z)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),e.shadingEnabled?t.fragment.code.add((0,y.H)(o||(o=(0,d.Z)(["vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(color, shadedColor, shadingFactor);"])))):t.fragment.code.add((0,y.H)(l||(l=(0,d.Z)(["vec4 finalColor = color;"])))),t.fragment.code.add((0,y.H)(c||(c=(0,d.Z)(["\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),y.H.float(_.bf),7===e.output?(0,y.H)(u||(u=(0,d.Z)(["gl_FragColor = vec4(finalColor.a);"]))):"",0===e.output?(0,y.H)(h||(h=(0,d.Z)(["gl_FragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"")),t}var E=Object.freeze({__proto__:null,build:w})},35284:function(e,t,n){n.d(t,{Z:function(){return M}});var i=n(37762),r=n(15671),a=n(43144),s=(n(59486),n(41644)),o=n(91505),l=n(16889),c=n(92026),u=n(17842),h=n(23879),d=n(22753),f=n(11873),p=n(14226),v=n(81949),g=n(88396),m=n(11186),_=n(71353),b=n(60176),y=n(92183),P=n(65156),w=n(85981),E=n(55652),S=n(40885),x=n(11185),L=n(37818),C=n(77648),D=n(81703),V=n(30425),R=n(59887),k=n(97882),A=n(7882),M=function(){function e(t){for(var n in(0,r.Z)(this,e),this.camera=new V.Z,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,v.c)(),this._worldFrame=null,this._renderLocation=(0,_.c)(),this._renderLocationDirty=!0,this._location=new A.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new A.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new o.Z.EventEmitter,this._screenLocation={screenPointArray:(0,u.s1)(),renderScreenPointArray:(0,u.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=t.view.spatialReference,t)this[n]=t[n];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}return(0,a.Z)(e,[{key:"destroy",value:function(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}},{key:"renderObjects",get:function(){return this._renderObjects},set:function(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}},{key:"available",get:function(){return this._available},set:function(e){e!==this._available&&(this._available=e,this._updateEngineObject())}},{key:"disableDisplay",value:function(){var e=this;return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,h.IH)((function(){e._noDisplayCount--,0===e._noDisplayCount&&e._updateEngineObject()}))}}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}},{key:"worldSized",get:function(){return this._worldSized},set:function(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}},{key:"modelTransform",get:function(){return this._modelTransform},set:function(e){T(e)&&(this._screenLocationDirty=!0),(0,p.c)(this._modelTransform,e),this._updateEngineObject()}},{key:"renderLocation",get:function(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,v.c)()),function(e,t,n){switch(e.viewingMode){case"local":return(0,p.i)(n),!0;case"global":var i=(0,y.Iu)(e.renderCoordsHelper.spatialReference);(0,b.PR)(t,0,q,0,i.radius),(0,b.yH)((0,l.Vl)(q[0]),(0,l.Vl)(q[1]),n)}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation},set:function(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}},{key:"location",get:function(){return this._location},set:function(e){(0,L.WG)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"elevationAlignedLocation",get:function(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation},set:function(e){(0,L.WG)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"_updateElevationAlignedLocation",value:function(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;var e=(0,c.pC)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",get:function(){return this._grabbing},set:function(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"hovering",get:function(){return this._hovering},set:function(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"selected",get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,this._updateEngineObject())}},{key:"updateStateEnabled",value:function(e,t){t?this.state|=e:this.state&=~e}},{key:"_setFocused",value:function(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}},{key:"focused",get:function(){return this._focused}},{key:"screenLocation",get:function(){return this.ensureScreenLocation(),this._screenLocation}},{key:"ensureScreenLocation",value:function(){if(this._screenLocationDirty){var e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,T(this._modelTransform)){var t=this._calculateModelTransformOffset(N);e=(0,m.b)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}}},{key:"applyObjectTransform",get:function(){return this._applyObjectTransform},set:function(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"intersectionDistance",value:function(e,t){if(!this.available)return null;var n=(0,u.md)(e,Z),r=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,g.a)(this.screenLocation.screenPointArray,n)<r*r)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":var o=this.collisionType.paths,l=this._getWorldToScreenObjectScale(),h=this._calculateObjectTransform(l,U),f=r*this.screenLocation.pixelSize,p=(0,D.u4)(this.camera,n,O);if((0,c.Wi)(p))return null;var v,b=(0,i.Z)(o);try{for(b.s();!(v=b.n()).done;){var y=v.value;if(0!==y.length)for(var P=(0,m.m)(q,y[0],h),S=1;S<y.length;S++){var L=(0,m.m)(I,y[S],h),C=(0,w.Gr)((0,w.zk)(P,L,z),p);if(null!=C&&C<f*f){var V=(0,m.b)(x.WM.get(),P,L);(0,m.a)(V,V,.5);var R=(0,u.So)(x.WM.get());return this.camera.projectToRenderScreen(V,R),R[2]+a}(0,m.g)(P,L)}}}catch(be){b.e(be)}finally{b.f()}break;case"disc":var k,A=this.collisionType.direction,M=null!=(k=this.collisionType.offset)?k:_.Z,T=this._getWorldToScreenObjectScale(),j=this._calculateObjectTransform(T,U),N=r*this.screenLocation.pixelSize,J=(0,D.u4)(this.camera,n,O);if((0,c.Wi)(J))return null;var $=(0,d.f)(W,j),K=(0,m.t)(B,A,$),Y=(0,m.m)(G,M,j);(0,E.Yq)(Y,K,F);var Q=H;if((0,E.BR)(F,J,Q)&&(0,m.h)(Q,Y)<N*N)return this.screenLocation.renderScreenPointArray[2]+a;break;case"ribbon":var X=this.collisionType,ee=X.paths,te=X.direction,ne=this._getWorldToScreenObjectScale(),ie=this._calculateObjectTransform(ne,U),re=r*this.camera.computeScreenPixelSizeAt(this.renderLocation),ae=(0,D.u4)(this.camera,n,O);if((0,c.Wi)(ae))return null;var se=(0,d.f)(W,ie),oe=(0,m.t)(B,te,se),le=this._calculateModelTransformPosition(G);(0,E.Yq)(le,oe,F);var ce=H;if(!(0,E.BR)(F,ae,ce))break;var ue,he=(0,i.Z)(ee);try{for(he.s();!(ue=he.n()).done;){var de=ue.value;if(0!==de.length)for(var fe=(0,m.m)(q,de[0],ie),pe=1;pe<de.length;pe++){var ve=(0,m.m)(I,de[pe],ie),ge=(0,w.Jk)((0,w.zk)(fe,ve,z),ce);if(null!=ge&&ge<re*re){var me=(0,m.b)(x.WM.get(),fe,ve);(0,m.a)(me,me,.5);var _e=(0,u.So)(x.WM.get());return this.camera.projectToRenderScreen(me,_e),_e[2]+a}(0,m.g)(fe,ve)}}}catch(be){he.e(be)}finally{he.f()}break;default:(0,s.Bg)(this.collisionType)}return null}},{key:"attach",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};if(this.view._stage){var n=t.manipulator3D;if((0,c.Wi)(n.engineLayerId)){var i=new k.F({isPickable:!1,updatePolicy:1});this.view._stage.add(i),n.engineLayerId=i.id,this._engineLayer=i}else null!=(e=this.view._stage)&&e.getObject&&(this._engineLayer=this.view._stage.getObject(n.engineLayerId));n.engineLayerReferences=(n.engineLayerReferences||0)+1,this._materialIdReferences=n.materialIdReferences,(0,c.Wi)(this._materialIdReferences)&&(this._materialIdReferences=new Map,n.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,b.Up)(this._location.spatialReference,this.view.spatialReference)||(this.location=new A.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}}},{key:"detach",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}},t=e.manipulator3D;t.engineLayerReferences--;var n=0===t.engineLayerReferences;n&&(t.engineLayerId=null),this._removeResourcesFromStage(n),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}},{key:"onViewChange",value:function(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"onElevationChange",value:function(e){(0,b.nF)(this.location,J,e.spatialReference),(0,P.Qn)(e.extent,J)&&(this.location=this._location)}},{key:"_evaluateElevationAlignment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.location;if((0,c.Wi)(this.elevationInfo))return!1;var t=null,n=0,i=(0,c.Pt)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=(0,c.Pt)((0,C.KO)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":n=(0,c.Pt)((0,C.KO)(this.view.elevationProvider,e,"ground"),0)+i;break;case"relative-to-scene":n=(0,c.Pt)((0,C.KO)(this.view.elevationProvider,e,"scene"),0)+i;break;case"absolute-height":n=i}return(n!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=n,this._elevation.override=t,!0)}},{key:"_updateEngineObject",value:function(){if(this._attached)if(this.available){var e=this._getWorldToScreenObjectScale(),t=U;if(!0===this.autoScaleRenderObjects){var n=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(n,t)}else this._calculateObjectTransform(e,t);var r,a=this._ensureEngineResources().objectsByState,s=(this.focused?2:1)|(this.selected?8:4),o=this._noDisplayCount>0,l=(0,i.Z)(a);try{for(l.s();!(r=l.n()).done;){var c=r.value,u=c.stateMask,h=c.objects;if(o){var d,f=(0,i.Z)(h);try{for(f.s();!(d=f.n()).done;){d.value.setVisible(!1)}}catch(P){f.e(P)}finally{f.f()}}else{var p=!(0!=(15&u))||(s&u)==(15&u),v=!(0!=(65520&u))||(this.state&u)==(65520&u);if(p&&v){var g,m=(0,i.Z)(h);try{for(m.s();!(g=m.n()).done;){var _=g.value;_.setVisible(!0),_.transformation=t}}catch(P){m.e(P)}finally{m.f()}}else{var b,y=(0,i.Z)(h);try{for(y.s();!(b=y.n()).done;){b.value.setVisible(!1)}}catch(P){y.e(P)}finally{y.f()}}}}}catch(P){l.e(P)}finally{l.f()}}else this._removeResourcesFromStage()}},{key:"_ensureEngineResources",value:function(){if((0,c.Wi)(this._engineResources)){var e=(0,c.Wg)(this._engineLayer),t=[],n=new Set;this.renderObjects.forEach((function(e){var i=e.material;n.has(i)||(t.push(i),n.add(i))}));var i=new Map;this._renderObjects.forEach((function(e){var t=new R.T({castShadow:!1});!function(e,t){var n=t.geometry,i=t.material,r=t.transform;Array.isArray(n)?n.forEach((function(t){return e.addGeometry(t,i,r)})):e.addGeometry(n,i,r)}(t,e);var n=e.stateMask||0,r=i.get(n)||[];r.push(t),i.set(n,r)}));var r=[];i.forEach((function(e,t){return r.push({stateMask:t,objects:e})})),this._engineResources={objectsByState:r,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}},{key:"_addResourcesToStage",value:function(){var e=this;if(!this._engineResourcesAddedToStage&&!(0,c.Wi)(this._engineResources)){var t=this._engineResources,n=t.objectsByState,i=t.layer;t.materials.forEach((function(t){var n=(0,c.Wg)(e._materialIdReferences),i=n.get(t.id)||0;0===i&&e.view._stage.add(t),n.set(t.id,i+1)})),n.forEach((function(t){var n=t.objects;i.addMany(n),e.view._stage.addMany(n)})),this._engineResourcesAddedToStage=!0}}},{key:"_removeResourcesFromStage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._engineResourcesAddedToStage&&!(0,c.Wi)(this._engineResources)){var n=this._engineResources,i=n.objectsByState,r=n.layer,a=n.materials;i.forEach((function(t){var n=t.objects;r.removeMany(n),e.view._stage.removeMany(n)})),a.forEach((function(t){var n=(0,c.Wg)(e._materialIdReferences),i=n.get(t.id);1===i?(e.view._stage.remove(t),n.delete(t.id)):n.set(t.id,i-1)})),t&&this.view._stage.remove(r),this._engineResourcesAddedToStage=!1}}},{key:"_getCollisionRadius",value:function(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}},{key:"_getFocusedSize",value:function(e,t){return e*(t?this.focusMultiplier:1)}},{key:"_getWorldToScreenObjectScale",value:function(){return this._worldSized?1:this.screenLocation.pixelSize}},{key:"_calculateModelTransformPosition",value:function(e){var t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,j);return(0,m.s)(e,n[12],n[13],n[14])}},{key:"_calculateModelTransformOffset",value:function(e){var t=this._calculateModelTransformPosition(e);return(0,m.f)(e,t,this.renderLocation)}},{key:"_calculateObjectTransform",value:function(e,t){return(0,p.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,p.m)(t,t,this._worldFrame),(0,p.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,(0,c.pC)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}},{key:"test",get:function(){var e=!1;if((0,c.pC)(this._engineResources))for(var t in this._engineResources.objectsByState){var n,r=this._engineResources.objectsByState[t],a=(0,i.Z)(r.objects);try{for(a.s();!(n=a.n()).done;){if(n.value.isVisible){e=!0;break}}}catch(s){a.e(s)}finally{a.f()}if(e)break}return{areAnyResourcesVisible:e}}}]),e}();function T(e){return 0!==e[12]||0!==e[13]||0!==e[14]}var Z=(0,u.s1)(),z=(0,w.Ue)(),O=(0,S.Ue)(),W=(0,f.c)(),j=(0,v.c)(),U=(0,v.c)(),F=(0,E.Ue)(),q=(0,_.c)(),I=(0,_.c)(),H=(0,_.c)(),B=(0,_.c)(),G=(0,_.c)(),N=(0,_.c)(),J=new A.Z({x:0,y:0,z:0,spatialReference:null})},51328:function(e,t,n){n.d(t,{zP:function(){return L},J4:function(){return C},gv:function(){return D},G:function(){return w},_y:function(){return S},VG:function(){return E},_N:function(){return _},bB:function(){return b},Sp:function(){return x}});var i=n(1413),r=n(92026),a=n(17842),s=n(11186),o=n(71353),l=n(60176),c=n(55652),u=n(40885),h=n(40927),d=n(11185),f=n(74509),p=n(81703),v=n(13679),g=n(76783),m=n(74229);function _(e,t){return y(e,(function(){return t}))}function b(e){return y(e,(function(e){return e.plane}))}function y(e,t){var n=(0,o.c)(),s=(0,o.c)(),l=!1;return function(o){var u=t(o);if("start"===o.action){var h=(0,a.md)(o.screenStart,(0,a.c$)(d.qW.get())),f=(0,p.u4)(e.state.camera,h,k);(0,r.pC)(f)&&(l=(0,c.BR)(u,f,n))}if(!l)return null;var v=(0,a.md)(o.screenEnd,(0,a.c$)(d.qW.get())),g=(0,p.u4)(e.state.camera,v,k);return(0,r.Wi)(g)?null:(0,c.BR)(u,g,s)?(0,i.Z)((0,i.Z)({},o),{},{renderStart:n,renderEnd:s,plane:u,ray:g}):null}}function P(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=null;return function(u){if("start"===u.action&&(c=e.sceneIntersectionHelper.intersectElevationFromScreen((0,a.s1)(u.screenStart.x,u.screenStart.y),t,n,o),(0,r.pC)(c)&&(0,r.pC)(s)&&!(0,l.nF)(c,c,s)))return null;if((0,r.Wi)(c))return null;var h=e.sceneIntersectionHelper.intersectElevationFromScreen((0,a.s1)(u.screenEnd.x,u.screenEnd.y),t,n,o);return(0,r.pC)(h)?(0,r.pC)(s)&&!(0,l.nF)(h,h,s)?null:(0,i.Z)((0,i.Z)({},u),{},{mapStart:c,mapEnd:h}):null}}function w(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return P(e,n,(0,f.Ou)(t,e,n),i,r)}function E(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return w(e,n,(0,f.RL)(t),i,r)}function S(e,t,n,i){var a=t.toMap(e.screenStart,{include:[n]});return(0,r.pC)(a)?E(t,n,a,i):null}function x(e,t,n){var i=null,r=new m.hM;return r.next(_(e,function(e,t){var n=V,i=R,r=(0,c.Ue)();e.renderCoordsHelper.worldUpAtPosition(t,n);var a=(0,s.c)(r,n,(0,s.f)(i,t,e.state.camera.eye));return(0,s.c)(a,a,n),(0,c.Yq)(t,a,r)}(e,t))).next(function(e,t){var n=(0,o.c)(),i=(0,s.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,n);var r=(0,o.c)(),a=(0,o.c)(),l=function(r){return(0,s.f)(r,r,t),(0,h.nF)(n,r,r),"global"===e.viewingMode&&(0,s.l)(r)*Math.sign((0,s.d)(n,r))<.001-i&&(0,s.f)(r,(0,s.a)(r,n,.001),t),(0,s.b)(r,r,t),r};return function(e){return e.renderStart=l((0,s.g)(r,e.renderStart)),e.renderEnd=l((0,s.g)(a,e.renderEnd)),e}}(e,t)).next(L(e,n)).next((function(e){e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,i=e})),function(e){return i=null,r.execute(e),i}}function L(e,t){var n=e.renderCoordsHelper;return function(e){var a=n.fromRenderCoords(e.renderStart,t),s=n.fromRenderCoords(e.renderEnd,t);return(0,r.pC)(a)&&(0,r.pC)(s)?(0,i.Z)((0,i.Z)({},e),{},{mapStart:a,mapEnd:s}):null}}function C(e){var t=null;return function(n){switch(n.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,r.pC)(t)&&(t.remove(),t=null)}return n}}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(0,v.Z8)(e.state.viewingMode);n.options.selectionMode=!0,n.options.store=0,n.options.hud=!1;var s,l=(0,a.s1)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},u=(0,o.c)(),h=(0,r.Pt)(t,e.spatialReference),d=function(t){e.map.ground&&e.map.ground.opacity<1?c.exclude.add(g.cy):c.exclude.delete(g.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,a.md)(t,l),n,c);var i,r=n.results.min;if(r.getIntersectionPoint(u))i=2===r.intersector?0:1;else{if(!n.results.ground.getIntersectionPoint(u))return null;i=0}return{location:e.renderCoordsHelper.fromRenderCoords(u,h),surfaceType:i}};return function(e){if("start"===e.action){var t=d(e.screenStart);s=(0,r.pC)(t)?t.location:null}if((0,r.Wi)(s))return null;var n=d(e.screenEnd);return(0,r.pC)(n)&&(0,r.pC)(n.location)?(0,i.Z)((0,i.Z)({},e),{},{mapStart:s,mapEnd:n.location,surfaceType:n.surfaceType}):null}}var V=(0,o.c)(),R=(0,o.c)(),k=(0,u.Ue)()},83639:function(e,t,n){n.d(t,{Gd:function(){return m},Aq:function(){return _},EA:function(){return p},qJ:function(){return v},aD:function(){return g},du:function(){return b},u2:function(){return y}});var i=n(92026),r=n(14226),a=n(11186),s=n(67077),o=n(11185),l=n(37818),c=n(35284),u=n(96387),h=n(70619),d=n(74818),f=n(11606);function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=(0,s.f)(e[0],e[1],e[2],e.length>3?e[3]:1),r=e[3]<1;return n?new f.Q({color:i,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:t}):new d.E({color:i,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:t})}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=(0,s.f)(e[0],e[1],e[2],4===e.length?e[3]:1);return new d.E({color:n,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function g(e,t,n){return new c.Z({view:e,renderObjects:[{geometry:h.Z.createSphereGeometry(1,32,32),material:p((0,s.f)(t[0],t[1],t[2],null!=n?n:1))}]})}function m(e,t,n,i){var s=(0,a.f)(o.WM.get(),e,n),l=_(s,(0,a.c)(o.WM.get(),i,s),n,o.MP.get());(0,r.b)(l,l);var c=(0,a.m)(o.WM.get(),t,l);return Math.atan2(c[1],c[0])}function _(e,t,n,i){var r=(0,a.n)(o.WM.get(),e),s=(0,a.n)(o.WM.get(),t),l=(0,a.c)(o.WM.get(),r,s);return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=0,i[4]=s[0],i[5]=s[1],i[6]=s[2],i[7]=0,i[8]=l[0],i[9]=l[1],i[10]=l[2],i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i}function b(e,t){var n=e.getViewForGraphic(t);return(0,i.pC)(n)&&"computeAttachmentOrigin"in n?n.computeAttachmentOrigin(t,e.spatialReference):null}function y(e,t,n){var r=b(e,n);(0,i.pC)(r)?t.elevationAlignedLocation=r:function(e,t){if((0,i.Wi)(t))return;var n="mesh"===t.type?t.anchor:(0,u.zE)(t);(0,i.Wi)(n)||(e.location=(0,l.kB)(n))}(t,n.geometry)}},75508:function(e,t,n){n.d(t,{W:function(){return ie}});var i=n(15671),r=n(43144),a=n(60136),s=n(29388),o=n(92026),l=n(11186),c=n(71353),u=n(85981),h=n(86244),d=n(16889),f=n(6394),p=n(90045),v=n(67077),g=n(70444),m=n(95773),_=n(55652),b=n(40885),y=n(23470),P=n(37762),w=n(50256),E=n(55158),S=n(27366),x=n(14226),L=n(81949),C=n(82144),D=n(31132),V=n(33559),R=n(27627),k=n(18300),A=n(36207),M=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build(i);return new R.$(e.rctx,r,n.attributeLocations)}},{key:"bind",value:function(e,t,n){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*n.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*n.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",n.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/n.fullWidth,2/n.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",n.projectionMatrix),(0,x.a)(Z,n.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",Z),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)}},{key:"initializePipeline",value:function(){return(0,A.sm)({blending:(0,A.if)(1,771),colorWrite:A.BK})}}]),n}(D.A);M.shader=new C.J(k.L,(function(){return n.e(7515).then(n.bind(n,97515))})),M.attributeLocations=new Map([["start",0],["end",1],["up",2],["extrude",3]]);var T=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).contrastControlEnabled=!1,e}return(0,r.Z)(n)}(V.m);(0,S._)([(0,V.o)()],T.prototype,"contrastControlEnabled",void 0);var Z=(0,L.c)(),z=n(44070),O=n(45412),W=function(){function e(t){(0,i.Z)(this,e),this._renderCoordsHelper=t,this._buffers=null,this._origin=(0,c.c)(),this._dirty=!1,this._count=0,this._vao=null}return(0,r.Z)(e,[{key:"vertices",set:function(e){var t,n=new Float64Array(3*e.length),i=0,r=(0,P.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[i++]=a[0],n[i++]=a[1],n[i++]=a[2]}}catch(s){r.e(s)}finally{r.f()}this.buffers=[n]}},{key:"buffers",set:function(e){if(this._buffers=e,this._buffers.length>0){var t=this._buffers[0],n=3*Math.floor(t.length/3/2);(0,l.s)(this._origin,t[n+0],t[n+1],t[n+2])}else(0,l.s)(this._origin,0,0,0);this._dirty=!0}},{key:"origin",get:function(){return this._origin}},{key:"draw",value:function(e){var t=this.ensureVAO(e);(0,o.pC)(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))}},{key:"dispose",value:function(){(0,o.pC)(this._vao)&&this._vao.dispose()}},{key:"ensureVAO",value:function(e){return(0,o.Wi)(this._buffers)?null:((0,o.Wi)(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)}},{key:"createVAO",value:function(e,t){var n=this.createDataBuffer(t);return this._dirty=!1,new O.Z(e,M.attributeLocations,{data:(0,w.K)(F)},{data:z.Z.createVertex(e,35044,n)})}},{key:"ensureVertexData",value:function(e,t){if(this._dirty){var n=this.createDataBuffer(t);e.vertexBuffers.data.setData(n),this._dirty=!1}}},{key:"numberOfRenderVertices",value:function(e){return 2*(e.length/3-1)*3}},{key:"createDataBuffer",value:function(e){var t=this,n=e.reduce((function(e,n){return e+t.numberOfRenderVertices(n)}),0);this._count=n;var i,r=F.createBuffer(n),a=this._origin,s=0,o=0,c=(0,P.Z)(e);try{for(c.s();!(i=c.n()).done;){for(var u=i.value,h=0;h<u.length;h+=3){var d=(0,l.s)(U,u[h+0],u[h+1],u[h+2]);0===h?o=this._renderCoordsHelper.getAltitude(d):this._renderCoordsHelper.setAltitude(d,o);var f=this._renderCoordsHelper.worldUpAtPosition(d,j),p=s+2*h,v=(0,l.f)(U,d,a);if(h<u.length-3){r.up.setVec(p,f),r.up.setVec(p+3,f),r.up.setVec(p+5,f);for(var g=0;g<6;g++)r.start.setVec(p+g,v);r.extrude.setValues(p+0,0,-1),r.extrude.setValues(p+1,1,-1),r.extrude.setValues(p+2,1,1),r.extrude.setValues(p+3,0,-1),r.extrude.setValues(p+4,1,1),r.extrude.setValues(p+5,0,1)}if(h>0){r.up.setVec(p-2,f),r.up.setVec(p-4,f),r.up.setVec(p-5,f);for(var m=-6;m<0;m++)r.end.setVec(p+m,v)}}s+=this.numberOfRenderVertices(u)}}catch(_){c.e(_)}finally{c.f()}return r.buffer}}]),e}(),j=(0,c.c)(),U=(0,c.c)(),F=(0,E.U$)().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude"),q=n(32534),I=n(97731),H=n(22909),B=n(7566),G=n(83671),N=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build(i);return new R.$(e.rctx,r,B.i)}},{key:"bind",value:function(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);var n=null!=e.angleCutoff?e.angleCutoff:G.d;this.program.setUniform2f("angleCutoff",Math.cos(n),Math.cos(Math.max(0,n-(0,d.Vl)(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)}},{key:"initializePipeline",value:function(){return(0,A.sm)({blending:(0,A.if)(1,771),colorWrite:A.BK})}}]),n}(D.A);N.shader=new C.J(G.L,(function(){return n.e(5693).then(n.bind(n,45693))}));var J=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).heightManifoldEnabled=!1,e.pointDistanceEnabled=!1,e.lineVerticalPlaneEnabled=!1,e.intersectsLineEnabled=!1,e.contrastControlEnabled=!1,e}return(0,r.Z)(n)}(V.m);(0,S._)([(0,V.o)()],J.prototype,"heightManifoldEnabled",void 0),(0,S._)([(0,V.o)()],J.prototype,"pointDistanceEnabled",void 0),(0,S._)([(0,V.o)()],J.prototype,"lineVerticalPlaneEnabled",void 0),(0,S._)([(0,V.o)()],J.prototype,"intersectsLineEnabled",void 0),(0,S._)([(0,V.o)()],J.prototype,"contrastControlEnabled",void 0);var $=(0,c.c)(),K=(0,v.c)(),Y={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:(0,d.Vl)(6),globalAlphaContrastBoost:2};function Q(e,t,n,i){var r=$,a=K;(0,l.m)(r,t,i),(0,l.g)(a,n),a[3]=0,(0,p.t)(a,a,i),(0,_.Yq)(r,a,e)}var X=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{contrastControlEnabled:!1};(0,i.Z)(this,e),this._renderCoordsHelper=t,this._config=r,this._technique=null,this._projInfo=(0,v.c)(),this._zScale=(0,f.a)(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=(0,c.c)(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=(0,c.c)(),this._pointDistanceTarget=(0,c.c)(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=(0,u.Ue)(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=(0,u.Ue)(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=(0,c.c)(),this._tempDir=(0,c.c)(),this._tempUp=(0,c.c)(),this._tempVec3A=(0,c.c)(),this._tempVec3B=(0,c.c)(),this._tempVec4=(0,v.c)(),this._tempPlane=(0,_.Ue)(),this._tempSphere=(0,y.c)(),this._params=(0,H.Uf)(n,Y)}return(0,r.Z)(e,[{key:"renderSlots",get:function(){return[this._config.contrastControlEnabled?15:14]}},{key:"needsLinearDepth",get:function(){return!0}},{key:"heightManifoldEnabled",get:function(){return this._heightManifoldEnabled},set:function(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldTarget},set:function(e){(0,l.g)(this._heightManifoldTarget,e),this._requestRender()}},{key:"pointDistanceEnabled",get:function(){return this._pointDistanceEnabled},set:function(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}},{key:"pointDistanceTarget",get:function(){return this._pointDistanceTarget},set:function(e){(0,l.g)(this._pointDistanceTarget,e),this._requestRender()}},{key:"pointDistanceOrigin",get:function(){return this._pointDistanceOrigin},set:function(e){(0,l.g)(this._pointDistanceOrigin,e),this._requestRender()}},{key:"lineVerticalPlaneEnabled",get:function(){return this._lineVerticalPlaneEnabled},set:function(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(e){(0,u.JG)(e,this._lineVerticalPlaneSegment),this._requestRender()}},{key:"intersectsLineEnabled",get:function(){return this._intersectsLineEnabled},set:function(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}},{key:"intersectsLineSegment",get:function(){return this._intersectsLineSegment},set:function(e){(0,u.JG)(e,this._intersectsLineSegment),this._requestRender()}},{key:"intersectsLineRadius",get:function(){return this._intersectsLineRadius},set:function(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}},{key:"pathVerticalPlaneEnabled",get:function(){return this._pathVerticalPlaneEnabled},set:function(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,(0,o.pC)(this._pathVerticalPlaneData)&&this._requestRender())}},{key:"pathVerticalPlaneVertices",set:function(e){(0,o.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new W(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}},{key:"pathVerticalPlaneBuffers",set:function(e){(0,o.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new W(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}},{key:"setParameters",value:function(e){(0,H.LO)(this._params,e)&&this._requestRender()}},{key:"initializeRenderContext",value:function(e){this._context=e;var t=e.renderContext.rctx;this._quadVAO=(0,q.ow)(t),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new J;var n=new T;n.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(M,n)}},{key:"uninitializeRenderContext",value:function(){this._quadVAO=(0,o.O3)(this._quadVAO),this._technique=(0,o.RY)(this._technique),this._pathVerticalPlaneData=(0,o.O3)(this._pathVerticalPlaneData),this._pathTechnique=(0,o.RY)(this._pathTechnique)}},{key:"render",value:function(e){var t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,n=this.pathVerticalPlaneEnabled;if(!t&&!n)return!1;var i=e.camera;return(0,I.Xv)(i.projectionMatrix,i.fullWidth,i.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),n&&this.renderPath(e),!0}},{key:"renderUnified",value:function(e){var t=e.rctx,n=this._selectTechnique(),i=n.program;t.useProgram(i),n.bindPipelineState(t),this._bindGlobalUniforms(e,i),this.bindHeightManifoldUniforms(e,i),this.bindPointDistanceUniforms(e,i),this.bindLineVerticalPlaneUniforms(e,i),this.bindIntersectsLineUniforms(e,i),n.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)}},{key:"renderPath",value:function(e){if(!(0,o.Wi)(this._pathVerticalPlaneData)&&!(0,o.Wi)(this._pathTechnique)){var t=e.rctx,n=this._pathTechnique,i=n.program;t.useProgram(i),n.bindPipelineState(t),this._bindGlobalUniforms(e,i),n.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}}},{key:"bindHeightManifoldUniforms",value:function(e,t){if(this.heightManifoldEnabled){var n=this._tempVec3A,i=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,n),Q(i,this._heightManifoldTarget,n,e.camera.viewMatrix),t.setUniform4fv("heightPlane",i)}}},{key:"bindPointDistanceUniforms",value:function(e,t){if(this._pointDistanceEnabled){var n=e.camera,i=this._tempSphere;(0,l.g)(i,this._pointDistanceOrigin),(0,l.m)(i,i,n.viewMatrix),i[3]=(0,l.i)(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",i[0],i[1],i[2],i[3])}}},{key:"bindLineVerticalPlaneUniforms",value:function(e,t){if(this._lineVerticalPlaneEnabled){var n=this._renderCoordsHelper,i=e.camera,r=this._tempPlane,a=this._tempVec3A,s=this._tempUp,o=this._tempDir,c=this._tempNormal;(0,u.KU)(this._lineVerticalPlaneSegment,.5,a),n.worldUpAtPosition(a,s),(0,l.n)(o,this._lineVerticalPlaneSegment.vector),(0,l.c)(c,s,o),(0,l.n)(c,c),Q(r,this._lineVerticalPlaneSegment.origin,c,i.viewMatrix),t.setUniform4fv("lineVerticalPlane",r);var h=this._tempVec3A;(0,l.g)(h,this._lineVerticalPlaneSegment.origin),n.setAltitude(h,0),(0,l.m)(h,h,i.viewMatrix),t.setUniform3fv("lineVerticalStart",h);var d=this._tempVec3B;(0,l.b)(d,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),n.setAltitude(d,0),(0,l.m)(d,d,i.viewMatrix),t.setUniform3fv("lineVerticalEnd",d)}}},{key:"bindIntersectsLineUniforms",value:function(e,t){if(this._intersectsLineEnabled){var n=te,i=ne;if(this._intersectsLineInfinite){var r=e.camera;if((0,g.iL)((0,b.re)(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),ee),ee.c0=-Number.MAX_VALUE,!(0,m.zq)(r.frustum,ee))return;(0,g.Ws)(ee,n),(0,g.S$)(ee,i)}else(0,l.g)(n,this._intersectsLineSegment.origin),(0,l.b)(i,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);var a=this._tempVec3A;(0,l.m)(a,n,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",a);var s=this._tempVec4;(0,l.g)(s,this._intersectsLineSegment.vector),this._tempVec4[3]=0,(0,p.t)(this._tempVec4,this._tempVec4,e.camera.viewMatrix),(0,l.m)(i,i,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",i),(0,l.n)(s,s),t.setUniform3f("intersectsLineDirection",s[0],s[1],s[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}}},{key:"_bindGlobalUniforms",value:function(e,t){var n=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",n.near,n.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*n.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,"depthMap"),t.bindTexture(e.offscreenRenderingHelper.mainColorTexture,"frameColor")}},{key:"_requestRender",value:function(){this._context&&this._context.requestRender()}},{key:"_selectTechnique",value:function(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.releaseAndAcquire(N,this._techniqueConfig,this._technique),this._technique}}]),e}(),ee=(0,g.Ue)(),te=(0,c.c)(),ne=(0,c.c)(),ie=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e.view))._angleCutoff=G.d,r._style={},r._heightManifoldTarget=(0,c.c)(),r._heightManifoldEnabled=!1,r._intersectsLine=(0,u.Ue)(),r._intersectsLineEnabled=!1,r._intersectsLineInfinite=!1,r._lineVerticalPlaneSegment=null,r._pathVerticalPlaneBuffers=null,r._pointDistanceLine=null,r.applyProps(e),r}return(0,r.Z)(n,[{key:"testData",get:function(){return this.renderer}},{key:"createResources",value:function(){this.ensureRenderer()}},{key:"destroyResources",value:function(){this.disposeRenderer()}},{key:"updateVisibility",value:function(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance()}},{key:"angleCutoff",get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())}},{key:"style",get:function(){return this._style},set:function(e){this._style=e,this.syncStyle()}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){(0,o.pC)(e)?((0,l.g)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()}},{key:"intersectsWorldUpAtLocation",set:function(e){if((0,o.Wi)(e))this.intersectsLine=null;else{var t=this.view.renderCoordsHelper.worldUpAtPosition(e,re);this.intersectsLine=(0,u.al)(e,t),this.intersectsLineInfinite=!0}}},{key:"intersectsLine",get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){(0,o.pC)(e)?((0,u.JG)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(e){this._lineVerticalPlaneSegment=(0,o.pC)(e)?(0,u.JG)(e):null,this.syncLineVerticalPlane(),this.syncRenderer()}},{key:"pathVerticalPlane",get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer()}},{key:"pointDistanceLine",get:function(){return this._pointDistanceLine},set:function(e){this._pointDistanceLine=(0,o.pC)(e)?{origin:(0,c.a)(e.origin),target:(0,c.a)(e.target)}:null,this.syncPointDistance(),this.syncRenderer()}},{key:"syncRenderer",value:function(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||(0,o.pC)(this._pointDistanceLine)||(0,o.pC)(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()}},{key:"ensureRenderer",value:function(){(0,o.pC)(this.renderer)||(this.renderer=new X(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}},{key:"syncStyle",value:function(){(0,o.Wi)(this.renderer)||(this.renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}},{key:"syncAngleCutoff",value:function(){(0,o.Wi)(this.renderer)||this.renderer.setParameters({angleCutoff:this._angleCutoff})}},{key:"syncHeightManifold",value:function(){(0,o.Wi)(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}},{key:"syncIntersectsLine",value:function(){(0,o.Wi)(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}},{key:"syncIntersectsLineInfinite",value:function(){(0,o.Wi)(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}},{key:"syncPathVerticalPlane",value:function(){(0,o.Wi)(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=(0,o.pC)(this._pathVerticalPlaneBuffers)&&this.visible,(0,o.pC)(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}},{key:"syncLineVerticalPlane",value:function(){(0,o.Wi)(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=(0,o.pC)(this._lineVerticalPlaneSegment)&&this.visible,(0,o.pC)(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}},{key:"syncPointDistance",value:function(){(0,o.Wi)(this.renderer)||(this.renderer.pointDistanceEnabled=(0,o.pC)(this._pointDistanceLine)&&this.visible,(0,o.pC)(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}},{key:"disposeRenderer",value:function(){(0,o.pC)(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}]),n}(h.l),re=(0,c.c)()},86244:function(e,t,n){n.d(t,{l:function(){return a}});var i=n(15671),r=n(43144),a=function(){function e(t){var n=this;(0,i.Z)(this,e),this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this.view.watch("ready",(function(e){n._resourcesCreated&&(e?n._createResources():n._destroyResources())}))}return(0,r.Z)(e,[{key:"applyProps",value:function(e){var t=!1;for(var n in e)n in this?"attached"===n?t=e[n]:this[n]=e[n]:console.error("Cannot set unknown property",n);this.attached=t}},{key:"destroy",value:function(){this.attached=!1}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}},{key:"_createResources",value:function(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}},{key:"_destroyResources",value:function(){this.destroyResources(),this._resourcesCreated=!1}}]),e}()},81703:function(e,t,n){n.d(t,{u4:function(){return l}});var i=n(92026),r=n(17842),a=n(88396),s=n(11186),o=n(11185);function l(e,t,n){return function(e,t,n){var l=(0,r.Wv)((0,a.c)(o.WM.get(),t));if(l[2]=0,!e.unprojectFromRenderScreen(l,n.origin))return null;var c=(0,r.Wv)((0,a.c)(o.WM.get(),t));c[2]=1;var u=e.unprojectFromRenderScreen(c,o.WM.get());return(0,i.Wi)(u)?null:((0,s.f)(n.direction,u,n.origin),n)}(e,e.screenToRender(t,(0,r.Wv)(o.WM.get())),n)}},66127:function(e,t,n){n.d(t,{j:function(){return p}});var i,r,a,s,o,l,c,u=n(30168),h=n(21002),d=n(98634);function f(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add((0,d.H)(i||(i=(0,u.Z)(["vec3 reconstructPosition(vec2 fragCoord, float depth) {\nreturn vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}"]))))}function p(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(h.S),e.include(f),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add((0,d.H)(r||(r=(0,u.Z)(["vec4 blendPremultiplied(vec4 source, vec4 dest) {\nfloat oneMinusSourceAlpha = 1.0 - source.a;\nreturn vec4(\nsource.rgb + dest.rgb * oneMinusSourceAlpha,\nsource.a + dest.a * oneMinusSourceAlpha\n);\n}"])))),e.fragment.code.add((0,d.H)(a||(a=(0,u.Z)(["vec4 premultipliedColor(vec3 rgb, float alpha) {\nreturn vec4(rgb * alpha, alpha);\n}"])))),e.fragment.code.add((0,d.H)(s||(s=(0,u.Z)(["vec4 laserlineProfile(float dist) {\nif (dist > glowWidth) {\nreturn vec4(0.0);\n}\nfloat innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\nfloat glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\nreturn blendPremultiplied(\npremultipliedColor(innerColor, innerAlpha),\npremultipliedColor(glowColor, glowAlpha)\n);\n}"])))),e.fragment.code.add((0,d.H)(o||(o=(0,u.Z)(["bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\nfloat depth = linearDepthFromTexture(depthMap, uv, nearFar);\nif (-depth == nearFar[0]) {\nreturn false;\n}\npos = reconstructPosition(gl_FragCoord.xy, depth);\nnormal = normalize(cross(dFdx(pos), dFdy(pos)));\nfloat ddepth = fwidth(depth);\ndepthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\nreturn true;\n}"])))),t.contrastControlEnabled?e.fragment.code.add((0,d.H)(l||(l=(0,u.Z)(["float rgbToLuminance(vec3 color) {\nreturn dot(vec3(0.2126, 0.7152, 0.0722), color);\n}\nvec4 laserlineOutput(vec4 color) {\nfloat backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);\nfloat alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\nreturn color * alpha;\n}"])))):e.fragment.code.add((0,d.H)(c||(c=(0,u.Z)(["vec4 laserlineOutput(vec4 color) {\nreturn color * globalAlpha;\n}"]))))}},43505:function(e,t,n){n.d(t,{A:function(){return s},o:function(){return o}});var i,r=n(30168),a=n(98634);function s(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add((0,a.H)(i||(i=(0,r.Z)(["float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));\nreturn viewDirectionDistance*perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;\n}"]))))}function o(e,t,n){e.setUniform1f("perScreenPixelRatio",n.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},11606:function(e,t,n){n.d(t,{Q:function(){return z}});var i=n(1413),r=n(15671),a=n(43144),s=n(60136),o=n(29388),l=n(11186),c=n(71353),u=n(41414),h=n(25158),d=n(55158),f=n(23620),p=n(94425),v=n(56529),g=n(97731),m=n(33236),_=n(22909),b=n(27366),y=n(67077),P=n(43505),w=n(33280),E=n(15226),S=n(41012),x=n(82144),L=n(31132),C=n(33559),D=n(78041),V=n(27627),R=n(72511),k=n(36207),A=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new V.$(e.rctx,r,T)}},{key:"bindPass",value:function(e,t){var n=this.configuration,i=n.screenSizeEnabled,r=n.shadingEnabled,a=e.color,s=e.shadingTint,o=e.shadingDirection;(0,S.II)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",a),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,E.p)(this.program,t)),r&&(this.program.setUniform4fv("shadedColor",this.blendColor(Z,s,a)),this.program.setUniform3fv("shadingDirection",o),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&(0,P.o)(this.program,e,t)}},{key:"bindDraw",value:function(e){(0,S.id)(this.program,e),(0,S.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),(0,w.DA)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"blendColor",value:function(e,t,n){var i=1-t[3],r=t[3]+n[3]*i;return 0===r?(e[3]=r,e):(e[0]=(t[0]*t[3]+n[0]*n[3]*i)/r,e[1]=(t[1]*t[3]+n[1]*n[3]*i)/r,e[2]=(t[2]*t[3]+n[2]*n[3]*i)/r,e[3]=n[3],e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,n=3===e,i=2===e;return(0,k.sm)({blending:0!==t.output&&7!==t.output||!t.transparent?null:n?D.wu:(0,D.$L)(e),culling:(0,k.zp)(t.cullFace),depthTest:{func:i?513:t.shadingEnabled?515:513},depthWrite:n?t.writeDepth&&k.LZ:(0,D.Vc)(e),colorWrite:k.BK,polygonOffset:n||i?null:D.E0})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),n}(L.A);A.shader=new x.J(R.S,(function(){return n.e(6556).then(n.bind(n,36556))}));var M=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.writeDepth=!0,e.screenSizeEnabled=!0,e.shadingEnabled=!0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,a.Z)(n)}(C.m);(0,b._)([(0,C.o)({count:8})],M.prototype,"output",void 0),(0,b._)([(0,C.o)({count:3})],M.prototype,"cullFace",void 0),(0,b._)([(0,C.o)()],M.prototype,"slicePlaneEnabled",void 0),(0,b._)([(0,C.o)()],M.prototype,"transparent",void 0),(0,b._)([(0,C.o)()],M.prototype,"writeDepth",void 0),(0,b._)([(0,C.o)()],M.prototype,"screenSizeEnabled",void 0),(0,b._)([(0,C.o)()],M.prototype,"shadingEnabled",void 0),(0,b._)([(0,C.o)({count:4})],M.prototype,"transparencyPassType",void 0),(0,b._)([(0,C.o)()],M.prototype,"multipassTerrainEnabled",void 0),(0,b._)([(0,C.o)()],M.prototype,"cullAboveGround",void 0);var T=new Map([["position",0],["normal",1],["offset",2]]),Z=(0,y.c)(),z=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e,W)).supportsEdges=!0,i.techniqueConfig=new M,i._vertexAttributeLocations=T,i}return(0,a.Z)(n,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.screenSizeEnabled=this.parameters.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.parameters.shadingEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.parameters}},{key:"intersect",value:function(e,t,n,i,r,a,s){var o=this;if(this.parameters.screenSizeEnabled){var c=e.vertexAttributes.get("offset"),h={applyToVertex:function(e,t,n,r){var a=(0,l.s)(U,c.data[3*r+0],c.data[3*r+1],c.data[3*r+2]),s=(0,l.s)(F,e,t,n);return(0,l.a)(a,a,o.parameters.screenSize*i.camera.computeRenderPixelSizeAt(a)),(0,l.b)(s,s,a),[s[0],s[1],s[2]]},applyToAabb:function(e){var t=(0,u.be)(e,U);return(0,u.bA)(e,o.parameters.screenSize*i.camera.computeRenderPixelSizeAt(t))}};(0,_.Bw)(e,t,i,r,a,h,s)}else(0,_.Bw)(e,t,i,r,a,void 0,s)}},{key:"requiresSlot",value:function(e,t){if(4===(0,p.S)(t))return 2===e;var n=2;return this.parameters.transparent&&(n=this.parameters.writeDepth?4:7),e===n||20===e}},{key:"createGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new O(e):null}},{key:"createBufferWriter",value:function(){return new j(this.parameters.screenSizeEnabled)}}]),n}(v.F),O=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"updateParameters",value:function(e){return this.ensureTechnique(A,e)}},{key:"beginSlot",value:function(e){return this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.getPassParameters(),e)}}]),n}(f.Z),W=(0,i.Z)({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:(0,l.n)((0,c.c)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},v.z),j=function(){function e(t){(0,r.Z)(this,e),this.screenSizeEnabled=t;var n=(0,d.U$)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&n.vec3f("offset"),this.vertexBufferLayout=n}return(0,a.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,i){if((0,m.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,i),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");var r=t.vertexAttributes.get("offset"),a=t.indices.get("offset");(0,g.hu)(3===r.size);var s=n.getField("offset",h.ct);if(!s)throw new Error("unable to acquire view for offset");(0,m.ho)(a,r.data,e.invTranspTransformation,s,i)}}}]),e}(),U=(0,c.c)(),F=(0,c.c)()}}]);
//# sourceMappingURL=7728.885cf636.chunk.js.map