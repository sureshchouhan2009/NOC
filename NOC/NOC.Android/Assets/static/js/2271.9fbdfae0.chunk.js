"use strict";(self.webpackChunketihadrailapp=self.webpackChunketihadrailapp||[]).push([[2271],{38229:function(e,t,r){r.r(t),r.d(t,{default:function(){return R}});var n=r(1413),a=r(15861),i=r(15671),s=r(43144),u=r(60136),o=r(29388),p=r(87757),c=r(27366),l=r(32718),h=r(66978),d=r(49861),f=(r(63780),r(93169),r(25243),r(69912)),m=r(78983),v=r(90110),y=r(95986),g=r(34035),x=r(11752),w=r(61120),b=(r(75366),r(80613)),k=function(e){(0,u.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"renderChildren",value:function(e){if(e.drawPhase===b.jx.HIGHLIGHT&&(this.attributeView.bindTextures(e.context),this.children.some((function(e){return e.hasData})))){(0,x.Z)((0,w.Z)(r.prototype),"renderChildren",this).call(this,e);var t=e.painter.effects.highlight;t.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(16384),this._renderChildren(e,t.defines.concat(["highlightAll"])),t.draw(e),t.unbind()}}}]),r}(r(82022).Z),Z=k=(0,c._)([(0,f.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],k),C=r(9229),I=r(67581),_=r(93433),P=r(10064),E=r(92026),q=r(45948),F=r(44041),T=r(96669),V=r(819),G=r(24405),U=r(10141),A=r(13107),M=r(45008),S=l.Z.getLogger("esri.views.2d.layers.MapImageLayerView2D"),H=function(e){(0,u.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments))._highlightGraphics=new m.J,e}return(0,s.Z)(r,[{key:"update",value:function(e){this.strategy.update(e).catch((function(e){(0,h.D_)(e)||S.error(e)}))}},{key:"attach",value:function(){var e=this,t=this.layer,r=t.imageMaxWidth,n=t.imageMaxHeight,a=t.version,i=a>=10.3,s=a>=10;this._bitmapContainer=new v.c,this.container.addChild(this._bitmapContainer);var u=new g.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new Z(this.view.featuresTilingScheme)});this.container.addChild(u.container),this.strategy=new C.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:r,imageMaxHeight:n,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.handles.add(this.watch("exportImageVersion",(function(){return e.requestUpdate()})),"exportImageVersion"),this.handles.add(this.watch("view.floors",(function(){return e.requestUpdate()})),"view.floors"),this.requestUpdate()}},{key:"detach",value:function(){this.handles.remove("exportImageVersion"),this.handles.remove("view.floors"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"highlight",value:function(e,t){var r=this;return this._highlightGraphics.add(e),{remove:function(){r._highlightGraphics.remove(e)}}}},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return(0,M.K)(e,t,this.view)}},{key:"doRefresh",value:function(){var e=(0,a.Z)(p.mark((function e(){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,r,a){return this.layer.fetchImage(e,t,r,(0,n.Z)({timeExtent:this.timeExtent,floors:this.view.floors},a))}}]),r}(function(e){var t=function(e){(0,u.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"initialize",value:function(){this.exportImageParameters=new F.R({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters.destroy(),this.exportImageParameters=null}},{key:"exportImageVersion",get:function(){var e;return null==(e=this.exportImageParameters)||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}},{key:"fetchPopupFeatures",value:function(){var e=(0,a.Z)(p.mark((function e(t,r){var i,s,u,o,c,l,d=this;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new P.Z("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i})));case 3:return s=this.get("view.scale"),u=[],o=function(){var e=(0,a.Z)(p.mark((function e(t){var a,i,c;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0===t.minScale||s<=t.minScale,i=0===t.maxScale||s>=t.maxScale,t.visible&&a&&i&&(t.sublayers?t.sublayers.forEach(o):t.popupEnabled&&(c=(0,G.V)(t,(0,n.Z)((0,n.Z)({},r),{},{defaultPopupTemplateEnabled:!1})),(0,E.pC)(c)&&u.unshift({sublayer:t,popupTemplate:c})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=i.sublayers.toArray().reverse().map(o),e.next=6,Promise.all(c);case 6:return l=u.map(function(){var e=(0,a.Z)(p.mark((function e(n){var a,i,s,u,o,c,l,h,f,m,v;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.sublayer,i=n.popupTemplate,e.next=3,a.load().catch((function(){}));case 3:return s=a.createQuery(),u=(0,E.pC)(r)?r.event:null,o=(0,T.k)({renderer:a.renderer,event:u}),c=d.createFetchPopupFeaturesQueryGeometry(t,o),s.geometry=c,e.next=7,(0,G.e)(a,i);case 7:if(s.outFields=e.sent,"map-image"!==d.layer.type||!("floors"in d.view)){e.next=11;break}f=null==(l=d.view)||null==(h=l.floors)?void 0:h.clone(),m=(0,U.ff)(f,a),(0,E.pC)(m)&&(s.where=s.where?"(".concat(s.where,") AND (").concat(m,")"):m);case 11:return e.next=13,d._loadArcadeModules(i);case 13:return(v=e.sent)&&v.arcadeUtils.hasGeometryOperations(i)||(s.maxAllowableOffset=c.width/o),e.next=17,a.queryFeatures(s);case 17:return e.abrupt("return",e.sent.features);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,(0,h.as)(l);case 9:return e.abrupt("return",e.sent.reduce((function(e,t){return t.value?[].concat((0,_.Z)(e),(0,_.Z)(t.value)):e}),[]).filter((function(e){return null!=e})));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e;return!!(0,x.Z)((0,w.Z)(r.prototype),"canResume",this).call(this)&&(null==(e=this.timeExtent)||!e.isEmpty)}},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length")||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type})))return(0,V.LC)()}}]),r}(e);return(0,c._)([(0,d.Cb)()],t.prototype,"exportImageParameters",void 0),(0,c._)([(0,d.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,c._)([(0,d.Cb)()],t.prototype,"layer",void 0),(0,c._)([(0,d.Cb)()],t.prototype,"suspended",void 0),(0,c._)([(0,d.Cb)(q.qG)],t.prototype,"timeExtent",void 0),t=(0,c._)([(0,f.j)("esri.views.layers.MapImageLayerView")],t)}((0,A.y)((0,y.y)(I.Z))));(0,c._)([(0,d.Cb)()],H.prototype,"strategy",void 0),(0,c._)([(0,d.Cb)()],H.prototype,"updating",void 0);var R=H=(0,c._)([(0,f.j)("esri.views.2d.layers.MapImageLayerView2D")],H)},24405:function(e,t,r){r.d(t,{V:function(){return c},e:function(){return o}});var n=r(93433),a=r(15861),i=r(87757),s=r(92026),u=r(37270);function o(e){return p.apply(this,arguments)}function p(){return p=(0,a.Z)(i.mark((function e(t){var r,a,o,p,c,l,h,d,f,m=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:t.popupTemplate,(0,s.pC)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(a=e.sent,o=r.lastEditInfoEnabled,p=t.objectIdField,c=t.typeIdField,l=t.globalIdField,h=t.relationships,!a.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!o){e.next=19;break}return e.next=16,(0,u.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return d=e.t0,f=(0,u.Q0)(t.fieldsIndex,[].concat((0,n.Z)(a),(0,n.Z)(d))),e.abrupt("return",(c&&f.push(c),f&&p&&t.fieldsIndex.has(p)&&-1===f.indexOf(p)&&f.push(p),f&&l&&t.fieldsIndex.has(l)&&-1===f.indexOf(l)&&f.push(l),h&&h.forEach((function(e){var r=e.keyField;f&&r&&t.fieldsIndex.has(r)&&-1===f.indexOf(r)&&f.push(r)})),f));case 23:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}function c(e,t){return e.popupTemplate?e.popupTemplate:(0,s.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,s.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=2271.9fbdfae0.chunk.js.map