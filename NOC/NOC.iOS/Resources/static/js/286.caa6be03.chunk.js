"use strict";(self.webpackChunketihadrailapp=self.webpackChunketihadrailapp||[]).push([[286,5069],{65069:function(e,t,i){i.r(t),i.d(t,{default:function(){return x}});var n=i(15671),o=i(43144),r=i(97326),a=i(60136),s=i(29388),l=i(27366),d=i(93002),p=i(92026),c=i(97642),u=i(49861),h=(i(63780),i(93169),i(23879)),v=(i(25243),i(69912)),_=i(31201),y=i(74184),f=i(6693),w=i(6061),g=i(29598),m=i(56811),k=i(84938),C=i(16791),T=i(41190),b=function(e){(0,a.Z)(i,e);var t=(0,s.Z)(i);function i(e){var o;return(0,n.Z)(this,i),(o=t.call(this,e))._visibilityHandles={},o.fullExtent=void 0,o.operationalLayerType="GroupLayer",o.spatialReference=void 0,o.type="group",o._visibilityWatcher=o._visibilityWatcher.bind((0,r.Z)(o)),o}return(0,o.Z)(i,[{key:"initialize",value:function(){this._enforceVisibility(this.visibilityMode,this.visible),this.watch("visible",this._visibleWatcher.bind(this),!0)}},{key:"_writeLayers",value:function(e,t,i,n){var o=[];if(!e)return o;e.forEach((function(e){var t=(0,T.Nw)(e,n.webmap?n.webmap.getLayerJSONFromResourceInfo(e):null,n);(0,p.pC)(t)&&t.layerType&&o.push(t)})),t.layers=o}},{key:"portalItem",set:function(e){this._set("portalItem",e)}},{key:"visibilityMode",set:function(e){var t=this._get("visibilityMode")!==e;this._set("visibilityMode",e),t&&this._enforceVisibility(e,this.visible)}},{key:"load",value:function(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},e)),Promise.resolve(this)}},{key:"loadAll",value:function(){var e=this;return(0,d.GZ)(this,(function(t){t(e.layers)}))}},{key:"layerAdded",value:function(e){e.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(e):"inherited"===this.visibilityMode&&(e.visible=this.visible),this._visibilityHandles[e.uid]=e.watch("visible",this._visibilityWatcher,!0)}},{key:"layerRemoved",value:function(e){var t=this._visibilityHandles[e.uid];t&&(t.remove(),delete this._visibilityHandles[e.uid]),this._enforceVisibility(this.visibilityMode,this.visible)}},{key:"_turnOffOtherLayers",value:function(e){this.layers.forEach((function(t){t!==e&&(t.visible=!1)}))}},{key:"_enforceVisibility",value:function(e,t){if((0,h.vw)(this).initialized){var i=this.layers,n=i.find((function(e){return e.visible}));switch(e){case"exclusive":i.length&&!n&&((n=i.getItemAt(0)).visible=!0),this._turnOffOtherLayers(n);break;case"inherited":i.forEach((function(e){e.visible=t}))}}}},{key:"_visibleWatcher",value:function(e){"inherited"===this.visibilityMode&&this.layers.forEach((function(t){t.visible=e}))}},{key:"_visibilityWatcher",value:function(e,t,i,n){var o=n;switch(this.visibilityMode){case"exclusive":e?this._turnOffOtherLayers(o):this._isAnyLayerVisible()||(o.visible=!0);break;case"inherited":o.visible=this.visible}}},{key:"_isAnyLayerVisible",value:function(){return this.layers.some((function(e){return e.visible}))}}]),i}((0,f.h)((0,m.M)((0,w.q)((0,g.I)((0,C.Q)((0,k.K)((0,c.R)(y.Z))))))));(0,l._)([(0,u.Cb)()],b.prototype,"fullExtent",void 0),(0,l._)([(0,u.Cb)({json:{read:!1,write:{ignoreOrigin:!0}}})],b.prototype,"layers",void 0),(0,l._)([(0,_.c)("layers")],b.prototype,"_writeLayers",null),(0,l._)([(0,u.Cb)({type:["GroupLayer"]})],b.prototype,"operationalLayerType",void 0),(0,l._)([(0,u.Cb)({json:{origins:{"web-document":{read:!1,write:!1}}}})],b.prototype,"portalItem",null),(0,l._)([(0,u.Cb)()],b.prototype,"spatialReference",void 0),(0,l._)([(0,u.Cb)({json:{read:!1},readOnly:!0,value:"group"})],b.prototype,"type",void 0),(0,l._)([(0,u.Cb)({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{read:!1,write:!1}}}})],b.prototype,"visibilityMode",null);var x=b=(0,l._)([(0,v.j)("esri.layers.GroupLayer")],b)},85577:function(e,t,i){i.d(t,{r:function(){return C}});var n=i(93433),o=i(15671),r=i(43144),a=i(60136),s=i(29388),l=(i(59486),i(52639)),d=(i(51508),i(42537)),p=i(17842),c=i(88396),u=i(6394),h=i(71353),v=i(70040),_=i(76014),y=i(38561),f=i(16072),w=i(16851),g=i(75021),m=i(7882),k=i(29909),C=function(e){(0,a.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,o.Z)(this,i),(n=t.call(this)).graphicsLayer=e,n}return(0,r.Z)(i,[{key:"visualizeIntersectionPoint",value:function(e,t){return this._visualizeSnappingIndicator(new m.Z({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.coordinateHelper.spatialReference}),x)}},{key:"visualizePoint",value:function(e,t){return this._visualizeSnappingIndicator(new m.Z({x:e.point[0],y:e.point[1],spatialReference:t.coordinateHelper.spatialReference}),O)}},{key:"visualizeLine",value:function(e,t){return this._visualizeSnappingIndicator(new k.Z({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),P)}},{key:"visualizeParallelSign",value:function(e,t){return this._visualizeSnappingIndicator(new k.Z({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),V)}},{key:"visualizeRightAngleQuad",value:function(e,t){return this._visualizeSnappingIndicator(new k.Z({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.coordinateHelper.spatialReference}),I(e))}},{key:"_visualizeSnappingIndicator",value:function(e,t){var i=this,n=new l.Z({geometry:e,symbol:t});return this.graphicsLayer.add(n),(0,d.kB)((function(){i.graphicsLayer.remove(n)}))}}]),i}(y.a),T=v.O.main.toArray(),b=[].concat((0,n.Z)(v.O.main.toRgb()),[100]),x=new f.default({outline:new w.default({width:1.5,color:T}),size:15,color:[0,0,0,0]}),O=new f.default({outline:{width:.5,color:[0,0,0,1]},size:10,color:T}),P=new g.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,p.Wz)(_.c.lineHintWidthTarget),color:T}]}}}),V=new g.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:T}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:T}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),H=function(e){return new g.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,p.Wz)(_.c.rightAngleHintSize),rotation:e,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,p.Wz)(_.c.rightAngleHintOutlineSize),color:T},{type:"CIMSolidFill",enable:!0,color:b}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})},Z=H(45),S=H(225),I=function(){var e=(0,u.a)(),t=(0,u.a)(),i=(0,h.c)();return function(n){return(0,c.f)(e,n.centerVertex,n.previousVertex),(0,c.f)(t,n.nextVertex,n.previousVertex),(0,c.j)(i,e,t),i[2]<0?Z:S}}()},59968:function(e,t,i){i.d(t,{Z:function(){return ne}});var n,o=i(1413),r=i(15671),a=i(43144),s=i(60136),l=i(29388),d=i(27366),p=i(85015),c=(i(93169),i(49861)),u=(i(63780),i(25243),i(69912)),h=i(93433),v=i(11752),_=i(61120),y=(i(59486),i(100)),f=i(92026),w=i(32718),g=(i(75366),i(15861)),m=i(87757),k=i(91505),C=i(66978),T=i(17842),b=i(93655),x=i(65618),O=i(85577),P=i(14813),V=i(84954),H=i(87268),Z=i(34019),S=n=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e){var o,a;return(0,r.Z)(this,i),(o=t.call(this,e))._hasZ=null,o._cursorScreenPoint=null,o._snappingTask=null,o._stagedVertex=null,o._stagedVertexUnsnapped=null,o._lastVertexUnsnapped=null,o._nativeEventHistory={undoStack:[],redoStack:[]},o.interactiveUndoDisabled=!1,o.history=[],o.redoHistory=[],o.snapToScene=!1,o.view=null,o.elevationInfo=null,o.defaultZ=0,o._coordinateHelper=(0,P.Y6)(e.hasZ,!1,e.view.spatialReference),o._snappingManager=e.snappingManager,o._editGeometryOperations=new H.c(new V.XE(null!=(a=e.editGeometryType)?a:"polygon",o._coordinateHelper,2)),o._snappingGraphicsLayer=new b.Z({id:n.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),o._snappingContext=new Z.N({editGeometryOperations:o._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new O.r(o._snappingGraphicsLayer)}),o._activeComponent=new V.wA(e.view.spatialReference,2),o._editGeometryOperations.data.components.push(o._activeComponent),o}return(0,a.Z)(i,[{key:"initialize",value:function(){"2d"===this.view.type&&this.view.map.layers.add(this._snappingGraphicsLayer)}},{key:"destroy",value:function(){this._snappingTask=(0,f.IM)(this._snappingTask),this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),(0,f.pC)(this._snappingManager)&&this._snappingManager.doneSnapping(),this._editGeometryOperations.destroy()}},{key:"_committedVertices",get:function(){return this._editGeometryOperations.data.components[0].vertices.map((function(e){return e.pos}))}},{key:"vertices",get:function(){return(0,f.pC)(this._stagedVertex)?[].concat((0,h.Z)(this._committedVertices),[this._coordinateHelper.pointToArray(this._stagedVertex)]):this._committedVertices}},{key:"hasZ",get:function(){return(0,f.pC)(this._hasZ)?this._hasZ:"3d"===this.view.type},set:function(e){this._hasZ=e,this.notifyChange("hasZ")}},{key:"canUndo",value:function(){return this._editGeometryOperations.canUndo}},{key:"canRedo",value:function(){return this._editGeometryOperations.canRedo}},{key:"undo",value:function(){this.canUndo&&this._editGeometryOperations.undo()}},{key:"redo",value:function(){this.canRedo&&this._editGeometryOperations.redo()}},{key:"getCoordsFromScreenPoint",value:function(e){var t=this.screenToMap(e);return(0,f.pC)(t)?t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]:null}},{key:"getCoordsAndPointFromScreenPoint",value:function(e){var t=this.screenToMap(e);return(0,f.pC)(t)?t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}:null}},{key:"_pushCursorVertex",value:function(e){var t=this,i=(0,x.Tx)(e[0],e[1],null,this.view.spatialReference);this._stagedVertexUnsnapped=i,(0,f.Wi)(this._snappingManager)?this._stagedVertex=i:(this._stagedVertex=this._snappingManager.update(i,this._snappingContext),this._snappingTask=(0,C.vr)(function(){var e=(0,g.Z)(m.mark((function e(n){var o;return m.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,f.pC)(t._snappingManager)){e.next=5;break}return e.next=3,t._snappingManager.snap(i,t._snappingContext,n);case 3:return o=e.sent,e.abrupt("return",(o.valid&&(t._stagedVertex=o.apply(),t.notifyChange("vertices")),o));case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}},{key:"_popCursorVertex",value:function(){this._stagedVertex=null,this._stagedVertexUnsnapped=null,this.notifyChange("vertices")}},{key:"getGeometryZValue",value:function(){return this.defaultZ}},{key:"screenToMap",value:function(e){var t=null;if("3d"===this.view.type)if(this.hasZ){var i=(0,f.Pt)(this.elevationInfo,I);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,T.s1)(e.x,e.y),i,this.getGeometryZValue())}else{var n=(0,f.Pt)(this.elevationInfo,M);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,T.s1)(e.x,e.y),n,0),(0,f.pC)(t)&&(t.z=void 0)}else t=this.view.toMap(e),(0,f.pC)(t)&&(t.z=this.hasZ?this.getGeometryZValue():void 0);return t}},{key:"_isDuplicateOfLastVertex",value:function(e){var t=this._editGeometryOperations.data.components[0].getLastVertex();if((0,f.pC)(t)&&e[0]===t[0]&&e[1]===t[1])return!0;var i=this._coordinateHelper.vectorToDehydratedPoint(e),n=i.x,o=i.y;return!(!(0,f.pC)(this._lastVertexUnsnapped)||n!==this._lastVertexUnsnapped.x||o!==this._lastVertexUnsnapped.y)}},{key:"_vertexAddHandler",value:function(e){var t=(0,f.pC)(this._stagedVertex)?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);(0,f.pC)(t)&&this._addVertex(t,e.native)}},{key:"_drawCompleteHandler",value:function(e){this._completeDrawing(e.native)}}]),i}(k.Z.EventedAccessor);S.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",(0,d._)([(0,c.Cb)({readOnly:!0})],S.prototype,"vertices",null),(0,d._)([(0,c.Cb)({type:Boolean,nonNullable:!0})],S.prototype,"interactiveUndoDisabled",void 0),(0,d._)([(0,c.Cb)({readOnly:!0})],S.prototype,"history",void 0),(0,d._)([(0,c.Cb)({readOnly:!0})],S.prototype,"redoHistory",void 0),(0,d._)([(0,c.Cb)()],S.prototype,"snapToScene",void 0),(0,d._)([(0,c.Cb)()],S.prototype,"view",void 0),(0,d._)([(0,c.Cb)()],S.prototype,"elevationInfo",void 0),(0,d._)([(0,c.Cb)({nonNullable:!0})],S.prototype,"defaultZ",void 0),(0,d._)([(0,c.Cb)()],S.prototype,"hasZ",null),S=n=(0,d._)([(0,u.j)("esri.views.draw.DrawAction")],S);var I={mode:"absolute-height",offset:0},M={mode:"on-the-ground",offset:0},A=S,E=function(){function e(t,i,n,o){(0,r.Z)(this,e),this.view=t,this.native=i,this.vertexIndex=n,this.vertices=o,this.defaultPrevented=!1,this.type="vertex-add"}return(0,a.Z)(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),e}(),L=function(){function e(t,i,n,o){(0,r.Z)(this,e),this.view=t,this.native=i,this.vertexIndex=n,this.vertices=o,this.defaultPrevented=!1,this.type="vertex-remove"}return(0,a.Z)(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),e}(),D=function(){function e(t,i,n,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,r.Z)(this,e),this.view=t,this.native=i,this.vertexIndex=n,this.vertices=o,this.mapPoint=a,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===o.length?o[0]:null}return(0,a.Z)(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),e}(),R=function(){function e(t,i){(0,r.Z)(this,e),this.native=t,this.vertices=i,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===i.length?i[0]:null}return(0,a.Z)(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),e}(),U=i(31235),G=i(87888),j=i(72612),z=i(7882),F=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e))._popVertexOnPointerMove=!1,n._addVertexOnPointerUp=!1,n._activePointerId=null,n._viewHandles=new y.Z,n._undoRedoHandles=new y.Z,n}return(0,a.Z)(i,[{key:"initialize",value:function(){this._addViewHandles(),this._addUndoRedoHandles()}},{key:"destroy",value:function(){this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy(),this.emit("destroy")}},{key:"undo",value:function(){(0,v.Z)((0,_.Z)(i.prototype),"undo",this).call(this),this.notifyChange("vertices")}},{key:"redo",value:function(){(0,v.Z)((0,_.Z)(i.prototype),"redo",this).call(this),this.notifyChange("vertices")}},{key:"complete",value:function(){this._completeDrawing()}},{key:"_addViewHandles",value:function(){var e=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(function(e){e.stopPropagation()}),U.f.TOOL),this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=t.pointerId,e._addVertexOnPointerUp=!0,e._cursorScreenPoint=(0,j.vT)(t),"touch"===t.pointerType&&e._updateCursor(t.native))}),U.f.TOOL),this.view.on("pointer-move",(function(t){e._popVertexOnPointerMove&&(e.undo(),e._popVertexOnPointerMove=!1),e._snappingTask=(0,f.IM)(e._snappingTask),e._cursorScreenPoint=(0,j.vT)(t),"touch"!==t.pointerType&&e._updateCursor(t.native)}),U.f.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._addVertexOnPointerUp=!1)}),U.f.TOOL),this.view.on("pointer-up",(function(t){if(e._shouldHandlePointerEvent(t))if(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=null,e._addVertexOnPointerUp)e._vertexAddHandler(t);else{var i="touch"===t.pointerType;e._updateCursor(t.native,i)}}),U.f.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),U.f.TOOL),this.view.on("double-click",(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),U.f.TOOL),this.view.on("double-click",["Control"],(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),U.f.TOOL),this.view.on("key-down",(function(t){var i=t.key,n=t.repeat;i===G.j.vertexAdd&&!n&&e._cursorScreenPoint?(t.stopPropagation(),e._snappingTask=(0,f.IM)(e._snappingTask),e._vertexAddHandler(t)):i!==G.j.complete||n?i!==G.j.undo||e.interactiveUndoDisabled||n?i!==G.j.redo||e.interactiveUndoDisabled||n?i!==G.j.pan||n||t.stopPropagation():(t.stopPropagation(),e.redo()):(t.stopPropagation(),e.undo()):(t.stopPropagation(),e._drawCompleteHandler(t))}),U.f.TOOL),this.view.on("key-up",(function(e){e.key===G.j.pan&&e.stopPropagation()}),U.f.TOOL)])}},{key:"_addUndoRedoHandles",value:function(){var e=this;this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometryOperations.on("vertex-remove",(function(t){if(e.notifyChange("vertices"),"undo"===t.operation){var i=e._nativeEventHistory.undoStack.pop();e._nativeEventHistory.redoStack.push(i);var n=(0,h.Z)(e._committedVertices);(0,f.pC)(e._stagedVertex)&&n.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("undo",new L(e.view,i,t.vertices[0].index,n))}})),this._editGeometryOperations.on("vertex-add",(function(t){if(e.notifyChange("vertices"),"apply"===t.operation){var i=e._nativeEventHistory.undoStack[e._nativeEventHistory.undoStack.length],n=e._committedVertices.length-1,o=new E(e.view,i,n,e.vertices);e.emit("vertex-add",o),o.defaultPrevented&&(e._popVertexOnPointerMove=!0)}else if("redo"===t.operation){var r=e._nativeEventHistory.redoStack.pop();e._nativeEventHistory.undoStack.push(r);var a=(0,h.Z)(e._committedVertices);(0,f.pC)(e._stagedVertex)&&a.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("redo",new E(e.view,r,t.vertices[0].index,a))}}))])}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_removeUndoRedoHandles",value:function(){this._undoRedoHandles.removeAll()}},{key:"_addVertex",value:function(e,t){var i=this._coordinateHelper.arrayToVector(e);if(!this._isDuplicateOfLastVertex(i)){this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(i);var n=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(n)}}},{key:"_updateCursor",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._popCursorVertex(),this._cursorScreenPoint){var n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if((0,f.pC)(n)&&!i){this._pushCursorVertex(n.vertex);var o=function(){return new D(t.view,e,t._activeComponent.vertices.length,t.vertices,(0,f.pC)(t._stagedVertex)?new z.Z(t._stagedVertex):null)};this.emit("cursor-update",o()),(0,f.pC)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",o())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){if(this._activePointerId=null,this._popCursorVertex(),this._snappingTask=(0,f.IM)(this._snappingTask),(0,f.pC)(this._snappingManager)&&this._snappingManager.doneSnapping(),!(this.vertices.length<1)){var t=new R(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&((0,f.Wi)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(A);F=(0,d._)([(0,u.j)("esri.views.draw.MultipointDrawAction")],F);Object.freeze({__proto__:null,get MultipointDrawAction(){return F}});var W=i(44927),N=i(41691),B=i(66038),Y=i(54016),X=i(45900),q=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e)).defaultZ=0,n.elevationInfo=null,n.hasZ=!0,n.mode=null,n.snapToScene=null,n.type="draw-3d",n}return(0,a.Z)(i,[{key:"initialize",value:function(){var e=this,t=(0,f.Pt)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0}),i=this.view;this.drawOperation=new B.w({view:i,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:"3d"===i.type?new Y.iW(i,t):null,elevationDrawSurface:"3d"===i.type?new Y.aL(t,this.defaultZ,i):null,hasM:!1,elevationInfo:t}),this.handles.add([this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)}))]),this.complete()}},{key:"destroy",value:function(){this.drawOperation=(0,f.SC)(this.drawOperation),this._set("view",null)}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"updating",get:function(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"onDeactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"getVertexCoords",value:function(){return this.drawOperation.vertices}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"reset",value:function(){}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"onComplete",value:function(e){this.emit("complete",e)}},{key:"onCursorUpdate",value:function(e){this.emit("cursor-update",e)}},{key:"onVertexAdd",value:function(e){this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this.emit("vertex-update",e)}}]),i}((0,N.p)(k.Z.EventedMixin(X.m)));(0,d._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],q.prototype,"defaultZ",void 0),(0,d._)([(0,c.Cb)()],q.prototype,"drawOperation",void 0),(0,d._)([(0,c.Cb)({constructOnly:!0})],q.prototype,"elevationInfo",void 0),(0,d._)([(0,c.Cb)({value:!0})],q.prototype,"enabled",null),(0,d._)([(0,c.Cb)({constructOnly:!0})],q.prototype,"geometryType",void 0),(0,d._)([(0,c.Cb)({constructOnly:!0})],q.prototype,"hasZ",void 0),(0,d._)([(0,c.Cb)({constructOnly:!0})],q.prototype,"mode",void 0),(0,d._)([(0,c.Cb)()],q.prototype,"snapToScene",void 0),(0,d._)([(0,c.Cb)({readOnly:!0})],q.prototype,"type",void 0),(0,d._)([(0,c.Cb)({readOnly:!0})],q.prototype,"updating",null),(0,d._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],q.prototype,"view",void 0),q=(0,d._)([(0,u.j)("esri.views.draw.DrawTool")],q);var J=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e))._addVertexOnPointerUp=!1,n._activePointerId=null,n._viewHandles=new y.Z,n}return(0,a.Z)(i,[{key:"initialize",value:function(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}},{key:"destroy",value:function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}},{key:"coordinates",get:function(){return(0,W.Mr)(w.Z.getLogger("esri.views.draw.PointDrawAction"),"coordinates",{replacement:"vertices",version:"4.19"}),this.vertices[0]}},{key:"complete",value:function(){"2d"===this.view.type?this._cursorScreenPoint&&this._completeDrawing():this._drawTool.completeCreateOperation()}},{key:"_addViewHandles",value:function(){var e=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=t.pointerId,e._addVertexOnPointerUp=!0,e._cursorScreenPoint=(0,j.vT)(t),"touch"===t.pointerType&&e._updateCursor(t.native))}),U.f.TOOL),this.view.on("pointer-move",(function(t){e._snappingTask=(0,f.IM)(e._snappingTask),e._cursorScreenPoint=(0,j.vT)(t),"touch"!==t.pointerType&&e._updateCursor(t.native)}),U.f.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._addVertexOnPointerUp=!1)}),U.f.TOOL),this.view.on("pointer-up",(function(t){if(e._shouldHandlePointerEvent(t))if(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=null,e._addVertexOnPointerUp)t.stopPropagation(),e._vertexAddHandler(t);else{var i="touch"===t.pointerType;e._updateCursor(t.native,i)}}),U.f.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),U.f.TOOL),this.view.on("key-down",(function(t){t.key===G.j.complete&&e._cursorScreenPoint&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._vertexAddHandler(t))}),U.f.TOOL)])}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_addDrawTool",value:function(e){var t=this;this._drawTool=new q({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"}),this.view.addAndActivateTool(this._drawTool),this._drawTool.on("cursor-update",(function(e){1===e.vertices.length&&t.emit("cursor-update",new D(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(function(e){t.emit("draw-complete",new R(null,t._drawTool.getVertexCoords())),t._removeDrawTool()}))}},{key:"_removeDrawTool",value:function(){this.view.tools.remove(this._drawTool),this._drawTool=(0,f.SC)(this._drawTool)}},{key:"_addVertex",value:function(e){var t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),this.notifyChange("vertices"),this._completeDrawing())}},{key:"_updateCursor",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._popCursorVertex(),this._cursorScreenPoint){var n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if((0,f.pC)(n)&&!i){this._pushCursorVertex(n.vertex);var o=function(){return new D(t.view,e,t._activeComponent.vertices.length,t.vertices,(0,f.pC)(t._stagedVertex)?new z.Z(t._stagedVertex):null)};this.emit("cursor-update",o()),(0,f.pC)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",o())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){this._activePointerId=null,this._popCursorVertex(),this._snappingTask=(0,f.IM)(this._snappingTask),(0,f.pC)(this._snappingManager)&&this._snappingManager.doneSnapping();var t=new R(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&((0,f.Wi)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(A);(0,d._)([(0,c.Cb)({readOnly:!0})],J.prototype,"coordinates",null),J=(0,d._)([(0,u.j)("esri.views.draw.PointDrawAction")],J);var K=i(78005),Q=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e))._panEnabled=!1,n._popVertexOnPointerMove=!1,n._addVertexOnPointerUp=!1,n._activePointerId=null,n._viewHandles=new y.Z,n._undoRedoHandles=new y.Z,n.mode=K.n,n}return(0,a.Z)(i,[{key:"initialize",value:function(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool(this.view)}},{key:"destroy",value:function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}},{key:"_dragEnabled",get:function(){return"freehand"===this.mode||"hybrid"===this.mode}},{key:"_clickEnabled",get:function(){return"click"===this.mode||"hybrid"===this.mode}},{key:"undo",value:function(){(0,v.Z)((0,_.Z)(i.prototype),"undo",this).call(this),this.notifyChange("vertices")}},{key:"redo",value:function(){(0,v.Z)((0,_.Z)(i.prototype),"redo",this).call(this),this.notifyChange("vertices")}},{key:"complete",value:function(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}},{key:"getGeometryZValue",value:function(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}},{key:"_addViewHandles",value:function(){var e=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(function(e){e.stopPropagation()}),U.f.TOOL),this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=t.pointerId,e._addVertexOnPointerUp=!0,e._cursorScreenPoint=(0,j.vT)(t),"touch"===t.pointerType&&e._updateCursor(t.native))}),U.f.TOOL),this.view.on("pointer-move",(function(t){e._snappingTask=(0,f.IM)(e._snappingTask),e._popVertexOnPointerMove&&(e.undo(),e._popVertexOnPointerMove=!1),e._cursorScreenPoint=(0,j.vT)(t),"touch"!==t.pointerType&&e._updateCursor(t.native)}),U.f.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._cursorScreenPoint=(0,j.vT)(t),e._dragEnabled&&!e._panEnabled?e._vertexAddHandler(t):e._addVertexOnPointerUp=!1)}),U.f.TOOL),this.view.on("pointer-up",(function(t){if(e._shouldHandlePointerEvent(t))if(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=null,e._addVertexOnPointerUp){if(!e._clickEnabled)return 1===e.vertices.length&&e.vertices.pop(),void e._drawCompleteHandler(t);e._vertexAddHandler(t)}else{var i="touch"===t.pointerType;e._updateCursor(t.native,i)}}),U.f.TOOL),this.view.on("drag",(function(t){e._dragEnabled&&(0,f.pC)(e._activePointerId)&&!e._panEnabled&&t.stopPropagation()}),U.f.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),U.f.TOOL),this.view.on("double-click",(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),U.f.TOOL),this.view.on("double-click",["Control"],(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),U.f.TOOL),this.view.on("key-down",(function(t){var i=t.key,n=t.repeat;i===G.j.vertexAdd&&!n&&e._cursorScreenPoint?(t.stopPropagation(),e._snappingTask=(0,f.IM)(e._snappingTask),e._vertexAddHandler(t)):i!==G.j.complete||n?i!==G.j.undo||e.interactiveUndoDisabled||n?i!==G.j.redo||e.interactiveUndoDisabled||n?i!==G.j.pan||n||(t.stopPropagation(),e._panEnabled=!0):(t.stopPropagation(),e.redo()):(t.stopPropagation(),e.undo()):(t.stopPropagation(),e._drawCompleteHandler(t))}),U.f.TOOL),this.view.on("key-up",(function(t){t.key===G.j.pan&&(t.stopPropagation(),e._panEnabled=!1)}),U.f.TOOL)])}},{key:"_addUndoRedoHandles",value:function(){var e=this;this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometryOperations.on("vertex-remove",(function(t){if(e.notifyChange("vertices"),"undo"===t.operation){var i=e._nativeEventHistory.undoStack.pop();e._nativeEventHistory.redoStack.push(i);var n=(0,h.Z)(e._committedVertices);(0,f.pC)(e._stagedVertex)&&n.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("undo",new L(e.view,i,t.vertices[0].index,n))}})),this._editGeometryOperations.on("vertex-add",(function(t){if(e.notifyChange("vertices"),"apply"===t.operation){var i=e._nativeEventHistory.undoStack[e._nativeEventHistory.undoStack.length],n=e._committedVertices.length-1,o=new E(e.view,i,n,e.vertices);e.emit("vertex-add",o),o.defaultPrevented&&(e._popVertexOnPointerMove=!0)}else if("redo"===t.operation){var r=e._nativeEventHistory.redoStack.pop();e._nativeEventHistory.undoStack.push(r);var a=(0,h.Z)(e._committedVertices);(0,f.pC)(e._stagedVertex)&&a.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("redo",new E(e.view,r,t.vertices[0].index,a))}}))])}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_removeUndoRedoHandles",value:function(){this._undoRedoHandles.removeAll()}},{key:"_addDrawTool",value:function(e){var t=this;this._drawTool=new q({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode}),this.view.addAndActivateTool(this._drawTool),this._drawTool.on("vertex-add",(function(e){1===e.vertices.length&&t.emit("vertex-add",new E(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(function(e){1===e.vertices.length&&t.emit("cursor-update",new D(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(function(e){t.emit("draw-complete",new R(null,t._drawTool.getVertexCoords())),t._removeDrawTool()}))}},{key:"_removeDrawTool",value:function(){this.view.tools.remove(this._drawTool),this._drawTool=(0,f.SC)(this._drawTool)}},{key:"_addVertex",value:function(e,t){var i=this._coordinateHelper.arrayToVector(e);if(!this._isDuplicateOfLastVertex(i)){this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(i);var n=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(n)}}},{key:"_updateCursor",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._popCursorVertex(),this._cursorScreenPoint){var n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if((0,f.pC)(n)&&!i){this._pushCursorVertex(n.vertex);var o=function(){return new D(t.view,e,t._activeComponent.vertices.length,t.vertices,(0,f.pC)(t._stagedVertex)?new z.Z(t._stagedVertex):null)};this.emit("cursor-update",o()),(0,f.pC)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",o())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){if(this._activePointerId=null,this._popCursorVertex(),!(this._committedVertices.length<3)){this._snappingTask=(0,f.IM)(this._snappingTask),(0,f.pC)(this._snappingManager)&&this._snappingManager.doneSnapping();var t=new R(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&((0,f.Wi)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(A);(0,d._)([(0,c.Cb)()],Q.prototype,"_dragEnabled",null),(0,d._)([(0,c.Cb)()],Q.prototype,"_clickEnabled",null),(0,d._)([(0,c.Cb)({type:K.A})],Q.prototype,"mode",void 0),Q=(0,d._)([(0,u.j)("esri.views.draw.PolygonDrawAction")],Q);var $=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e))._panEnabled=!1,n._popVertexOnPointerMove=!1,n._addVertexOnPointerUp=!1,n._activePointerId=null,n._viewHandles=new y.Z,n._undoRedoHandles=new y.Z,n.mode=K.n,n}return(0,a.Z)(i,[{key:"initialize",value:function(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool(this.view)}},{key:"destroy",value:function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}},{key:"_clickEnabled",get:function(){return"click"===this.mode||"hybrid"===this.mode}},{key:"_dragEnabled",get:function(){return"freehand"===this.mode||"hybrid"===this.mode}},{key:"undo",value:function(){(0,v.Z)((0,_.Z)(i.prototype),"undo",this).call(this),this.notifyChange("vertices")}},{key:"redo",value:function(){(0,v.Z)((0,_.Z)(i.prototype),"redo",this).call(this),this.notifyChange("vertices")}},{key:"complete",value:function(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}},{key:"_addViewHandles",value:function(){var e=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(function(e){e.stopPropagation()}),U.f.TOOL),this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&!e._panEnabled&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=t.pointerId,e._addVertexOnPointerUp=!0,e._cursorScreenPoint=(0,j.vT)(t),"touch"===t.pointerType&&e._updateCursor(t.native))}),U.f.TOOL),this.view.on("pointer-move",(function(t){e._popVertexOnPointerMove&&(e.undo(),e._popVertexOnPointerMove=!1),e._snappingTask=(0,f.IM)(e._snappingTask),e._cursorScreenPoint=(0,j.vT)(t),"touch"!==t.pointerType&&e._updateCursor(t.native)}),U.f.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._cursorScreenPoint=(0,j.vT)(t),e._dragEnabled&&!e._panEnabled?e._vertexAddHandler(t):e._addVertexOnPointerUp=!1)}),U.f.TOOL),this.view.on("pointer-up",(function(t){if(e._shouldHandlePointerEvent(t))if(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=null,e._addVertexOnPointerUp){if(!e._clickEnabled)return 1===e.vertices.length&&e.vertices.pop(),void e._drawCompleteHandler(t);e._vertexAddHandler(t)}else{var i="touch"===t.pointerType;e._updateCursor(t.native,i)}}),U.f.TOOL),this.view.on("drag",(function(t){e._dragEnabled&&(0,f.pC)(e._activePointerId)&&!e._panEnabled&&t.stopPropagation()}),U.f.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),U.f.TOOL),this.view.on("double-click",(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),U.f.TOOL),this.view.on("double-click",["Control"],(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),U.f.TOOL),this.view.on("key-down",(function(t){var i=t.key,n=t.repeat;i===G.j.vertexAdd&&!n&&e._cursorScreenPoint?(t.stopPropagation(),e._snappingTask=(0,f.IM)(e._snappingTask),e._vertexAddHandler(t)):i!==G.j.complete||n?i!==G.j.undo||e.interactiveUndoDisabled||n?i!==G.j.redo||e.interactiveUndoDisabled||n?i!==G.j.pan||n||(t.stopPropagation(),e._panEnabled=!0):(t.stopPropagation(),e.redo()):(t.stopPropagation(),e.undo()):(t.stopPropagation(),e._drawCompleteHandler(t))}),U.f.TOOL),this.view.on("key-up",(function(t){t.key===G.j.pan&&(t.stopPropagation(),e._panEnabled=!1)}),U.f.TOOL)])}},{key:"_addUndoRedoHandles",value:function(){var e=this;this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometryOperations.on("vertex-remove",(function(t){if(e.notifyChange("vertices"),"undo"===t.operation){var i=e._nativeEventHistory.undoStack.pop();e._nativeEventHistory.redoStack.push(i);var n=(0,h.Z)(e._committedVertices);(0,f.pC)(e._stagedVertex)&&n.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("undo",new L(e.view,i,t.vertices[0].index,n))}})),this._editGeometryOperations.on("vertex-add",(function(t){if(e.notifyChange("vertices"),"apply"===t.operation){var i=e._nativeEventHistory.undoStack[e._nativeEventHistory.undoStack.length],n=e._committedVertices.length-1,o=new E(e.view,i,n,e.vertices);e.emit("vertex-add",o),o.defaultPrevented&&(e._popVertexOnPointerMove=!0)}else if("redo"===t.operation){var r=e._nativeEventHistory.redoStack.pop();e._nativeEventHistory.undoStack.push(r);var a=(0,h.Z)(e._committedVertices);(0,f.pC)(e._stagedVertex)&&a.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("redo",new E(e.view,r,t.vertices[0].index,a))}}))])}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_removeUndoRedoHandles",value:function(){this._undoRedoHandles.removeAll()}},{key:"_addDrawTool",value:function(e){var t=this;this._drawTool=new q({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode}),this.view.addAndActivateTool(this._drawTool),this._drawTool.on("vertex-add",(function(e){1===e.vertices.length&&t.emit("vertex-add",new E(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(function(e){1===e.vertices.length&&t.emit("cursor-update",new D(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(function(e){t.emit("draw-complete",new R(null,t._drawTool.getVertexCoords())),t._removeDrawTool()}))}},{key:"_removeDrawTool",value:function(){this.view.tools.remove(this._drawTool),this._drawTool=(0,f.SC)(this._drawTool)}},{key:"_addVertex",value:function(e,t){var i=this._coordinateHelper.arrayToVector(e);if(!this._isDuplicateOfLastVertex(i)){this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(i);var n=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(n)}}},{key:"_updateCursor",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._popCursorVertex(),this._cursorScreenPoint){var n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if((0,f.pC)(n)&&!i){this._pushCursorVertex(n.vertex);var o=function(){return new D(t.view,e,t._activeComponent.vertices.length,t.vertices,(0,f.pC)(t._stagedVertex)?new z.Z(t._stagedVertex):null)};this.emit("cursor-update",o()),(0,f.pC)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",o())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){if(this._activePointerId=null,this._popCursorVertex(),!(this._committedVertices.length<2)){this._snappingTask=(0,f.IM)(this._snappingTask),(0,f.pC)(this._snappingManager)&&this._snappingManager.doneSnapping();var t=new R(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&((0,f.Wi)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(A);(0,d._)([(0,c.Cb)()],$.prototype,"_clickEnabled",null),(0,d._)([(0,c.Cb)()],$.prototype,"_dragEnabled",null),(0,d._)([(0,c.Cb)({type:K.A})],$.prototype,"mode",void 0),$=(0,d._)([(0,u.j)("esri.views.draw.PolylineDrawAction")],$);var ee=i(3826),te=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e))._isDragging=!1,n._panEnabled=!1,n._viewHandles=new y.Z,n._activePointerId=null,n._addVertexOnPointerUp=!1,n.viewAlignedCoordinateSystem=null,n.mode="freehand",n}return(0,a.Z)(i,[{key:"initialize",value:function(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}},{key:"destroy",value:function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}},{key:"complete",value:function(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}},{key:"getGeometryZValue",value:function(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}},{key:"_addViewHandles",value:function(){this._removeViewHandles(),"click"===this.mode?this._viewHandles.add(this._getClickModeViewHandles()):this._viewHandles.add(this._getDragModeViewHandles())}},{key:"_getDragModeViewHandles",value:function(){var e=this;return[this.view.on("immediate-click",(function(t){if(t.stopPropagation(),t.mapPoint&&!e._panEnabled){var i=e.getCoordsFromScreenPoint((0,j.vT)(t));(0,f.pC)(i)&&(e._vertexAddHandler(t),e._drawCompleteHandler(t))}}),U.f.TOOL),this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._panEnabled||(e._resetGeometry(),e._addVertexOnPointerUp=!0,e._cursorScreenPoint=(0,j.vT)(t),e._activePointerId=t.pointerId,e._vertexAddHandler(t),e._isDragging=!1,"touch"===t.pointerType&&e._updateCursor(t.native)))}),U.f.TOOL),this.view.on("pointer-move",(function(t){e._snappingTask=(0,f.IM)(e._snappingTask),(0,f.Wi)(e._activePointerId)&&"touch"!==t.pointerType&&(e._cursorScreenPoint=(0,j.vT)(t),e._updateCursor(t.native))}),U.f.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._isDragging=!0,e._cursorScreenPoint=(0,j.vT)(t),e._updateCursor(t.native))}),U.f.TOOL),this.view.on("pointer-up",(function(t){e._shouldHandlePointerEvent(t)&&e._addVertexOnPointerUp&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=null,e._isDragging&&e._vertexAddHandler(t),2===e._committedVertices.length&&e._drawCompleteHandler(t),e._isDragging=!1)}),U.f.TOOL),this.view.on("key-down",(function(t){t.key===G.j.complete&&e._cursorScreenPoint?(e._snappingTask=(0,f.IM)(e._snappingTask),e._vertexAddHandler(t),e._drawCompleteHandler(t)):t.key===G.j.pan&&(e._panEnabled=!0)}),U.f.TOOL),this.view.on("key-up",(function(t){t.key===G.j.pan&&(e._panEnabled=!1)}),U.f.TOOL),this.view.on("drag",(function(t){(0,f.pC)(e._activePointerId)&&t.stopPropagation()}),U.f.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),U.f.TOOL)]}},{key:"_getClickModeViewHandles",value:function(){var e=this;return[this.view.on("pointer-down",(function(t){e._snappingTask=(0,f.IM)(e._snappingTask),e._cursorScreenPoint=(0,j.vT)(t),e._activePointerId=t.pointerId,e._isDragging=!1,"touch"===t.pointerType&&e._updateCursor(t.native)}),U.f.TOOL),this.view.on("pointer-move",(function(t){e._snappingTask=(0,f.IM)(e._snappingTask),e._cursorScreenPoint=(0,j.vT)(t),(0,f.Wi)(e._activePointerId)&&"touch"!==t.pointerType&&e._updateCursor(t.native)}),U.f.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._isDragging=!0)}),U.f.TOOL),this.view.on("pointer-up",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=(0,f.IM)(e._snappingTask),e._activePointerId=null,t.stopPropagation(),e._isDragging||e._vertexAddHandler(t),2!==e.vertices.length||e._isDragging||e._drawCompleteHandler(t),e._isDragging=!1)}),U.f.TOOL),this.view.on("key-down",(function(t){t.key===G.j.vertexAdd&&e._cursorScreenPoint&&(e._vertexAddHandler(t),2===e.vertices.length&&e._drawCompleteHandler(t)),t.key===G.j.complete&&e._cursorScreenPoint&&2===e.vertices.length&&(e._vertexAddHandler(t),e._drawCompleteHandler(t))}),U.f.TOOL)]}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_addDrawTool",value:function(e){var t=this;this._drawTool=new q({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode}),this.view.addAndActivateTool(this._drawTool),this._drawTool.on("vertex-add",(function(e){1===e.vertices.length&&t.emit("vertex-add",new E(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(function(e){1===e.vertices.length&&t.emit("cursor-update",new D(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(function(e){t.emit("draw-complete",new R(null,t._drawTool.getVertexCoords())),t._removeDrawTool()}))}},{key:"_removeDrawTool",value:function(){this.view.tools.remove(this._drawTool),this._drawTool=(0,f.SC)(this._drawTool)}},{key:"_addVertex",value:function(e,t){var i=this._coordinateHelper.arrayToVector(e);if(!this._isDuplicateOfLastVertex(i)){this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(i),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=(0,ee.Gn)(this.view,this._committedVertices[0]));var n=this._committedVertices.length-1,o=new E(this.view,t,n,this.vertices);this.emit("vertex-add",o)}}},{key:"_updateCursor",value:function(e){var t=this;if(this._popCursorVertex(),this._cursorScreenPoint){var i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if((0,f.pC)(i)){this._pushCursorVertex(i.vertex);var n=function(){return new D(t.view,e,t._activeComponent.vertices.length,t.vertices,(0,f.pC)(t._stagedVertex)?new z.Z(t._stagedVertex):null)};this.emit("cursor-update",n()),(0,f.pC)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",n())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._snappingTask=(0,f.IM)(this._snappingTask),(0,f.pC)(this._snappingManager)&&this._snappingManager.doneSnapping(),!(this.vertices.length<1)){var t=new R(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}}},{key:"_resetGeometry",value:function(){this._editGeometryOperations.destroy(),this._editGeometryOperations=new H.c(new V.XE("polygon",this._coordinateHelper,2)),this._activeComponent=new V.wA(this._coordinateHelper.spatialReference,2),this._editGeometryOperations.data.components.push(this._activeComponent)}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&((0,f.Wi)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(A);(0,d._)([(0,c.Cb)({type:["freehand","click"]})],te.prototype,"mode",void 0),te=(0,d._)([(0,u.j)("esri/views/2d/engine/markup/SegmentDrawAction")],te);var ie=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;return(0,r.Z)(this,i),(e=t.apply(this,arguments)).activeAction=null,e.type="draw",e.view=null,e}return(0,a.Z)(i,[{key:"destroy",value:function(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}},{key:"create",value:function(e,t){this.reset();var i=(0,o.Z)({view:this.view},t);switch(e){case"point":i.editGeometryType="point",this.activeAction=new J(i);break;case"polyline":i.editGeometryType="polyline",this.activeAction=new $(i);break;case"multipoint":i.editGeometryType="polygon",this.activeAction=new F(i);break;case"polygon":i.editGeometryType="polygon",this.activeAction=new Q(i);break;case"rectangle":case"circle":case"ellipse":case"triangle":i.editGeometryType="polygon",this.activeAction=new te(i)}return this.activeAction}},{key:"complete",value:function(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}},{key:"reset",value:function(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}}]),i}(p.Z);(0,d._)([(0,c.Cb)()],ie.prototype,"activeAction",void 0),(0,d._)([(0,c.Cb)({readOnly:!0})],ie.prototype,"type",void 0),(0,d._)([(0,c.Cb)()],ie.prototype,"view",void 0);var ne=ie=(0,d._)([(0,u.j)("esri.views.draw.Draw")],ie)},70040:function(e,t,i){i.d(t,{O:function(){return a},X:function(){return h}});var n=i(43144),o=i(15671),r=i(51995),a={main:new r.Z([255,127,0]),selected:new r.Z([255,255,255]),outline:new r.Z([0,0,0,.5]),selectedOutline:new r.Z([255,255,255]),hoverOutline:new r.Z([255,255,255]),secondary:new r.Z([255,255,255]),secondaryOutline:new r.Z([100,100,100]),transparent:new r.Z([0,0,0,0])};function s(e,t){if(t)for(var i in t)e[i]=t[i]}var l=(0,n.Z)((function e(t){(0,o.Z)(this,e),this.size=8,this.hoverSize=10,this.color=a.main,this.hoverColor=a.main,this.outlineColor=a.outline,this.hoverOutlineColor=a.hoverOutline,s(this,t)})),d=(0,n.Z)((function e(t){(0,o.Z)(this,e),this.color=a.secondary,this.hoverColor=a.main,s(this,t)})),p=(0,n.Z)((function e(t){(0,o.Z)(this,e),this.color=a.transparent,this.hoverColor=a.transparent,this.outlineColor=a.main,this.hoverOutlineColor=a.main,this.stagedColor=a.transparent,this.stagedOutlineColor=a.secondary,s(this,t)})),c=(0,n.Z)((function e(t){(0,o.Z)(this,e),this.vertex=new l,this.midpoint=new l({color:a.secondary,outlineColor:a.secondaryOutline,size:6}),this.selected=new l({color:a.selected,hoverColor:a.selected,hoverOutlineColor:a.hoverOutline}),s(this,t)})),u=(0,n.Z)((function e(t){(0,o.Z)(this,e),this.center=new l({color:a.secondaryOutline}),this.fill=new p,this.line=new d,this.vertex=new l({color:a.selected,outlineColor:a.main,hoverColor:a.selected,hoverOutlineColor:a.secondaryOutline}),s(this,t)})),h=new((0,n.Z)((function e(t){(0,o.Z)(this,e),this.reshapeGraphics=new c,this.transformGraphics=new u,s(this,t)})))},2346:function(e,t,i){i.d(t,{L:function(){return C}});var n=i(15671),o=i(43144),r=i(60136),a=i(29388),s=i(27366),l=i(85015),d=i(91505),p=i(92026),c=i(17842),u=i(49861),h=(i(63780),i(93169),i(25243),i(69912)),v=i(88396),_=i(11186),y=i(71353),f=i(60176),w=i(74509),g=i(61574),m=i(64575),k=i(45008),C=function(e){(0,r.Z)(i,e);var t=(0,a.Z)(i);function i(e){var o;return(0,n.Z)(this,i),(o=t.call(this,e)).layer=null,o.interactive=!0,o.selectable=!1,o.grabbable=!0,o.dragging=!1,o.cursor=null,o.events=new d.Z.EventEmitter,o._circleCollisionCache=null,o._graphicSymbolChangedHandle=null,o._originalSymbol=null,o}return(0,o.Z)(i,[{key:"graphic",set:function(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}},{key:"elevationInfo",get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=(0,w.vu)(this.graphic),i=e?e.offset:0;return new m.Z({mode:t,offset:i})}},{key:"focusedSymbol",set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}},{key:"hovering",set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}},{key:"selected",set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}},{key:"destroy",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.graphic;if(!1===t.visible)return null;var i=t.geometry;if((0,p.Wi)(i))return null;var n=this._get("focusedSymbol"),o=(0,p.pC)(n)?n:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,o):this._intersectDistance3D(this.view,e,t)}},{key:"attach",value:function(){this.attachSymbolChanged(),(0,p.pC)(this.layer)&&this.layer.add(this.graphic)}},{key:"detach",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,p.pC)(this.layer)&&this.layer.remove(this.graphic)}},{key:"attachSymbolChanged",value:function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){(0,p.pC)(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&(0,p.pC)(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)}},{key:"detachSymbolChanged",value:function(){(0,p.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}},{key:"_updateGraphicSymbol",value:function(){this.graphic.symbol=this._focused&&(0,p.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}},{key:"_resetGraphicSymbol",value:function(){this.graphic.symbol=this._originalSymbol}},{key:"_intersectDistance2D",value:function(e,t,i,n){if(n=n||(0,g.js)(i),(0,p.Wi)(n))return null;var o=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==n.type)return(0,k.D)(t,i,e)?1:null;if((0,p.Wi)(o)||!o.originalPoint.equals(i)){var r=i,a=e.spatialReference;if((0,f.Up)(r.spatialReference,a)){var s=(0,f.iV)(r,a);o={originalPoint:r.clone(),mapPoint:s,radiusPx:(0,c.F2)(n.size)},this._circleCollisionCache=o}}if((0,p.pC)(o)){var l=(0,c.md)(t,b),d=e.toScreen(o.mapPoint),u=o.radiusPx,h=d.x+(0,c.F2)(n.xoffset),_=d.y-(0,c.F2)(n.yoffset);return(0,v.a)(l,[h,_])<u*u?1:null}return null}},{key:"_intersectDistance3D",value:function(e,t,i){var n=e.toMap(t,{include:[i]});return n&&(0,f.KC)(n,T,e.renderSpatialReference)?(0,_.i)(T,e.state.camera.eye):null}}]),i}(l.Z);(0,s._)([(0,u.Cb)({constructOnly:!0,nonNullable:!0})],C.prototype,"graphic",null),(0,s._)([(0,u.Cb)({readOnly:!0})],C.prototype,"elevationInfo",null),(0,s._)([(0,u.Cb)({constructOnly:!0,nonNullable:!0})],C.prototype,"view",void 0),(0,s._)([(0,u.Cb)({value:null})],C.prototype,"focusedSymbol",null),(0,s._)([(0,u.Cb)({constructOnly:!0})],C.prototype,"layer",void 0),(0,s._)([(0,u.Cb)()],C.prototype,"interactive",void 0),(0,s._)([(0,u.Cb)()],C.prototype,"selectable",void 0),(0,s._)([(0,u.Cb)()],C.prototype,"grabbable",void 0),(0,s._)([(0,u.Cb)({value:!1})],C.prototype,"grabbing",null),(0,s._)([(0,u.Cb)()],C.prototype,"dragging",void 0),(0,s._)([(0,u.Cb)()],C.prototype,"hovering",null),(0,s._)([(0,u.Cb)({value:!1})],C.prototype,"selected",null),(0,s._)([(0,u.Cb)()],C.prototype,"cursor",void 0),C=(0,s._)([(0,h.j)("esri.views.interactive.GraphicManipulator")],C);var T=(0,y.c)(),b=(0,c.s1)()},32845:function(e,t,i){i.d(t,{V:function(){return k}});var n=i(1413),o=i(15861),r=i(37762),a=i(15671),s=i(43144),l=i(60136),d=i(29388),p=i(87757),c=i(27366),u=i(85015),h=i(10064),v=i(100),_=i(92026),y=i(66978),f=i(94172),w=i(49861),g=(i(63780),i(93169),i(25243),i(69912)),m=i(39965),k=function(e){(0,l.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).analysis=null,n.tool=null,n._baseHandles=new v.Z,n._loggedUnsupportedErrorOnce=!1,n._reconnectViewTask=null,n._isAnalysisOwner=!0,n._parentChangeFromReconnect=!1,n._toolCreationTask=null,e&&null!=e.visible&&(n.visible=e.visible),n}return(0,s.Z)(i,[{key:"initialize",value:function(){var e=this;this._baseHandles.add([(0,f.Ym)((function(){return{ready:(0,_.pC)(e.view)&&e.view.ready,supported:e.supported}}),(function(t){var i=t.ready,n=t.supported;!i||n||e._loggedUnsupportedErrorOnce||(e.logError(e.unsupportedErrorMessage),e._loggedUnsupportedErrorOnce=!0),e._scheduleViewReconnect()}),f.tX),(0,f.Ym)((function(){return(0,_.pC)(e.analysis)?e.analysis.parent:null}),(function(t){e._isAnalysisOwner&&(0,_.pC)(t)&&t!==e.view&&(e._isAnalysisOwner=!1),e._parentChangeFromReconnect||e._scheduleViewReconnect()}),{sync:!0})])}},{key:"destroy",value:function(){this.removeTool(),this._reconnectViewTask=(0,_.IM)(this._reconnectViewTask),this._disconnectFromView(this.view),this.view=null,this._baseHandles=(0,_.SC)(this._baseHandles),this._isAnalysisOwner&&(0,_.pC)(this.analysis)&&(this.analysis.destroy(),this._set("analysis",null))}},{key:"supported",get:function(){return(0,_.Wi)(this.view)||this.view.type===this.supportedViewType}},{key:"view",get:function(){return this._get("view")},set:function(e){var t=this;if(e!==this.view){this._disconnectFromView(this.view),this.removeTool(),this._set("view",e);var i="tools";this._baseHandles.remove(i),(0,_.Wi)(e)||this._baseHandles.add(e.tools.on("change",(function(e){if(t.tool){var i,n=(0,r.Z)(e.removed);try{for(n.s();!(i=n.n()).done;){var o=i.value;if(t.tool===o){o.destroyed||o.destroy(),t._set("tool",null);break}}}catch(a){n.e(a)}finally{n.f()}}})),i)}}},{key:"visible",set:function(e){this._set("visible",e),(0,_.pC)(this.tool)&&(this.tool.visible=e),e||(this._toolCreationTask=(0,_.IM)(this._toolCreationTask))}},{key:"active",get:function(){return(0,_.pC)(this._toolCreationTask)&&!this._toolCreationTask.finished||(0,_.pC)(this.tool)&&this.tool.active}},{key:"disabled",get:function(){return(0,_.Wi)(this.view)||!this.view.ready||!this.supported}},{key:"creatingTool",get:function(){return(0,_.pC)(this._toolCreationTask)&&!this._toolCreationTask.finished}},{key:"onConnectToAnalysisView",value:function(e){}},{key:"onDisconnectFromAnalysisView",value:function(){}},{key:"createTool",value:function(){var e=(0,o.Z)(p.mark((function e(){var t,i,r=this;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="Tool creation was interrupted by another tool being created.",(0,_.pC)(this.tool)&&this.tool.rejectCreation(t),this.removeTool(),!(0,_.Wi)(this.view)&&this.supported){e.next=3;break}return e.abrupt("return",Promise.reject(new h.Z("tool:create","The view does not support the tool.",this.unsupportedErrorMessage)));case 3:return this._toolCreationTask=(0,y.vr)(function(){var e=(0,o.Z)(p.mark((function e(i){var o,a,s;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_.Wg)(r.view).whenReady();case 2:return(0,y.k_)(i,t),o=r.createToolParams(),a=(0,m.J1)(o.constructorArguments),(0,_.pC)(r.analysis)&&(a.analysis=r.analysis),s=new o.toolConstructor((0,n.Z)((0,n.Z)({visible:r.visible},a),{},{view:r.view})),e.next=8,s.whenCreationStarted();case 8:return(0,y.Hc)(i)&&s.rejectCreation(t),(0,y.k_)(i,t),e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=6,this._toolCreationTask.promise;case 6:i=e.sent,this._set("tool",i),i.completed?this.view.tools.add(i):(this.view.addAndActivateTool(i),(0,f.zF)((function(){return i.completed}),(function(){i.active&&(0,_.pC)(r.view)&&(r.view.activeTool=null)}),{initial:!0,once:!0}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeTool",value:function(){this._toolCreationTask=(0,_.IM)(this._toolCreationTask),(0,_.Wi)(this.tool)||((0,_.pC)(this.view)&&this.view.tools&&this.view.tools.remove(this.tool),this.tool.rejectCreation("Rejecting creation because tool is removed."),this.tool.destroyed||this.tool.destroy(),this._set("tool",null))}},{key:"_scheduleViewReconnect",value:function(){var e=this;this._reconnectViewTask=(0,_.IM)(this._reconnectViewTask),this._reconnectViewTask=(0,y.vr)((function(t){return e._reconnectView(t)}))}},{key:"_reconnectView",value:function(){var e=(0,o.Z)(p.mark((function e(t){var i,n,o;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(0,_.pC)(this.view)&&this.view.ready&&this.supported,!(0,y.Hc)(t)){e.next=3;break}return e.abrupt("return");case 3:if(this._disconnectFromView(this.view),i&&!(0,_.Wi)(this.view)){e.next=5;break}return e.abrupt("return");case 5:if(n=this.view,!(0,_.pC)(this.analysis)){e.next=19;break}if(!this._isAnalysisOwner){e.next=11;break}if(!(0,_.pC)(this.analysis.parent)){e.next=10;break}return e.abrupt("return",void this.logError("expected owned analysis to have null parent when connecting to view"));case 10:this._parentChangeFromReconnect=!0,n.analyses.add(this.analysis),this._parentChangeFromReconnect=!1;case 11:return e.next=13,n.whenAnalysisView(this.analysis);case 13:if(o=e.sent,!(0,y.Hc)(t)){e.next=16;break}return e.abrupt("return",void this._disconnectFromView(n));case 16:if(!(0,_.Wi)(o)){e.next=18;break}return e.abrupt("return",void this.logError("Unable to retrieve analysis view for analysis. Analysis may not be part of the scene."));case 18:this.onConnectToAnalysisView(o);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_disconnectFromView",value:function(e){(0,_.pC)(this.analysis)&&((0,_.pC)(e)&&this._isAnalysisOwner&&(this._parentChangeFromReconnect=!0,e.analyses.remove(this.analysis),this._parentChangeFromReconnect=!1),this.onDisconnectFromAnalysisView())}},{key:"logError",value:function(){var e;(e=this.logger).error.apply(e,arguments)}}]),i}(u.Z);(0,c._)([(0,w.Cb)({constructOnly:!0})],k.prototype,"analysis",void 0),(0,c._)([(0,w.Cb)({constructOnly:!0})],k.prototype,"tool",void 0),(0,c._)([(0,w.Cb)()],k.prototype,"supported",null),(0,c._)([(0,w.Cb)({value:null})],k.prototype,"view",null),(0,c._)([(0,w.Cb)({type:Boolean,value:!0})],k.prototype,"visible",null),(0,c._)([(0,w.Cb)()],k.prototype,"active",null),(0,c._)([(0,w.Cb)()],k.prototype,"disabled",null),(0,c._)([(0,w.Cb)()],k.prototype,"_toolCreationTask",void 0),(0,c._)([(0,w.Cb)({readOnly:!0})],k.prototype,"creatingTool",null),k=(0,c._)([(0,g.j)("esri.widgets.support.InteractiveToolViewModel")],k)}}]);
//# sourceMappingURL=286.caa6be03.chunk.js.map