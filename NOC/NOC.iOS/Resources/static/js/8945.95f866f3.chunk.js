"use strict";(self.webpackChunketihadrailapp=self.webpackChunketihadrailapp||[]).push([[8945],{65630:function(e,t,n){n.d(t,{D:function(){return Q},b:function(){return J}});var r,i,o,a,s,l,c,u,d,m,v,f,h,p,g,x,b,_,T,y=n(30168),C=n(22357),M=n(83734),w=n(33280),A=n(94951),S=n(81221),E=n(73782),R=n(52276),F=n(53230),O=n(60113),P=n(48655),H=n(28719),D=n(49223),Z=n(6781),L=n(21002),B=n(38171),N=n(30694),z=n(4460),I=n(15226),k=n(96658),V=n(2116),U=n(41481),G=n(23235),W=n(18607),q=n(10763),j=n(14282),X=n(71033),K=n(98634),$=n(64201);function J(e){var t=new $.kG,n=t.vertex.code,J=t.fragment.code;return t.include(j.a,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(R.f),t.varyings.add("vpos","vec3"),t.include(W.kl,e),t.include(S.f,e),t.include(D.LC,e),0!==e.output&&7!==e.output||(t.include(E.O,e),t.include(A.w,{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(M.w),t.include(B.Q,e),t.include(H.B,e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(O.D,e),t.include(C.q,e),t.include(F.R,e),t.include(P.c,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),n.add((0,K.H)(r||(r=(0,y.Z)(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, vpos);\n          ","\n        }\n\n        ","\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),e.instancedColor?"vcolorExt *= instanceColor;":"",K.H.float(q.bf),0===e.normalType?(0,K.H)(i||(i=(0,y.Z)(["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]))):"",e.vertexTangents?"vTangent = dpTransformVertexTangent(tangent);":"",0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""))),7===e.output&&(t.include(w.p2,e),t.include(q.sj,e),e.multipassTerrainEnabled&&(t.fragment.include(L.S),t.include(I.l,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(X.y),J.add((0,K.H)(o||(o=(0,y.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?(0,K.H)(a||(a=(0,y.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):(0,K.H)(s||(s=(0,y.Z)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?(0,K.H)(l||(l=(0,y.Z)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):(0,K.H)(c||(c=(0,y.Z)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(w.p2,e),t.include(z.X,e),t.include(N.K,e),t.include(q.sj,e),e.receiveShadows&&t.include(G.hX,e),e.multipassTerrainEnabled&&(t.fragment.include(L.S),t.include(I.l,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(U.jV,e),t.include(V.T,e),t.fragment.include(X.y),t.include(k.k,e),J.add((0,K.H)(u||(u=(0,y.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?(0,K.H)(d||(d=(0,y.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):(0,K.H)(m||(m=(0,y.Z)(["vec4 texColor = vec4(1.0);"]))),3===e.normalType?(0,K.H)(v||(v=(0,y.Z)(["\n        vec3 normal = screenDerivativeNormal(localvpos);"]))):(0,K.H)(f||(f=(0,y.Z)(["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?(0,K.H)(h||(h=(0,y.Z)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):(0,K.H)(p||(p=(0,y.Z)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),e.hasNormalTexture?(0,K.H)(g||(g=(0,y.Z)(["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"])),e.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal = normal;",1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?(0,K.H)(x||(x=(0,y.Z)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):(0,K.H)(b||(b=(0,y.Z)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):(0,K.H)(_||(_=(0,y.Z)([""]))),1===e.pbrMode||2===e.pbrMode?(0,K.H)(T||(T=(0,y.Z)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(Z.s,e),t}var Q=Object.freeze({__proto__:null,build:J})},40563:function(e,t,n){n.d(t,{R:function(){return X},b:function(){return j}});var r,i,o,a,s,l,c,u,d,m,v,f,h,p,g,x,b,_,T,y=n(30168),C=n(22357),M=n(83734),w=n(33280),A=n(94951),S=n(81221),E=n(73782),R=n(52276),F=n(53230),O=n(60113),P=n(48655),H=n(49223),D=n(6781),Z=n(21002),L=n(30694),B=n(4460),N=n(15226),z=n(2116),I=n(41481),k=n(23235),V=n(18607),U=n(10763),G=n(71033),W=n(98634),q=n(64201);function j(e){var t=new q.kG,n=t.vertex.code,j=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(R.f),t.varyings.add("vpos","vec3"),t.include(V.kl,e),t.include(S.f,e),t.include(H.LC,e),0!==e.output&&7!==e.output||(t.include(E.O,e),t.include(A.w,{linearDepth:!1}),e.offsetBackfaces&&t.include(M.w),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(O.D,e),t.include(C.q,e),t.include(F.R,e),t.include(P.c,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),n.add((0,W.H)(r||(r=(0,y.Z)(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          ","\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),e.instancedColor?"vcolorExt *= instanceColor;":"",W.H.float(U.bf),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?(0,W.H)(i||(i=(0,y.Z)(["depth = (view * vec4(vpos, 1.0)).z;"]))):""))),7===e.output&&(t.include(w.p2,e),t.include(U.sj,e),e.multipassTerrainEnabled&&(t.fragment.include(Z.S),t.include(N.l,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(G.y),j.add((0,W.H)(o||(o=(0,y.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?(0,W.H)(a||(a=(0,y.Z)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?(0,W.H)(s||(s=(0,y.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):(0,W.H)(l||(l=(0,y.Z)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?(0,W.H)(c||(c=(0,y.Z)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):(0,W.H)(u||(u=(0,y.Z)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(w.p2,e),t.include(B.X,e),t.include(L.K,e),t.include(U.sj,e),e.receiveShadows&&t.include(k.hX,e),e.multipassTerrainEnabled&&(t.fragment.include(Z.S),t.include(N.l,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(I.jV,e),t.include(z.T,e),t.fragment.include(G.y),j.add((0,W.H)(d||(d=(0,y.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        vec3 viewDirection = normalize(vpos - camPos);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?(0,W.H)(m||(m=(0,y.Z)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?(0,W.H)(v||(v=(0,y.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):(0,W.H)(f||(f=(0,y.Z)(["vec4 texColor = vec4(1.0);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?(0,W.H)(h||(h=(0,y.Z)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):(0,W.H)(p||(p=(0,y.Z)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),(0,W.H)(g||(g=(0,y.Z)(["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"]))),1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?(0,W.H)(x||(x=(0,y.Z)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):(0,W.H)(b||(b=(0,y.Z)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):(0,W.H)(_||(_=(0,y.Z)([""]))),1===e.pbrMode||2===e.pbrMode?(0,W.H)(T||(T=(0,y.Z)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(D.s,e),t}var X=Object.freeze({__proto__:null,build:j})},11873:function(e,t,n){function r(){return[1,0,0,0,1,0,0,0,1]}function i(e,t){return new Float64Array(e,t,9)}n.d(t,{a:function(){return i},c:function(){return r}});Object.freeze({__proto__:null,create:r,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,n,r,i,o,a,s,l){return[e,t,n,r,i,o,a,s,l]},createView:i})},81949:function(e,t,n){function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function o(e,t,n,r,i,o,a,s,l,c,u,d,m,v,f,h){return[e,t,n,r,i,o,a,s,l,c,u,d,m,v,f,h]}function a(e,t){return new Float64Array(e,t,16)}n.d(t,{I:function(){return s},a:function(){return a},b:function(){return i},c:function(){return r},f:function(){return o}});var s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze({__proto__:null,create:r,clone:i,fromValues:o,createView:a,IDENTITY:s})},48976:function(e,t,n){n.d(t,{c:function(){return f},g:function(){return u},i:function(){return v},j:function(){return R},k:function(){return p},m:function(){return d},r:function(){return O},s:function(){return c}});var r=n(11873),i=n(98131),o=n(71353),a=n(26277),s=n(11186),l=n(90045);function c(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function u(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>a.E?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function d(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*u+a*s+i*c-o*l,e[1]=i*u+a*l+o*s-r*c,e[2]=o*u+a*c+r*l-i*s,e[3]=a*u-r*s-i*l-o*c,e}function m(e,t,n,r){var i,o,s,l,c,u=t[0],d=t[1],m=t[2],v=t[3],f=n[0],h=n[1],p=n[2],g=n[3];return(o=u*f+d*h+m*p+v*g)<0&&(o=-o,f=-f,h=-h,p=-p,g=-g),1-o>a.E?(i=Math.acos(o),s=Math.sin(i),l=Math.sin((1-r)*i)/s,c=Math.sin(r*i)/s):(l=1-r,c=r),e[0]=l*u+c*f,e[1]=l*d+c*h,e[2]=l*m+c*p,e[3]=l*v+c*g,e}function v(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=o*s,e}function f(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function h(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*a+a]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*o+a]-t[3*a+o])*n,e[o]=(t[3*o+i]+t[3*i+o])*n,e[a]=(t[3*a+i]+t[3*i+a])*n}return e}function p(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(n),l=Math.cos(n),c=Math.sin(r),u=Math.cos(r);return e[0]=o*l*u-a*s*c,e[1]=a*s*u+o*l*c,e[2]=a*l*c-o*s*u,e[3]=a*l*u+o*s*c,e}var g=l.c,x=l.s,b=l.a,_=d,T=l.b,y=l.d,C=l.l,M=l.e,w=M,A=l.f,S=A,E=l.n,R=l.g,F=l.h;function O(e,t,n){var r=(0,s.d)(t,n);return r<-.999999?((0,s.c)(P,H,t),(0,s.u)(P)<1e-6&&(0,s.c)(P,D,t),(0,s.n)(P,P),c(e,P,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,s.c)(P,t,n),e[0]=P[0],e[1]=P[1],e[2]=P[2],e[3]=1+r,E(e,e))}var P=(0,o.c)(),H=(0,o.f)(1,0,0),D=(0,o.f)(0,1,0);var Z=(0,i.a)(),L=(0,i.a)();var B=(0,r.c)();Object.freeze({__proto__:null,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:c,getAxisAngle:u,multiply:d,rotateX:function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+a*s,e[1]=i*l+o*s,e[2]=o*l-i*s,e[3]=a*l-r*s,e},rotateY:function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l-o*s,e[1]=i*l+a*s,e[2]=o*l+r*s,e[3]=a*l-i*s,e},rotateZ:function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*s,e[1]=i*l-r*s,e[2]=o*l+a*s,e[3]=a*l-o*s,e},calculateW:function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},slerp:m,random:function(e){var t=(0,a.R)(),n=(0,a.R)(),r=(0,a.R)(),i=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*n),e[1]=i*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*r),e[3]=o*Math.cos(2*Math.PI*r),e},invert:v,conjugate:f,fromMat3:h,fromEuler:p,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},copy:g,set:x,add:b,mul:_,scale:T,dot:y,lerp:C,length:M,len:w,squaredLength:A,sqrLen:S,normalize:E,exactEquals:R,equals:F,rotationTo:O,sqlerp:function(e,t,n,r,i,o){return m(Z,t,i,o),m(L,n,r,o),m(e,Z,L,2*o*(1-o)),e},setAxes:function(e,t,n,r){var i=B;return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=r[0],i[4]=r[1],i[7]=r[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],E(e,h(e,i))}})},98131:function(e,t,n){function r(){return[0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3]]}function o(e,t){return new Float64Array(e,t,4)}n.d(t,{I:function(){return a},a:function(){return r},b:function(){return i},c:function(){return o}});var a=[0,0,0,1];Object.freeze({__proto__:null,create:r,clone:i,fromValues:function(e,t,n,r){return[e,t,n,r]},createView:o,IDENTITY:a})},23470:function(e,t,n){n.d(t,{a:function(){return x},b:function(){return p},c:function(){return h},g:function(){return _},i:function(){return C},w:function(){return g}});n(93169);var r=n(32718),i=n(16889),o=n(92026),a=n(14226),s=n(11186),l=n(71353),c=n(90045),u=n(67077),d=n(40885),m=n(40927),v=n(11185),f=r.Z.getLogger("esri.geometry.support.sphere");function h(){return(0,u.c)()}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h();return(0,c.c)(t,e)}function g(e){return e}function x(e){e[0]=e[1]=e[2]=e[3]=0}function b(e){return Array.isArray(e)?e[3]:e}function _(e){return Array.isArray(e)?e:F}function T(e,t,n){if((0,o.Wi)(t))return!1;var r=t.origin,i=t.direction,a=y;a[0]=r[0]-e[0],a[1]=r[1]-e[1],a[2]=r[2]-e[2];var s=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=2*(i[0]*a[0]+i[1]*a[1]+i[2]*a[2]),c=l*l-4*s*(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]-e[3]*e[3]);if(c<0)return!1;var u=Math.sqrt(c),d=(-l-u)/(2*s),m=(-l+u)/(2*s);return(d<0||m<d&&m>0)&&(d=m),!(d<0)&&(n&&(n[0]=r[0]+i[0]*d,n[1]=r[1]+i[1]*d,n[2]=r[2]+i[2]*d),!0)}var y=(0,l.c)();function C(e,t){return T(e,t,null)}function M(e,t,n){var r=v.WM.get(),i=v.MP.get();(0,s.c)(r,t.origin,t.direction);var o=b(e);(0,s.c)(n,r,t.origin),(0,s.a)(n,n,1/(0,s.l)(n)*o);var l=A(e,t.origin),c=(0,m.EU)(t.origin,n);return(0,a.i)(i),(0,a.e)(i,i,c+l,r),(0,s.m)(n,n,i),n}function w(e,t,n){var r=(0,s.f)(v.WM.get(),t,_(e)),i=(0,s.a)(v.WM.get(),r,e[3]/(0,s.l)(r));return(0,s.b)(n,i,_(e))}function A(e,t){var n=(0,s.f)(v.WM.get(),t,_(e)),r=(0,s.l)(n),o=b(e),a=o+Math.abs(o-r);return(0,i.ZF)(o/a)}var S=(0,l.c)();function E(e,t,n,r){var o=(0,s.f)(S,t,_(e));switch(n){case 0:var a=(0,i.jE)(o,S)[2];return(0,s.s)(r,-Math.sin(a),Math.cos(a),0);case 1:var l=(0,i.jE)(o,S),c=l[1],u=l[2],d=Math.sin(c);return(0,s.s)(r,-d*Math.cos(u),-d*Math.sin(u),Math.cos(c));case 2:return(0,s.n)(r,o);default:return}}function R(e,t){var n=(0,s.f)(O,t,_(e));return(0,s.l)(n)-e[3]}var F=(0,l.c)(),O=(0,l.c)();Object.freeze({__proto__:null,create:h,copy:p,fromCenterAndRadius:function(e,t){return(0,u.f)(e[0],e[1],e[2],t)},wrap:g,clear:x,fromRadius:function(e){return e},getRadius:b,getCenter:_,fromValues:function(e,t,n,r){return(0,u.f)(e,t,n,r)},elevate:function(e,t,n){return e!==n&&(0,s.g)(n,e),n[3]=e[3]+t,n},setExtent:function(e,t,n){return f.error("sphere.setExtent is not yet supported"),e===n?n:p(e,n)},intersectRay:T,intersectsRay:C,intersectRayClosestSilhouette:function(e,t,n){if(T(e,t,n))return n;var r=M(e,t,v.WM.get());return(0,s.b)(n,t.origin,(0,s.a)(v.WM.get(),t.direction,(0,s.i)(t.origin,r)/(0,s.l)(t.direction))),n},closestPointOnSilhouette:M,closestPoint:function(e,t,n){return T(e,t,n)?n:((0,d.JI)(t,_(e),n),w(e,n,n))},projectPoint:w,distanceToSilhouette:function(e,t){var n=(0,s.f)(v.WM.get(),t,_(e)),r=(0,s.p)(n),i=e[3]*e[3];return Math.sqrt(Math.abs(r-i))},angleToSilhouette:A,axisAt:E,altitudeAt:R,setAltitudeAt:function(e,t,n,r){var i=R(e,t),o=E(e,t,2,O),a=(0,s.a)(O,o,n-i);return(0,s.b)(r,t,a)}})},32035:function(e,t,n){n.d(t,{a:function(){return o},b:function(){return l},n:function(){return s},s:function(){return a},t:function(){return i}});var r=n(77873);function i(e,t,n){if(e.count===t.count)for(var i=e.count,o=n[0],a=n[1],s=n[2],l=n[4],c=n[5],u=n[6],d=n[8],m=n[9],v=n[10],f=n[12],h=n[13],p=n[14],g=e.typedBuffer,x=e.typedBufferStride,b=t.typedBuffer,_=t.typedBufferStride,T=0;T<i;T++){var y=T*x,C=T*_,M=b[C],w=b[C+1],A=b[C+2];g[y]=o*M+l*w+d*A+f,g[y+1]=a*M+c*w+m*A+h,g[y+2]=s*M+u*w+v*A+p}else r.k.error("source and destination buffers need to have the same number of elements")}function o(e,t,n){if(e.count===t.count)for(var i=e.count,o=n[0],a=n[1],s=n[2],l=n[3],c=n[4],u=n[5],d=n[6],m=n[7],v=n[8],f=e.typedBuffer,h=e.typedBufferStride,p=t.typedBuffer,g=t.typedBufferStride,x=0;x<i;x++){var b=x*h,_=x*g,T=p[_],y=p[_+1],C=p[_+2];f[b]=o*T+l*y+d*C,f[b+1]=a*T+c*y+m*C,f[b+2]=s*T+u*y+v*C}else r.k.error("source and destination buffers need to have the same number of elements")}function a(e,t,n){for(var r=Math.min(e.count,t.count),i=e.typedBuffer,o=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,l=0;l<r;l++){var c=l*o,u=l*s;i[c]=n*a[u],i[c+1]=n*a[u+1],i[c+2]=n*a[u+2]}}function s(e,t){for(var n=Math.min(e.count,t.count),r=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=0;s<n;s++){var l=s*i,c=s*a,u=o[c],d=o[c+1],m=o[c+2],v=Math.sqrt(u*u+d*d+m*m);if(v>0){var f=1/v;r[l]=f*u,r[l+1]=f*d,r[l+2]=f*m}}}function l(e,t,n){for(var r=Math.min(e.count,t.count),i=e.typedBuffer,o=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,l=0;l<r;l++){var c=l*o,u=l*s;i[c]=a[u]>>n,i[c+1]=a[u+1]>>n,i[c+2]=a[u+2]>>n}}Object.freeze({__proto__:null,transformMat4:i,transformMat3:o,scale:a,normalize:s,shiftRight:l})},92770:function(e,t,n){function r(e,t,n){for(var r=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=n?n.count:t.count,l=(n&&n.dstIndex?n.dstIndex:0)*i,c=(n&&n.srcIndex?n.srcIndex:0)*a,u=0;u<s;++u)r[l]=o[c],r[l+1]=o[c+1],r[l+2]=o[c+2],l+=i,c+=a}function i(e,t,n,r,i){for(var o,a,s=e.typedBuffer,l=e.typedBufferStride,c=null!=(o=null==i?void 0:i.count)?o:e.count,u=(null!=(a=null==i?void 0:i.dstIndex)?a:0)*l,d=0;d<c;++d)s[u]=t,s[u+1]=n,s[u+2]=r,u+=l}n.d(t,{c:function(){return r},f:function(){return i}});Object.freeze({__proto__:null,copy:r,fill:i})},77873:function(e,t,n){n.d(t,{k:function(){return r}});var r=n(32718).Z.getLogger("esri.views.3d.support.buffer.math")},40885:function(e,t,n){n.d(t,{JI:function(){return v},JG:function(){return c},Ue:function(){return s},Jk:function(){return m},zk:function(){return u},re:function(){return l}});n(63780);var r=n(21530),i=n(11186),o=n(71353),a=n(11185);function s(e){return e?{origin:(0,o.a)(e.origin),direction:(0,o.a)(e.direction)}:{origin:(0,o.c)(),direction:(0,o.c)()}}function l(e,t){var n=f.get();return n.origin=e,n.direction=t,n}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s();return d(e.origin,e.direction,t)}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return(0,i.g)(n.origin,e),(0,i.f)(n.direction,t,e),n}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return(0,i.g)(n.origin,e),(0,i.g)(n.direction,t),n}function m(e,t){var n=(0,i.c)(a.WM.get(),(0,i.n)(a.WM.get(),e.direction),(0,i.f)(a.WM.get(),t,e.origin));return(0,i.d)(n,n)}function v(e,t,n){var r=(0,i.d)(e.direction,(0,i.f)(n,t,e.origin));return(0,i.b)(n,e.origin,(0,i.a)(n,e.direction,r)),n}var f=new r.x((function(){return{origin:null,direction:null}}))},40927:function(e,t,n){n.d(t,{EU:function(){return l},cp:function(){return c},nF:function(){return a},SR:function(){return s}});var r=n(16889),i=n(11186),o=n(71353);function a(e,t,n){var r=(0,i.d)(e,t)/(0,i.d)(e,e);return(0,i.a)(n,e,r)}function s(e,t){return(0,i.d)(e,t)/(0,i.l)(e)}function l(e,t){var n=(0,i.d)(e,t)/((0,i.l)(e)*(0,i.l)(t));return-(0,r.ZF)(n)}function c(e,t,n){(0,i.n)(u,e),(0,i.n)(d,t);var o=(0,i.d)(u,d),a=(0,r.ZF)(o),s=(0,i.c)(u,u,d);return(0,i.d)(s,n)<0?2*Math.PI-a:a}var u=(0,o.c)(),d=(0,o.c)()},4265:function(e,t,n){n.r(t),n.d(t,{fetch:function(){return Y},gltfToEngineResources:function(){return ne},parseUrl:function(){return te}});var r=n(37762),i=n(1413),o=n(15861),a=n(87757),s=n(71277),l=n(92026),c=n(22753),u=n(11873),d=n(14226),m=n(81949),v=n(11186),f=n(71353),h=n(41414),p=n(25158),g=n(32035),x=n(19093),b=n(17054),_=n(27053),T=n(56474),y=n(32315),C=n(76200),M=n(14921),w=n(10064),A=n(32718),S=n(66978),E=n(49901),R=n(38330),F=n(74894),O=n(83602),P=n(10052),H=A.Z.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function D(e,t){return Z.apply(this,arguments)}function Z(){return(Z=(0,o.Z)(a.mark((function e(t,n){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(t,n);case 2:return r=e.sent,e.t0=r,e.next=6,G(r.textureDefinitions,n);case 6:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,textures:e.t1});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return B.apply(this,arguments)}function B(){return(B=(0,o.Z)(a.mark((function e(t,n){var r,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=(0,l.pC)(n)&&n.streamDataRequester)){e.next=3;break}return e.abrupt("return",N(t,r,n));case 3:return e.next=5,(0,M.q6)((0,C.default)(t,(0,l.Wg)(n)));case 5:if(!0!==(i=e.sent).ok){e.next=8;break}return e.abrupt("return",i.value.data);case 8:(0,S.r9)(i.error),I(i.error);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,n){return z.apply(this,arguments)}function z(){return(z=(0,o.Z)(a.mark((function e(t,n,r){var i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,M.q6)(n.request(t,"json",r));case 2:if(!0!==(i=e.sent).ok){e.next=5;break}return e.abrupt("return",i.value);case 5:(0,S.r9)(i.error),I(i.error.details.url);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){throw new w.Z("","Request for object resource failed: ".concat(e))}function k(e){var t=e.params,n=t.topology,r=!0;switch(t.vertexAttributes||(H.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var i=t.faces;if(i){if(t.vertexAttributes)for(var o in t.vertexAttributes){var a=i[o];a&&a.values?(null!=a.valueType&&"UInt32"!==a.valueType&&(H.warn("Unsupported indexed geometry indices type '".concat(a.valueType,"', only UInt32 is currently supported")),r=!1),null!=a.valuesPerElement&&1!==a.valuesPerElement&&(H.warn("Unsupported indexed geometry values per element '".concat(a.valuesPerElement,"', only 1 is currently supported")),r=!1)):(H.warn("Indexed geometry does not specify face indices for '".concat(o,"' attribute")),r=!1)}}else H.warn("Indexed geometries must specify faces"),r=!1;break;default:H.warn("Unsupported topology '".concat(n,"'")),r=!1}e.params.material||(H.warn("Geometry requires material"),r=!1);var s=e.params.vertexAttributes;for(var l in s)s[l].values||(H.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function V(e,t){var n=[],r=[],i=[],o=[],a=e.resource,s=E.G.parse(a.version||"1.0","wosr");X.validate(s);for(var c=a.model.name,u=a.model.geometries,d=a.materialDefinitions,m=e.textures,v=0,h=new Map,p=0;p<u.length;p++){var g=u[p];if(k(g)){var x=j(g),b=g.params.vertexAttributes,_=[];for(var T in b){var y=b[T],C=y.values;_.push([T,{data:C,size:y.valuesPerElement,exclusive:!0}])}var M=[];if("PerAttributeArray"!==g.params.topology){var w=g.params.faces;for(var A in w)M.push([A,new Uint32Array(w[A].values)])}var S=m&&m[x.texture];if(S&&!h.has(x.texture)){var R=S.image,H=S.params,D=new O.x(R,H);o.push(D),h.set(x.texture,D)}var Z=h.get(x.texture),L=Z?Z.id:void 0,B=i[x.material]?i[x.material][x.texture]:null;if(!B){var N=d[x.material.substring(x.material.lastIndexOf("/")+1)].params;1===N.transparency&&(N.transparency=0);var z=S&&S.alphaChannelUsage,I=N.transparency>0||"transparency"===z||"maskAndTransparency"===z,V=S?q(S.alphaChannelUsage):void 0,G={ambient:(0,f.d)(N.diffuse),diffuse:(0,f.d)(N.diffuse),opacity:1-(N.transparency||0),transparent:I,textureAlphaMode:V,textureAlphaCutoff:.33,textureId:L,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:N.externalColorMixMode||"tint",textureAlphaPremultiplied:!!S&&!!S.params.preMultiplyAlpha};(0,l.pC)(t)&&t.materialParamsMixin&&Object.assign(G,t.materialParamsMixin),B=new P.G(G),i[x.material]||(i[x.material]={}),i[x.material][x.texture]=B}r.push(B);var W=new F.Z(_,M);v+=M.position?M.position.length:0,n.push(W)}}return{name:c,stageResources:{textures:o,materials:r,geometries:n},pivotOffset:a.model.pivotOffset,boundingBox:U(n),numberOfVertices:v,lodThreshold:null}}function U(e){var t=(0,h.cS)();return e.forEach((function(e){var n=e.boundingInfo;(0,l.pC)(n)&&((0,h.pp)(t,n.getBBMin()),(0,h.pp)(t,n.getBBMax()))})),t}function G(e,t){return W.apply(this,arguments)}function W(){return(W=(0,o.Z)(a.mark((function e(t,n){var i,o,s,c,u,d,m,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],o=function(e){var r=t[e],o=r.images[0].data;if(!o)return H.warn("Externally referenced texture data is not yet supported"),"continue";var a=r.encoding+";base64,"+o,s="/textureDefinitions/"+e,c="rgba"===r.channels?r.alphaChannelUsage||"transparency":"none",u={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:1!==q(c)},d=(0,l.pC)(n)&&n.disableTextures?Promise.resolve(null):(0,R.t)(a,n);i.push(d.then((function(e){return{refId:s,image:e,params:u,alphaChannelUsage:c}})))},e.t0=a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(s=e.t1.value,"continue"!==o(s)){e.next=8;break}return e.abrupt("continue",3);case 8:e.next=3;break;case 10:return e.next=12,Promise.all(i);case 12:c=e.sent,u={},d=(0,r.Z)(c);try{for(d.s();!(m=d.n()).done;)v=m.value,u[v.refId]=v}catch(f){d.e(f)}finally{d.f()}return e.abrupt("return",u);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;default:return 0}}function j(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}var X=new E.G(1,2,"wosr"),K=n(68845),$=n(19131),J=n(69618),Q=n(92770);function Y(e,t){return ee.apply(this,arguments)}function ee(){return(ee=(0,o.Z)(a.mark((function e(t,n){var r,o,c,u,d,m,v,f,h,p;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wosr"!==(r=te((0,s.pJ)(t))).fileType){e.next=7;break}return e.next=4,n.cache?n.cache.loadWOSR(r.url,n):D(r.url,n);case 4:return o=e.sent,c=V(o,n),e.abrupt("return",{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:o.remove});case 7:return e.next=9,n.cache?n.cache.loadGLTF(r.url,n,n.usePBR):(0,T.z)(new _.C(n.streamDataRequester),r.url,n,n.usePBR);case 9:if(u=e.sent,d=(0,l.U2)(u.model.meta,"ESRI_proxyEllipsoid"),u.meta.isEsriSymbolResource&&(0,l.pC)(d)&&-1!==u.meta.uri.indexOf("/RealisticTrees/")&&re(u,d),m=u.meta.isEsriSymbolResource?{usePBR:n.usePBR,isSchematic:!1,treeRendering:u.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:n.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},v=(0,i.Z)((0,i.Z)({},n.materialParamsMixin),{},{treeRendering:u.customMeta.esriTreeRendering}),null==r.specifiedLodIndex){e.next=18;break}return f=ne(u,m,v,r.specifiedLodIndex),h=f[0].boundingBox,0!==r.specifiedLodIndex&&(h=ne(u,m,v,0)[0].boundingBox),e.abrupt("return",{lods:f,referenceBoundingBox:h,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1,remove:u.remove});case 18:return p=ne(u,m,v),e.abrupt("return",{lods:p,referenceBoundingBox:p[0].boundingBox,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1,remove:u.remove});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function ne(e,t,n,r){var o=e.model,a=(0,u.c)(),s=new Array,d=new Map,m=new Map;return o.lods.forEach((function(e,u){if(void 0===r||u===r){var v={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:(0,l.pC)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:(0,h.cS)()};s.push(v),e.parts.forEach((function(e){var r=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),s=o.materials.get(e.material),u=(0,l.pC)(e.attributes.texCoord0),f=(0,l.pC)(e.attributes.normal),_=function(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":case null:case void 0:return 1}}(s.alphaMode);if(!d.has(r)){if(u){if((0,l.pC)(s.textureColor)&&!m.has(s.textureColor)){var T=o.textures.get(s.textureColor),C=(0,i.Z)((0,i.Z)({},T.parameters),{},{preMultiplyAlpha:1!==_});m.set(s.textureColor,new O.x(T.data,C))}if((0,l.pC)(s.textureNormal)&&!m.has(s.textureNormal)){var M=o.textures.get(s.textureNormal);m.set(s.textureNormal,new O.x(M.data,M.parameters))}if((0,l.pC)(s.textureOcclusion)&&!m.has(s.textureOcclusion)){var w=o.textures.get(s.textureOcclusion);m.set(s.textureOcclusion,new O.x(w.data,w.parameters))}if((0,l.pC)(s.textureEmissive)&&!m.has(s.textureEmissive)){var A=o.textures.get(s.textureEmissive);m.set(s.textureEmissive,new O.x(A.data,A.parameters))}if((0,l.pC)(s.textureMetallicRoughness)&&!m.has(s.textureMetallicRoughness)){var S=o.textures.get(s.textureMetallicRoughness);m.set(s.textureMetallicRoughness,new O.x(S.data,S.parameters))}}var E=Math.pow(s.color[0],1/K.K),R=Math.pow(s.color[1],1/K.K),H=Math.pow(s.color[2],1/K.K),D=Math.pow(s.emissiveFactor[0],1/K.K),Z=Math.pow(s.emissiveFactor[1],1/K.K),L=Math.pow(s.emissiveFactor[2],1/K.K),B=(0,l.pC)(s.textureColor)&&u?m.get(s.textureColor):null;d.set(r,new P.G((0,i.Z)((0,i.Z)({},t),{},{transparent:0===_,textureAlphaMode:_,textureAlphaCutoff:s.alphaCutoff,diffuse:[E,R,H],ambient:[E,R,H],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:f?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:(0,l.pC)(B)?B.id:void 0,colorMixMode:s.colorMixMode,normalTextureId:(0,l.pC)(s.textureNormal)&&u?m.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:(0,l.pC)(B)&&!!B.params.preMultiplyAlpha,occlusionTextureId:(0,l.pC)(s.textureOcclusion)&&u?m.get(s.textureOcclusion).id:void 0,emissiveTextureId:(0,l.pC)(s.textureEmissive)&&u?m.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:(0,l.pC)(s.textureMetallicRoughness)&&u?m.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[D,Z,L],mrrFactors:[s.metallicFactor,s.roughnessFactor,t.mrrFactors[2]],isSchematic:!1},n)))}var N=function(e,t){switch(t){case 4:return(0,y.nh)(e);case 5:return(0,y.DA)(e);case 6:return(0,y.jX)(e)}}(e.indices||e.attributes.position.count,e.primitiveType),z=e.attributes.position.count,I=(0,b.gS)(p.ct,z);(0,g.t)(I,e.attributes.position,e.transform);var k=[["position",{data:I.typedBuffer,size:I.elementCount,exclusive:!0}]],V=[["position",N]];if((0,l.pC)(e.attributes.normal)){var U=(0,b.gS)(p.ct,z);(0,c.a)(a,e.transform),(0,g.a)(U,e.attributes.normal,a),k.push(["normal",{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),V.push(["normal",N])}if((0,l.pC)(e.attributes.tangent)){var G=(0,b.gS)(p.ek,z);(0,c.a)(a,e.transform),(0,x.t)(G,e.attributes.tangent,a),k.push(["tangent",{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]),V.push(["tangent",N])}if((0,l.pC)(e.attributes.texCoord0)){var W=(0,b.gS)(p.Eu,z);(0,$.n)(W,e.attributes.texCoord0),k.push(["uv0",{data:W.typedBuffer,size:W.elementCount,exclusive:!0}]),V.push(["uv0",N])}if((0,l.pC)(e.attributes.color)){var q=(0,b.gS)(p.mc,z);if(4===e.attributes.color.elementCount)e.attributes.color instanceof p.ek?(0,x.s)(q,e.attributes.color,255):e.attributes.color instanceof p.mc?(0,J.c)(q,e.attributes.color):e.attributes.color instanceof p.v6&&(0,x.s)(q,e.attributes.color,1/256);else{(0,J.f)(q,255,255,255,255);var j=new p.ne(q.buffer,0,4);e.attributes.color instanceof p.ct?(0,g.s)(j,e.attributes.color,255):e.attributes.color instanceof p.ne?(0,Q.c)(j,e.attributes.color):e.attributes.color instanceof p.mw&&(0,g.s)(j,e.attributes.color,1/256)}k.push(["color",{data:q.typedBuffer,size:q.elementCount,exclusive:!0}]),V.push(["color",N])}var X=new F.Z(k,V);v.stageResources.geometries.push(X),v.stageResources.materials.push(d.get(r)),u&&((0,l.pC)(s.textureColor)&&v.stageResources.textures.push(m.get(s.textureColor)),(0,l.pC)(s.textureNormal)&&v.stageResources.textures.push(m.get(s.textureNormal)),(0,l.pC)(s.textureOcclusion)&&v.stageResources.textures.push(m.get(s.textureOcclusion)),(0,l.pC)(s.textureEmissive)&&v.stageResources.textures.push(m.get(s.textureEmissive)),(0,l.pC)(s.textureMetallicRoughness)&&v.stageResources.textures.push(m.get(s.textureMetallicRoughness))),v.numberOfVertices+=z;var Y=X.boundingInfo;(0,l.pC)(Y)&&((0,h.pp)(v.boundingBox,Y.getBBMin()),(0,h.pp)(v.boundingBox,Y.getBBMax()))}))}})),s}function re(e,t){for(var n=0;n<e.model.lods.length;++n){var i=e.model.lods[n];e.customMeta.esriTreeRendering=!0;var o,a=(0,r.Z)(i.parts);try{for(a.s();!(o=a.n()).done;){var s=o.value,c=s.attributes.normal;if((0,l.Wi)(c))return;for(var u=s.attributes.position,h=u.count,g=(0,f.c)(),x=(0,f.c)(),_=(0,f.c)(),T=(0,b.gS)(p.mc,h),y=(0,b.gS)(p.ct,h),C=(0,d.b)((0,m.c)(),s.transform),M=0;M<h;M++){u.getVec(M,x),c.getVec(M,g),(0,v.m)(x,x,s.transform),(0,v.f)(_,x,t.center),(0,v.E)(_,_,t.radius);var w=_[2],A=(0,v.l)(_),S=Math.min(.45+.55*A*A,1);(0,v.E)(_,_,t.radius),(0,v.m)(_,_,C),(0,v.n)(_,_),n+1!==e.model.lods.length&&e.model.lods.length>1&&(0,v.e)(_,_,g,w>-1?.2:Math.min(-4*w-3.8,1)),y.setVec(M,_),T.set(M,0,255*S),T.set(M,1,255*S),T.set(M,2,255*S),T.set(M,3,255)}s.attributes.normal=y,s.attributes.color=T}}catch(E){a.e(E)}finally{a.f()}}}},83734:function(e,t,n){n.d(t,{w:function(){return a}});var r,i=n(30168),o=n(98634);function a(e){e.vertex.code.add((0,o.H)(r||(r=(0,i.Z)(["vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\nvec3 camToVert = posWorld - camPosWorld;\nbool isBackface = dot(camToVert, normalWorld) > 0.0;\nif (isBackface) {\nposClip.z += 0.0000003 * posClip.w;\n}\nreturn posClip;\n}"]))))}},81221:function(e,t,n){n.d(t,{f:function(){return g}});var r,i,o,a,s,l,c,u=n(43144),d=n(15671),m=n(30168),v=n(71353),f=n(27254),h=n(98634),p=n(43411);function g(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.vertex.include(f.$,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));var n=[(0,h.H)(r||(r=(0,m.Z)(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),(0,h.H)(i||(i=(0,m.Z)(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?(0,h.H)(o||(o=(0,m.Z)(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;"),(0,h.H)(a||(a=(0,m.Z)(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),(0,h.H)(s||(s=(0,m.Z)(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"),t.vertexTangents?(0,h.H)(l||(l=(0,m.Z)(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "])),t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):(0,h.H)(c||(c=(0,m.Z)([""])))];e.vertex.code.add(n[0]),e.vertex.code.add(n[1]),e.vertex.code.add(n[2]),2===t.output&&e.vertex.code.add(n[3]),e.vertex.code.add(n[4])}!function(e){var t=(0,u.Z)((function e(){(0,d.Z)(this,e)}));e.Uniforms=t,e.bindCustomOrigin=function(e,t){(0,p.po)(t,x,b,3),e.setUniform3fv("viewOriginHi",x),e.setUniform3fv("viewOriginLo",b)}}(g||(g={}));var x=(0,v.c)(),b=(0,v.c)()},73782:function(e,t,n){n.d(t,{O:function(){return u}});var r,i,o,a,s=n(30168),l=n(98634);function c(e){var t=(0,l.H)(r||(r=(0,s.Z)(["vec3 decodeNormal(vec2 f) {\nfloat z = 1.0 - abs(f.x) - abs(f.y);\nreturn vec3(f + sign(f) * min(z, 0.0), z);\n}"])));e.fragment.code.add(t),e.vertex.code.add(t)}function u(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add((0,l.H)(i||(i=(0,s.Z)(["vec3 normalModel() {\nreturn normal;\n}"]))))),1===t.normalType&&(e.include(c),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add((0,l.H)(o||(o=(0,s.Z)(["vec3 normalModel() {\nreturn decodeNormal(normalCompressed);\n}"]))))),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add((0,l.H)(a||(a=(0,s.Z)(["vec3 screenDerivativeNormal(vec3 positionView) {\nreturn normalize(cross(dFdx(positionView), dFdy(positionView)));\n}"])))))}},52276:function(e,t,n){n.d(t,{f:function(){return a}});var r,i=n(30168),o=n(98634);function a(e){e.attributes.add("position","vec3"),e.vertex.code.add((0,o.H)(r||(r=(0,i.Z)(["vec3 positionModel() { return position; }"]))))}},53230:function(e,t,n){n.d(t,{R:function(){return c}});var r,i,o,a=n(30168),s=n(98634);function l(e){e.vertex.code.add((0,s.H)(r||(r=(0,a.Z)(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),s.H.int(1),s.H.int(3),s.H.int(4),s.H.int(1)))}function c(e,t){t.symbolColor?(e.include(l),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add((0,s.H)(i||(i=(0,a.Z)(["int symbolColorMixMode;\nvec4 getSymbolColor() {\nreturn decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n}\nvoid forwardColorMixMode() {\ncolorMixMode = float(symbolColorMixMode) + 0.5;\n}"])))):e.vertex.code.add((0,s.H)(o||(o=(0,a.Z)(["vec4 getSymbolColor() { return vec4(1.0); }\nvoid forwardColorMixMode() {}"]))))}},60113:function(e,t,n){n.d(t,{D:function(){return l}});var r,i,o,a=n(30168),s=n(98634);function l(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add((0,s.H)(r||(r=(0,a.Z)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\n}"]))))),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add((0,s.H)(i||(i=(0,a.Z)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\nvuvRegion = uvRegion;\n}"]))))),0===t.attributeTextureCoordinates&&e.vertex.code.add((0,s.H)(o||(o=(0,a.Z)(["void forwardTextureCoordinates() {}"]))))}},28719:function(e,t,n){n.d(t,{B:function(){return T}});var r,i,o,a,s,l,c,u=n(30168),d=n(73782),m=n(43144),v=n(15671),f=n(11873),h=n(81949),p=n(71353),g=n(52276),x=n(27254),b=n(98634);function _(e,t){e.include(g.f),e.vertex.include(x.$,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add((0,b.H)(r||(r=(0,u.Z)(["vec3 positionWorldCameraRelative() {\nvec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();\nvec3 transform_CameraRelativeFromModel = dpAdd(\nuTransform_WorldFromModel_TL,\nuTransform_WorldFromModel_TH,\n-uTransform_WorldFromView_TL,\n-uTransform_WorldFromView_TH\n);\nreturn transform_CameraRelativeFromModel + rotatedModelPosition;\n}\nvec3 position_view() {\nreturn uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n}\nvoid forwardPosition() {\nvPositionWorldCameraRelative = positionWorldCameraRelative();\nvPosition_view = position_view();\ngl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n}\nvec3 positionWorld() {\nreturn uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n}"])))),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add((0,b.H)(i||(i=(0,u.Z)(["vec3 positionWorld() {\nreturn uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n}"]))))}function T(e,t){0===t.normalType||1===t.normalType?(e.include(d.O,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add((0,b.H)(o||(o=(0,u.Z)(["void forwardNormal() {\nvNormalWorld = uTransformNormal_GlobalFromModel * normalModel();\nvNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;\n}"]))))):2===t.normalType?(e.include(_,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add((0,b.H)(a||(a=(0,u.Z)(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "])),1===t.viewingMode?(0,b.H)(s||(s=(0,u.Z)(["normalize(vPositionWorldCameraRelative);"]))):(0,b.H)(l||(l=(0,u.Z)(["vec3(0.0, 0.0, 1.0);"])))))):e.vertex.code.add((0,b.H)(c||(c=(0,u.Z)(["void forwardNormal() {}"]))))}!function(e){var t=(0,m.Z)((function e(){(0,v.Z)(this,e),this.worldFromModel_RS=(0,f.c)(),this.worldFromModel_TH=(0,p.c)(),this.worldFromModel_TL=(0,p.c)()}));e.ModelTransform=t;var n=(0,m.Z)((function e(){(0,v.Z)(this,e),this.worldFromView_TH=(0,p.c)(),this.worldFromView_TL=(0,p.c)(),this.viewFromCameraRelative_RS=(0,f.c)(),this.projFromView=(0,h.c)()}));e.ViewProjectionTransform=n,e.bindModelTransform=function(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)},e.bindViewProjTransform=function(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)}}(_||(_={})),(T||(T={})).bindUniforms=function(e,t){e.setUniformMatrix4fv("viewNormal",t)}},27284:function(e,t,n){n.d(t,{i:function(){return d}});var r,i,o,a,s=n(30168),l=n(60113),c=n(98634);function u(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add((0,c.H)(r||(r=(0,s.Z)(["#ifndef GL_EXT_shader_texture_lod\nfloat calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\nfloat deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\nreturn max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n#endif\nvec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\nvec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\nvec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\nfloat maxdUV = 0.125;\nvec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\nvec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n#else\nvec2 dUVdxAuto = dFdx(uvAtlas);\nvec2 dUVdyAuto = dFdy(uvAtlas);\nfloat mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\nfloat autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\nreturn texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}"]))))}function d(e,t){e.include(l.D,t),e.fragment.code.add((0,c.H)(i||(i=(0,s.Z)(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),t.supportsTextureAtlas?"vec2 size;":"")),1===t.attributeTextureCoordinates&&e.fragment.code.add((0,c.H)(o||(o=(0,s.Z)(["vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\nreturn texture2D(tex, params.uv);\n}"])))),2===t.attributeTextureCoordinates&&(e.include(u),e.fragment.code.add((0,c.H)(a||(a=(0,s.Z)(["vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\nreturn textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n}"])))))}},6781:function(e,t,n){n.d(t,{s:function(){return A}});var r,i,o,a,s,l,c,u,d,m,v,f,h=n(30168),p=n(33280),g=n(94951),x=n(73782),b=n(60113),_=n(28719),T=n(16574),y=n(137),C=n(18607),M=n(10763),w=n(98634);function A(e,t){var n=e.vertex.code,A=e.fragment.code;1!==t.output&&3!==t.output||(e.include(g.w,{linearDepth:!0}),e.include(b.D,t),e.include(C.kl,t),e.include(T.F,t),e.include(p.p2,t),e.vertex.uniforms.add("cameraNearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add((0,w.H)(r||(r=(0,h.Z)(["void main(void) {\nvpos = calculateVPos();\nvpos = subtractOrigin(vpos);\nvpos = addVerticalOffset(vpos, localOrigin);\ngl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);\nforwardTextureCoordinates();\n}"])))),e.include(M.sj,t),A.add((0,w.H)(i||(i=(0,h.Z)(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),t.hasColorTexture?(0,w.H)(o||(o=(0,h.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):""))),2===t.output&&(e.include(g.w,{linearDepth:!1}),e.include(x.O,t),e.include(_.B,t),e.include(b.D,t),e.include(C.kl,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),n.add((0,w.H)(a||(a=(0,h.Z)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===t.normalType?(0,w.H)(s||(s=(0,h.Z)(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]))):"")),e.include(p.p2,t),e.include(M.sj,t),A.add((0,w.H)(l||(l=(0,h.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),t.hasColorTexture?(0,w.H)(c||(c=(0,h.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===t.normalType?(0,w.H)(u||(u=(0,h.Z)(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]))):(0,w.H)(d||(d=(0,h.Z)(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"])))))),4===t.output&&(e.include(g.w,{linearDepth:!1}),e.include(b.D,t),e.include(C.kl,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add((0,w.H)(m||(m=(0,h.Z)(["void main(void) {\nvpos = calculateVPos();\nvpos = subtractOrigin(vpos);\nvpos = addVerticalOffset(vpos, localOrigin);\ngl_Position = transformPosition(proj, view, vpos);\nforwardTextureCoordinates();\n}"])))),e.include(p.p2,t),e.include(M.sj,t),e.include(y.bA),A.add((0,w.H)(v||(v=(0,h.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),t.hasColorTexture?(0,w.H)(f||(f=(0,h.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))}},38171:function(e,t,n){n.d(t,{Q:function(){return u}});var r,i,o,a,s=n(30168),l=n(27284),c=n(98634);function u(e,t){var n=e.fragment;t.vertexTangents?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?n.code.add((0,c.H)(r||(r=(0,s.Z)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\nvec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"])))):n.code.add((0,c.H)(i||(i=(0,s.Z)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = vTangent.w;\nvec3 tangent = normalize(vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"]))))):(e.extensions.add("GL_OES_standard_derivatives"),n.code.add((0,c.H)(o||(o=(0,s.Z)(["mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\nvec3 Q1 = dFdx(pos);\nvec3 Q2 = dFdy(pos);\nvec2 stx = dFdx(st);\nvec2 sty = dFdy(st);\nfloat det = stx.t * sty.s - sty.t * stx.s;\nvec3 T = stx.t * Q2 - sty.t * Q1;\nT = T - normal * dot(normal, T);\nT *= inversesqrt(max(dot(T,T), 1.e-10));\nvec3 B = sign(det) * cross(normal, T);\nreturn mat3(T, B, normal);\n}"]))))),0!==t.attributeTextureCoordinates&&(e.include(l.i,t),n.uniforms.add("normalTexture","sampler2D"),n.uniforms.add("normalTextureSize","vec2"),n.code.add((0,c.H)(a||(a=(0,s.Z)(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":"")))}},30694:function(e,t,n){n.d(t,{K:function(){return s}});var r,i,o=n(30168),a=n(98634);function s(e,t){var n=e.fragment;t.receiveAmbientOcclusion?(n.uniforms.add("ssaoTex","sampler2D"),n.uniforms.add("viewportPixelSz","vec4"),n.code.add((0,a.H)(r||(r=(0,o.Z)(["float evaluateAmbientOcclusion() {\nreturn 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n}\nfloat evaluateAmbientOcclusionInverse() {\nfloat ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\nreturn viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n}"]))))):n.code.add((0,a.H)(i||(i=(0,o.Z)(["float evaluateAmbientOcclusion() { return 0.0; }\nfloat evaluateAmbientOcclusionInverse() { return 1.0; }"]))))}},4460:function(e,t,n){n.d(t,{X:function(){return R}});var r,i,o,a,s=n(30168),l=n(98634);function c(e,t){var n=e.fragment,c=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===c?(n.uniforms.add("lightingAmbientSH0","vec3"),n.code.add((0,l.H)(r||(r=(0,s.Z)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):1===c?(n.uniforms.add("lightingAmbientSH_R","vec4"),n.uniforms.add("lightingAmbientSH_G","vec4"),n.uniforms.add("lightingAmbientSH_B","vec4"),n.code.add((0,l.H)(i||(i=(0,s.Z)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec4 sh0 = vec4(\n0.282095,\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y\n);\nvec3 ambientLight = vec3(\ndot(lightingAmbientSH_R, sh0),\ndot(lightingAmbientSH_G, sh0),\ndot(lightingAmbientSH_B, sh0)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):2===c&&(n.uniforms.add("lightingAmbientSH0","vec3"),n.uniforms.add("lightingAmbientSH_R1","vec4"),n.uniforms.add("lightingAmbientSH_G1","vec4"),n.uniforms.add("lightingAmbientSH_B1","vec4"),n.uniforms.add("lightingAmbientSH_R2","vec4"),n.uniforms.add("lightingAmbientSH_G2","vec4"),n.uniforms.add("lightingAmbientSH_B2","vec4"),n.code.add((0,l.H)(o||(o=(0,s.Z)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nvec4 sh1 = vec4(\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y,\n1.092548 * normal.x * normal.y\n);\nvec4 sh2 = vec4(\n1.092548 * normal.y * normal.z,\n0.315392 * (3.0 * normal.z * normal.z - 1.0),\n1.092548 * normal.x * normal.z,\n0.546274 * (normal.x * normal.x - normal.y * normal.y)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R1, sh1),\ndot(lightingAmbientSH_G1, sh1),\ndot(lightingAmbientSH_B1, sh1)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R2, sh2),\ndot(lightingAmbientSH_G2, sh2),\ndot(lightingAmbientSH_B2, sh2)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"])))),1!==t.pbrMode&&2!==t.pbrMode||n.code.add((0,l.H)(a||(a=(0,s.Z)(["const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\nvec3 calculateAmbientRadiance(float ambientOcclusion)\n{\nvec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\nreturn ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n}"])))))}var u,d=n(30694);function m(e){var t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add((0,l.H)(u||(u=(0,s.Z)(["vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\nfloat dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);\ndotVal = mix(dotVal, 1.0, lightingFixedFactor);\nreturn lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n}"]))))}var v,f,h,p,g,x,b,_,T,y,C,M,w,A=n(2116),S=n(85586),E=n(23235);function R(e,t){var n=e.fragment;e.include(m),e.include(d.K,t),0!==t.pbrMode&&e.include(A.T,t),e.include(c,t),t.receiveShadows&&e.include(E.hX,t),n.uniforms.add("lightingGlobalFactor","float"),n.uniforms.add("ambientBoostFactor","float"),e.include(S.e),n.code.add((0,l.H)(v||(v=(0,s.Z)(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "])),0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),n.code.add((0,l.H)(f||(f=(0,s.Z)(["\n    float additionalDirectedAmbientLight(vec3 vPosWorld) {\n      float vndl = dot(",", lightingMainDirection);\n      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    }\n  "])),1===t.viewingMode?(0,l.H)(h||(h=(0,s.Z)(["normalize(vPosWorld)"]))):(0,l.H)(p||(p=(0,s.Z)(["vec3(0.0, 0.0, 1.0)"]))))),n.code.add((0,l.H)(g||(g=(0,s.Z)(["vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\nfloat additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);\nreturn (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n}"])))),0===t.pbrMode||4===t.pbrMode?n.code.add((0,l.H)(x||(x=(0,s.Z)(["vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)\n{\nvec3 mainLighting = evaluateMainLighting(normalWorld, shadow);\nvec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);\nvec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\nvec3 totalLight = mainLighting + ambientLighting + additionalLight;\ntotalLight = min(totalLight, vec3(PI));\nvec3 outColor = vec3((albedoLinear / PI) * totalLight);\nreturn pow(outColor, vec3(INV_GAMMA_SRGB));\n}"])))):1!==t.pbrMode&&2!==t.pbrMode||(n.code.add((0,l.H)(b||(b=(0,s.Z)(["const float fillLightIntensity = 0.25;\nconst float horizonLightDiffusion = 0.4;\nconst float additionalAmbientIrradianceFactor = 0.02;\nvec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n{\nvec3 viewDirection = -viewDir;\nvec3 mainLightDirection = lightingMainDirection;\nvec3 h = normalize(viewDirection + mainLightDirection);\nPBRShadingInfo inputs;\ninputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\ninputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\ninputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\ninputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\ninputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\nvec3 reflectedView = normalize(reflect(viewDirection, normal));\ninputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\ninputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\ninputs.ssao = ssao;\ninputs.metalness = mrr[0];\ninputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);"])))),n.code.add((0,l.H)(_||(_=(0,s.Z)(["inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\ninputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));\ninputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);"])))),n.code.add((0,l.H)(T||(T=(0,s.Z)(["vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\nambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\ninputs.NdotAmbDir = abs(dot(normal, ambientDir));\nvec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\nvec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\ninputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\ninputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;"])))),n.code.add((0,l.H)(y||(y=(0,s.Z)(["vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\nvec3 horizonRingH = normalize(viewDirection + horizonRingDir);\ninputs.NdotH_Horizon = dot(normal, horizonRingH);\nvec3 mainLightRadianceComponent = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\nvec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight;\ninputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\ninputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\ninputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);"])))),n.code.add((0,l.H)(C||(C=(0,s.Z)(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "])),2===t.pbrMode?(0,l.H)(M||(M=(0,s.Z)(["vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));"]))):(0,l.H)(w||(w=(0,s.Z)(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"]))))))}},96658:function(e,t,n){n.d(t,{k:function(){return c}});var r,i,o,a,s=n(30168),l=n(98634);function c(e,t){var n=e.fragment;n.code.add((0,l.H)(r||(r=(0,s.Z)(["struct ShadingNormalParameters {\nvec3 normalView;\nvec3 viewDirection;\n} shadingParams;"])))),1===t.doubleSidedMode?n.code.add((0,l.H)(i||(i=(0,s.Z)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n}"])))):2===t.doubleSidedMode?n.code.add((0,l.H)(o||(o=(0,s.Z)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n}"])))):n.code.add((0,l.H)(a||(a=(0,s.Z)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn normalize(params.normalView);\n}"]))))}},41481:function(e,t,n){n.d(t,{jV:function(){return h},nW:function(){return p}});var r,i,o,a,s,l,c,u,d=n(30168),m=n(8229),v=n(27284),f=n(98634);(0,m.f)(0,.6,.2);function h(e,t){var n=e.fragment,m=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&m&&e.include(v.i,t),2!==t.pbrMode?(0===t.pbrMode&&n.code.add((0,f.H)(r||(r=(0,d.Z)(["float getBakedOcclusion() { return 1.0; }"])))),1===t.pbrMode&&(n.uniforms.add("emissionFactor","vec3"),n.uniforms.add("mrrFactors","vec3"),n.code.add((0,f.H)(i||(i=(0,d.Z)(["vec3 mrr;\nvec3 emission;\nfloat occlusion;"])))),t.hasMetalnessAndRoughnessTexture&&(n.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texMetallicRoughnessSize","vec2"),n.code.add((0,f.H)(o||(o=(0,d.Z)(["void applyMetallnessAndRoughness(TextureLookupParameter params) {\nvec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\nmrr[0] *= metallicRoughness.b;\nmrr[1] *= metallicRoughness.g;\n}"]))))),t.hasEmissionTexture&&(n.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texEmissionSize","vec2"),n.code.add((0,f.H)(a||(a=(0,d.Z)(["void applyEmission(TextureLookupParameter params) {\nemission *= textureLookup(texEmission, params).rgb;\n}"]))))),t.hasOcclusionTexture?(n.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texOcclusionSize","vec2"),n.code.add((0,f.H)(s||(s=(0,d.Z)(["void applyOcclusion(TextureLookupParameter params) {\nocclusion *= textureLookup(texOcclusion, params).r;\n}\nfloat getBakedOcclusion() {\nreturn occlusion;\n}"]))))):n.code.add((0,f.H)(l||(l=(0,d.Z)(["float getBakedOcclusion() { return 1.0; }"])))),n.code.add((0,f.H)(c||(c=(0,d.Z)(["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "])),m?"vtc.uv = vuv0;":"",t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":"")))):n.code.add((0,f.H)(u||(u=(0,d.Z)(["const vec3 mrr = vec3(0.0, 0.6, 0.2);\nconst vec3 emission = vec3(0.0);\nfloat occlusion = 1.0;\nvoid applyPBRFactors() {}\nfloat getBakedOcclusion() { return 1.0; }"]))))}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},27254:function(e,t,n){n.d(t,{$:function(){return l},I:function(){return c}});var r,i,o=n(30168),a=n(93169),s=n(98634);function l(e,t){var n=e.code;t.doublePrecisionRequiresObfuscation?n.add((0,s.H)(r||(r=(0,o.Z)(["vec3 dpPlusFrc(vec3 a, vec3 b) {\nreturn mix(a, a + b, vec3(notEqual(b, vec3(0))));\n}\nvec3 dpMinusFrc(vec3 a, vec3 b) {\nreturn mix(vec3(0), a - b, vec3(notEqual(a, b)));\n}\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = dpPlusFrc(hiA, hiB);\nvec3 e = dpMinusFrc(t1, hiA);\nvec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\nreturn t1 + t2;\n}"])))):n.add((0,s.H)(i||(i=(0,o.Z)(["vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = hiA + hiB;\nvec3 e = t1 - hiA;\nvec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\nreturn t1 + t2;\n}"]))))}function c(e){return!!(0,a.Z)("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}},14282:function(e,t,n){n.d(t,{a:function(){return s}});var r,i=n(30168),o=n(98634),a=n(37825);function s(e,t){var n=(0,o.H)(r||(r=(0,i.Z)(["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),t.name,0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":"");(0,a.CG)()&&(e.fragment.code.add(n),e.vertex.code.add(n))}},71033:function(e,t,n){n.d(t,{y:function(){return s}});var r,i=n(30168),o=n(116),a=n(98634);function s(e){e.include(o.Y),e.code.add((0,a.H)(r||(r=(0,i.Z)(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),a.H.int(1),a.H.int(2),a.H.int(3),a.H.int(2),a.H.int(3)))}},10052:function(e,t,n){n.d(t,{G:function(){return W},R:function(){return K}});var r=n(1413),i=n(15671),o=n(43144),a=n(11752),s=n(61120),l=n(60136),c=n(29388),u=n(11873),d=n(11186),m=n(71353),v=n(55158),f=n(10763),h=n(40485),p=n(56529),g=n(78041),x=n(76783),b=n(33236),_=n(22909),T=n(27366),y=n(33280),C=n(81221),M=n(49223),w=n(137),A=n(15226),S=n(41481),E=n(23235),R=n(18607),F=n(27254),O=n(41012),P=n(82144),H=n(31132),D=n(33559),Z=n(7566),L=n(27627),B=n(50411),N=n(65630),z=n(36207),I=function(e){(0,l.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,pbrMode:r.usePBR?r.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:r.normalsTypeDerivate?3:0,doubleSidedMode:r.doubleSidedMode,vertexTangents:r.vertexTangents,attributeTextureCoordinates:r.hasMetalnessAndRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture||r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:(0,F.I)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new L.$(e.rctx,i,Z.i)}},{key:"bindPass",value:function(e,t){var n,r;(0,O.II)(this.program,t.camera.projectionMatrix);var i=this.configuration.output;(1===this.configuration.output||t.multipassTerrainEnabled||3===i)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,A.p)(this.program,t)),7===i&&(this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",_.FZ[e.colorMixMode])),0===i?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",_.FZ[e.colorMixMode]),this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.configuration.usePBR&&(0,S.nW)(this.program,e,this.configuration.isSchematic)):4===i&&(0,w.wW)(this.program,t),(0,R.uj)(this.program,e),(0,M.Mo)(this.program,e,t),(0,_.bj)(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==e.textureAlphaMode&&3!==e.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff),null==(n=t.shadowMap)||n.bind(this.program),null==(r=t.ssaoHelper)||r.bind(this.program,t.camera)}},{key:"bindDraw",value:function(e){var t=this.configuration.instancedDoublePrecision?(0,m.f)(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;(0,O.q0)(this.program,t,e.camera.viewMatrix),this.program.rebindTextures(),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&(0,O.fb)(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&C.f.bindCustomOrigin(this.program,t),(0,y.Vv)(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&(0,E.vL)(this.program,e,t)}},{key:"setPipeline",value:function(e,t){var n=this.configuration,r=3===e,i=2===e;return(0,z.sm)({blending:0!==n.output&&7!==n.output||!n.transparent?null:r?g.wu:(0,g.$L)(e),culling:k(n)&&(0,z.zp)(n.cullFace),depthTest:{func:(0,g.$x)(e)},depthWrite:r||i?n.writeDepth&&z.LZ:null,colorWrite:z.BK,stencilWrite:n.sceneHasOcludees?B.s3:null,stencilTest:n.sceneHasOcludees?t?B.eD:B.RY:null,polygonOffset:r||i?null:(0,g.je)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,a.Z)((0,s.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(H.A);function k(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}I.shader=new P.J(N.D,(function(){return n.e(294).then(n.bind(n,40294))}));var V=function(e){(0,l.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).output=0,e.alphaDiscardMode=1,e.doubleSidedMode=0,e.isSchematic=!1,e.vertexColors=!1,e.offsetBackfaces=!1,e.symbolColors=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.sliceHighlightDisabled=!1,e.receiveAmbientOcclusion=!1,e.screenSizePerspective=!1,e.textureAlphaPremultiplied=!1,e.hasColorTexture=!1,e.usePBR=!1,e.hasMetalnessAndRoughnessTexture=!1,e.hasEmissionTexture=!1,e.hasOcclusionTexture=!1,e.hasNormalTexture=!1,e.instanced=!1,e.instancedColor=!1,e.instancedDoublePrecision=!1,e.vertexTangents=!1,e.normalsTypeDerivate=!1,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparent=!1,e.enableOffset=!0,e.cullFace=0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,o.Z)(n)}(D.m);(0,T._)([(0,D.o)({count:8})],V.prototype,"output",void 0),(0,T._)([(0,D.o)({count:4})],V.prototype,"alphaDiscardMode",void 0),(0,T._)([(0,D.o)({count:3})],V.prototype,"doubleSidedMode",void 0),(0,T._)([(0,D.o)()],V.prototype,"isSchematic",void 0),(0,T._)([(0,D.o)()],V.prototype,"vertexColors",void 0),(0,T._)([(0,D.o)()],V.prototype,"offsetBackfaces",void 0),(0,T._)([(0,D.o)()],V.prototype,"symbolColors",void 0),(0,T._)([(0,D.o)()],V.prototype,"vvSize",void 0),(0,T._)([(0,D.o)()],V.prototype,"vvColor",void 0),(0,T._)([(0,D.o)()],V.prototype,"verticalOffset",void 0),(0,T._)([(0,D.o)()],V.prototype,"receiveShadows",void 0),(0,T._)([(0,D.o)()],V.prototype,"slicePlaneEnabled",void 0),(0,T._)([(0,D.o)()],V.prototype,"sliceHighlightDisabled",void 0),(0,T._)([(0,D.o)()],V.prototype,"receiveAmbientOcclusion",void 0),(0,T._)([(0,D.o)()],V.prototype,"screenSizePerspective",void 0),(0,T._)([(0,D.o)()],V.prototype,"textureAlphaPremultiplied",void 0),(0,T._)([(0,D.o)()],V.prototype,"hasColorTexture",void 0),(0,T._)([(0,D.o)()],V.prototype,"usePBR",void 0),(0,T._)([(0,D.o)()],V.prototype,"hasMetalnessAndRoughnessTexture",void 0),(0,T._)([(0,D.o)()],V.prototype,"hasEmissionTexture",void 0),(0,T._)([(0,D.o)()],V.prototype,"hasOcclusionTexture",void 0),(0,T._)([(0,D.o)()],V.prototype,"hasNormalTexture",void 0),(0,T._)([(0,D.o)()],V.prototype,"instanced",void 0),(0,T._)([(0,D.o)()],V.prototype,"instancedColor",void 0),(0,T._)([(0,D.o)()],V.prototype,"instancedDoublePrecision",void 0),(0,T._)([(0,D.o)()],V.prototype,"vertexTangents",void 0),(0,T._)([(0,D.o)()],V.prototype,"normalsTypeDerivate",void 0),(0,T._)([(0,D.o)()],V.prototype,"writeDepth",void 0),(0,T._)([(0,D.o)()],V.prototype,"sceneHasOcludees",void 0),(0,T._)([(0,D.o)()],V.prototype,"transparent",void 0),(0,T._)([(0,D.o)()],V.prototype,"enableOffset",void 0),(0,T._)([(0,D.o)({count:3})],V.prototype,"cullFace",void 0),(0,T._)([(0,D.o)({count:4})],V.prototype,"transparencyPassType",void 0),(0,T._)([(0,D.o)()],V.prototype,"multipassTerrainEnabled",void 0),(0,T._)([(0,D.o)()],V.prototype,"cullAboveGround",void 0);var U=n(40563),G=function(e){(0,l.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,pbrMode:r.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangents:!1,attributeTextureCoordinates:r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:(0,F.I)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new L.$(e.rctx,i,Z.i)}}]),n}(I);G.shader=new P.J(U.R,(function(){return n.e(8834).then(n.bind(n,88834))}));var W=function(e){(0,l.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e,j)).supportsEdges=!0,r.techniqueConfig=new V,r.vertexBufferLayout=function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,n=(0,v.U$)().vec3f("position").vec3f("normal");return e.vertexTangents&&n.vec4f("tangent"),t&&n.vec2f("uv0"),e.vertexColors&&n.vec4u8("color"),e.symbolColors&&n.vec4u8("symbolColor"),n}(r.parameters),r.instanceBufferLayout=e.instanced?K(r.parameters):null,r}return(0,o.Z)(n,[{key:"isVisibleInPass",value:function(e){return 4!==e&&6!==e&&7!==e||this.parameters.castShadows}},{key:"isVisible",value:function(){var e=this.parameters;if(!(0,a.Z)((0,s.Z)(n.prototype),"isVisible",this).call(this)||0===e.layerOpacity)return!1;var t=e.instanced,r=e.vertexColors,i=e.symbolColors,o=!!t&&t.indexOf("color")>-1,l=e.vvColorEnabled,c="replace"===e.colorMixMode,u=e.opacity>0,d=e.externalColor&&e.externalColor[3]>0;return r&&(o||l||i)?!!c||u:r?c?d:u:o||l||i?!!c||u:c?d:u}},{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.vertexTangents=this.parameters.vertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.parameters.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.parameters.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.parameters.normals,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.cullFace=this.parameters.slicePlaneEnabled?0:this.parameters.cullFace,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.symbolColors=this.parameters.symbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?1:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.parameters.instanced&&this.parameters.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!t.ssaoEnabled&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.parameters.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.parameters.usePBR&&this.parameters.isSchematic,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<g.ve),this.techniqueConfig}},{key:"intersect",value:function(e,t,n,r,i,o,a){if(null!==this.parameters.verticalOffset){var s=r.camera;(0,d.s)(te,n[12],n[13],n[14]);var l=null;switch(r.viewingMode){case 1:l=(0,d.n)(Y,te);break;case 2:l=(0,d.g)(Y,Q)}var c=0;if(null!==this.parameters.verticalOffset){var u=(0,d.f)(ne,te,s.eye),m=(0,d.l)(u),v=(0,d.a)(u,u,1/m),f=null;this.parameters.screenSizePerspective&&(f=(0,d.d)(l,v)),c+=(0,_.Hx)(s,m,this.parameters.verticalOffset,f,this.parameters.screenSizePerspective)}(0,d.a)(l,l,c),(0,d.t)(ee,l,r.transform.inverseRotation),i=(0,d.f)($,i,ee),o=(0,d.f)(J,o,ee)}(0,_.Bw)(e,t,r,i,o,(0,x.W9)(r.verticalOffset),a)}},{key:"requiresSlot",value:function(e){return e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2)||20===e}},{key:"createGLMaterial",value:function(e){return 0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output?new q(e):null}},{key:"createBufferWriter",value:function(){return new X(this.vertexBufferLayout,this.instanceBufferLayout)}}]),n}(p.F),q=function(e){(0,l.Z)(n,e);var t=(0,c.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,(0,r.Z)((0,r.Z)({},e),e.material.parameters))}return(0,o.Z)(n,[{key:"updateParameters",value:function(e){var t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(t.treeRendering?G:I,e)}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMappingEnabled})}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return 0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.parameters,e),this.bindTextures(t.program)}}]),n}(h.Z),j=(0,r.Z)({textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:(0,u.c)(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:f.F,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},p.z),X=function(){function e(t,n){(0,i.Z)(this,e),this.vertexBufferLayout=t,this.instanceBufferLayout=n}return(0,o.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,r){(0,b.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,r)}}]),e}();function K(e){var t=(0,v.U$)();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}var $=(0,m.c)(),J=(0,m.c)(),Q=(0,m.f)(0,0,1),Y=(0,m.c)(),ee=(0,m.c)(),te=(0,m.c)(),ne=(0,m.c)()},53634:function(e,t,n){n.d(t,{Z:function(){return f}});var r=n(1413),i=n(15671),o=n(43144),a=n(32718),s=n(92026),l=n(37825),c=n(8548),u=n(15880),d=n(51378),m=n(3384),v=a.Z.getLogger("esri.views.webgl.FrameBufferObject"),f=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,i.Z)(this,e),this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=(0,r.Z)({},n),t.instanceCounter.increment(c._g.Framebuffer,this),(0,s.pC)(o)){Array.isArray(o)||(o=[o]);for(var l=0;l<o.length;++l){var m,v,f=o[l],p=void 0;h(f)?(p=f.descriptor,this._colorAttachments.set(36064+l,f)):(p=f,this._colorAttachments.set(36064+l,new d.Z(t,f))),0!==(null==(m=this._desc)?void 0:m.colorTarget)&&2!==(null==(v=this._desc)?void 0:v.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),this._validateColorAttachmentPoint(36064+l),this._validateTextureDimensions(p,this._desc)}}if(a instanceof u.Z){var x,b=null!=(x=this._desc.depthStencilTarget)?x:3;2===b?this._stencilAttachment=a:1===b||3===b?this._depthAttachment=a:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),g(a.descriptor,this._desc)}else if((0,s.pC)(a)){var _;this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),h(a)?(this._depthStencilTexture=a,_=a.descriptor):this._depthStencilTexture=new d.Z(this._context,a),this._validateTextureDimensions(_,this._desc)}}return(0,o.Z)(e,[{key:"dispose",value:function(){if(this._desc){var e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(c._g.Framebuffer,this),this._desc=null}}},{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){var e=this._colorAttachments.get(36064);return e&&h(e)?e:null}},{key:"colorAttachment",get:function(){return this._colorAttachments.get(36064)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width}},{key:"height",get:function(){return this._desc.height}},{key:"gpuMemoryUsage",get:function(){return(0,m.un)(this.colorAttachment)+(0,m.un)(this.depthStencilAttachment)}},{key:"getColorTexture",value:function(e){var t=this._colorAttachments.get(e);return t&&h(t)?t:null}},{key:"framebufferTexture2D",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:36064,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3553,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;t.framebufferTexture2D(t.FRAMEBUFFER,n,r,e,i)}},{key:"attachColorTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36064;if(e){this._validateColorAttachmentPoint(t);var n=e.descriptor;this._validateTextureDimensions(n,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(e.glName,this._context.gl,t)),this._colorAttachments.set(t,e)}}},{key:"detachColorTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,t=this._colorAttachments.get(e);if(h(t)){var n=t;return this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,e)),this._colorAttachments.delete(e),n}}},{key:"attachDepthStencilTexture",value:function(e){if(!(0,s.Wi)(e)){var t=e.descriptor;34041!==t.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==t.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDimensions(t,this._desc),this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(e.glName,this._context.gl,c.Lu)),this._depthStencilTexture=e}}},{key:"detachDepthStencilTexture",value:function(){var e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,c.Lu)),this._depthStencilTexture=null,e}},{key:"attachDepthStencilBuffer",value:function(e){if(!(0,s.Wi)(e)){var t=e.descriptor;if(34041!==t.internalFormat&&33189!==t.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),g(t,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===t.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl,r=1===this._desc.depthStencilTarget?n.DEPTH_ATTACHMENT:n.DEPTH_STENCIL_ATTACHMENT;n.framebufferRenderbuffer(n.FRAMEBUFFER,r,n.RENDERBUFFER,e.glName)}this._depthAttachment=e}}},{key:"detachDepthStencilBuffer",value:function(){var e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);var n=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,null)}return this._depthAttachment=null,t}},{key:"detachAll",value:function(){this.detachColorTexture(),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}},{key:"copyToTexture",value:function(e,t,n,r,i,o,a){(e<0||t<0||i<0||o<0)&&console.error("Offsets cannot be negative!"),(n<=0||r<=0)&&console.error("Copy width and height must be greater than zero!");var s=this._desc,l=a.descriptor;3553!==a.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(e+n>s.width||t+r>s.height||i+n>l.width||o+r>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");var c=this._context,u=c.bindTexture(a,d.Z.TEXTURE_UNIT_FOR_UPDATES);c.bindFramebuffer(this),c.gl.copyTexSubImage2D(3553,0,i,o,e,t,n,r),c.bindTexture(u,d.Z.TEXTURE_UNIT_FOR_UPDATES)}},{key:"readPixels",value:function(e,t,n,r,i,o,a){(n<=0||r<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,n,r,i,o,a)}},{key:"resize",value:function(e,t){var n=this._desc;if(n.width!==e||n.height!==t){if(!this._initialized)return n.width=e,n.height=t,this._colorAttachments.forEach((function(n){n&&n.resize(e,t)})),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,t));n.width=e,n.height=t,this._colorAttachments.forEach((function(n){n&&n.resize(e,t)})),null!=this._depthStencilTexture?this._depthStencilTexture.resize(e,t):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,t),this._stencilAttachment&&this._stencilAttachment.resize(e,t)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}},{key:"initializeAndBind",value:function(){var e,t,n,r,i=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3553,a=this._context.gl;if(this._initialized)a.bindFramebuffer(a.FRAMEBUFFER,this.glName);else{this._glName&&a.deleteFramebuffer(this._glName);var s=this._context,c=a.createFramebuffer(),m=this._desc,v=null!=(e=m.colorTarget)?e:1,f=null!=(t=m.width)?t:1,g=null!=(n=m.height)?n:1;if(a.bindFramebuffer(a.FRAMEBUFFER,c),0===this._colorAttachments.size)if(0===v)this._colorAttachments.set(36064,p(s,m,2===this.descriptor.colorTarget?34067:3553));else{var x=new u.Z(s,{internalFormat:32854,width:f,height:g});this._colorAttachments.set(36064,x)}this._colorAttachments.forEach((function(e,t){e&&(h(e)?i.framebufferTexture2D(e.glName,a,t,o):a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,e.glName))}));var b=null!=(r=m.depthStencilTarget)?r:0;switch(b){case 1:case 3:this._depthAttachment||(this._depthAttachment=new u.Z(s,{internalFormat:1===m.depthStencilTarget?33189:34041,width:f,height:g}));var _=1===b?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT;a.framebufferRenderbuffer(a.FRAMEBUFFER,_,a.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new u.Z(s,{internalFormat:36168,width:f,height:g})),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){s.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");var T={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:f,height:g};this._depthStencilTexture=new d.Z(s,T)}this.framebufferTexture2D(this._depthStencilTexture.glName,a,a.DEPTH_STENCIL_ATTACHMENT,o)}(0,l.CG)()&&a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=c,this._initialized=!0}}},{key:"_disposeColorAttachments",value:function(){var e=this;this._colorAttachments.forEach((function(t,n){if(h(t))e._initialized&&(e._context.bindFramebuffer(e),e.framebufferTexture2D(null,e._context.gl,n)),t.dispose();else if(t instanceof WebGLRenderbuffer){var r=e._context.gl;e._initialized&&(e._context.bindFramebuffer(e),r.framebufferRenderbuffer(r.FRAMEBUFFER,n,r.RENDERBUFFER,null)),e._context.gl.deleteRenderbuffer(t)}})),this._colorAttachments.clear()}},{key:"_disposeDepthStencilAttachments",value:function(){var e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,e,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}},{key:"_validateTextureDimensions",value:function(e,t){3553!==e.target&&34067!==e.target&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}},{key:"_validateColorAttachmentPoint",value:function(t){if(-1===e._MAX_COLOR_ATTACHMENTS){var n=this._context.capabilities.drawBuffers;if(n){var r=this._context.gl;e._MAX_COLOR_ATTACHMENTS=r.getParameter(n.MAX_COLOR_ATTACHMENTS)}else e._MAX_COLOR_ATTACHMENTS=1}var i=t-36064;i+1>e._MAX_COLOR_ATTACHMENTS&&v.error("esri.FrameBufferObject","illegal attachment point for color attachment: ".concat(i+1,". Implementation supports up to ").concat(e._MAX_COLOR_ATTACHMENTS," color attachments"))}}]),e}();function h(e){return"type"in e&&"texture"===e.type}function p(e,t,n){return new d.Z(e,{target:n,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height})}function g(e,t){void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}f._MAX_COLOR_ATTACHMENTS=-1},15880:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(15671),i=n(43144),o=n(8548),a=function(){function e(t,n){(0,r.Z)(this,e),this._context=t,this._desc=n,this._context.instanceCounter.increment(o._g.Renderbuffer,this);var i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,n.internalFormat,n.width,n.height)}return(0,i.Z)(e,[{key:"descriptor",get:function(){return this._desc}},{key:"resize",value:function(e,t){var n=this._desc;if(n.width!==e||n.height!==t){n.width=e,n.height=t;var r=this._context.gl;this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,n.internalFormat,n.width,n.height)}}},{key:"dispose",value:function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(o._g.Renderbuffer,this),this._context=null)}}]),e}()}}]);
//# sourceMappingURL=8945.95f866f3.chunk.js.map