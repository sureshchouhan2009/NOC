"use strict";(self.webpackChunketihadrailapp=self.webpackChunketihadrailapp||[]).push([[1771],{32500:function(e,t,i){i.d(t,{I:function(){return g},b:function(){return v}});var a,n,r,o=i(30168),s=i(33280),l=i(94951),u=i(21002),c=i(15226),h=i(10763),p=i(116),d=i(98634),f=i(64201);function v(e){var t=new f.kG;return t.include(l.w,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add((0,d.H)(a||(a=(0,o.Z)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"")),t.include(s.p2,e),e.multipassTerrainEnabled&&(t.fragment.include(u.S),t.include(c.l,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add((0,d.H)(n||(n=(0,o.Z)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",d.H.float(h.F))):(t.fragment.include(p.Y),t.fragment.code.add((0,d.H)(r||(r=(0,o.Z)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ","\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",d.H.float(h.F),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t}var g=Object.freeze({__proto__:null,build:v})},11316:function(e,t,i){i.d(t,{S:function(){return u},b:function(){return l}});var a,n,r=i(30168),o=i(98634),s=i(64201);function l(){var e=new s.kG;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add((0,o.H)(a||(a=(0,r.Z)(["void main(void) {\nvUV = uv0;\ngl_Position = proj * view * vec4(position, 1.0);\n}"])))),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add((0,o.H)(n||(n=(0,r.Z)(["void main() {\nconst float LINE_WIDTH = 1.0;\nvec2 uvScaled = vUV * gridWidth;\nvec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\nvec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\ngrid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\ngrid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\nfloat gridFade = max(grid.x, grid.y);\nfloat gridAlpha = gridColor.a * gridFade;\ngl_FragColor =\nvec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\nvec4(gridColor.rgb, 1.0) * gridAlpha;\n}"])))),e}var u=Object.freeze({__proto__:null,build:l})},66576:function(e,t,i){i.d(t,{B:function(){return b}});var a=i(15861),n=i(1413),r=i(37762),o=i(87757),s=i(92026),l=i(80292),u=i(35995),c=i(71907),h=i(33397),p=i(25265),d=i(49861);function f(e){return v[function(e){return e instanceof Blob?e.type:function(e){var t=(0,u.Ml)(e);return m[t]||g}(e.url)}(e)]||y}var v={},g="text/plain",y=v[g],m={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(var _ in m)v[m[_]]=_;var M=i(53283);function b(e){var t=(0,s.pC)(e)&&e.origins?e.origins:[void 0];return function(i,a){var o,c=function(e,t,i){if((0,s.pC)(e)&&"resource"===e.type)return function(e,t,i){var a=(0,h.VZ)(t,i);return{type:String,read:function(e,t,i){var n=(0,M.r)(e,t,i);return a.type===String?n:"function"==typeof a.type?new a.type({url:n}):void 0},write:{writer:function(t,r,o,c){if(!c||!c.resources)return"string"==typeof t?void(r[o]=(0,M.t)(t,c)):void(r[o]=t.write({},c));var h=function(e){return(0,s.Wi)(e)?null:"string"==typeof e?e:e.url}(t),d=h?(0,M.t)(h,(0,n.Z)((0,n.Z)({},c),{},{verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),1):null,v=a.type!==String&&(!(0,l.l)(this)||c&&c.origin&&this.originIdOf(i)>(0,p.M9)(c.origin));c&&c.portalItem&&(0,s.pC)(d)&&!(0,u.YP)(d)?v?function(e,t,i,a,n,r,o,s){var l=o.portalItem.resourceFromPath(a),c=x(i,a,o);f(c)===(0,u.Ml)(l.path)?(k(e,t,l,c,o.resources.toUpdate),n[r]=a):w(e,t,i,a,n,r,o,s)}(this,i,t,d,r,o,c,e):function(e,t,i,a){a.resources.toKeep.push({resource:a.portalItem.resourceFromPath(e)}),t[i]=e}(d,r,o,c):c&&c.portalItem&&((0,s.Wi)(d)||(0,s.pC)((0,M.i)(d))||(0,u.jc)(d)||v)?w(this,i,t,d,r,o,c,e):r[o]=d}}}}(e,t,i);switch((0,s.pC)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":return{read:M.p.read,write:M.p.write}}}(e,i,a),v=(0,r.Z)(t);try{for(v.s();!(o=v.n()).done;){var g=o.value,y=(0,d.CJ)(i,g,a);for(var m in c)y[m]=c[m]}}catch(_){v.e(_)}finally{v.f()}}}function w(e,t,i,a,n,r,o,l){var h=(0,c.D)(),p=x(i,a,o),d=(0,u.v_)((0,s.U2)(l,"prefix"),h),v="".concat(d,".").concat(f(p)),g=o.portalItem.resourceFromPath(v);(0,u.jc)(a)&&o.resources.pendingOperations.push(function(e){return S.apply(this,arguments)}(a).then((function(e){g.path="".concat(d,".").concat(f(e)),n[r]=g.itemRelativeUrl})).catch((function(){}))),k(e,t,g,p,o.resources.toAdd),n[r]=g.itemRelativeUrl}function k(e,t,i,a,n){n.push({resource:i,content:a,finish:function(i){!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function x(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}function S(){return S=(0,a.Z)(o.mark((function e(t){var a,n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(i.bind(i,76200));case 2:return a=e.sent.default,e.next=5,a(t,{responseType:"blob"});case 5:return n=e.sent,r=n.data,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}},80292:function(e,t,i){function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:function(){return a}})},45238:function(e,t,i){i.d(t,{EU:function(){return h},WH:function(){return p},ZZ:function(){return c},qC:function(){return u},Ue:function(){return s},uT:function(){return l}});var a=i(16889),n=i(48976),r=i(98131),o=i(11186);function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return[e[0],e[1],e[2],e[3]]}function l(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return(0,o.g)(i,e),i[3]=t,i}function u(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return(0,n.s)(v,e,p(e)),(0,n.s)(g,t,p(t)),(0,n.m)(v,g,v),d(i,(0,a.BV)((0,n.g)(i,v)))}function c(e){return e}function h(e){return e[3]}function p(e){return(0,a.Vl)(e[3])}function d(e,t){return e[3]=t,e}var f=[0,0,1,0],v=(0,r.a)(),g=(0,r.a)();s()},41771:function(e,t,i){i.r(t),i.d(t,{DrawGraphicTool3D:function(){return ft},ExtentTransformTool:function(){return un},GraphicMoveTool:function(){return si},GraphicReshapeTool:function(){return xi},GraphicTransformTool:function(){return Hi}});var a=i(1413),n=i(15671),r=i(43144),o=i(60136),s=i(29388),l=i(27366),u=i(42537),c=i(92026),h=i(8537),p=i(49861),d=(i(63780),i(93169)),f=i(25243),v=i(69912),g=i(74509),y=i(64575),m=i(51995),_=i(11186),M=i(71353),b=i(11752),w=i(61120),k=i(100),x=i(90045),S=i(151),C=i(70444),O=i(95773),E=i(85981),Z=i(40885),G=i(75508),D=i(14226),A=i(81949),R=i(86244),P=i(59887),z=i(97882),T=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e.view))._resources=null,a._transform=(0,A.c)(),a}return(0,r.Z)(i,[{key:"object",get:function(){return(0,c.pC)(this._resources)?this._resources.object:null}},{key:"transform",get:function(){return this._transform},set:function(e){(0,D.c)(this._transform,e),(0,c.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}},{key:"recreate",value:function(){this.attached&&this.createResources()}},{key:"recreateGeometry",value:function(){if(!(0,c.Wi)(this._resources)){var e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}}},{key:"createResources",value:function(){this.destroyResources();var e=this.view._stage;if(e){var t=new z.F({isPickable:!1,updatePolicy:1});e.add(t);var i=new P.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((function(t){return e.add(t)})),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}}},{key:"destroyResources",value:function(){var e=this.view._stage;!(0,c.Wi)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((function(t){e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}},{key:"updateVisibility",value:function(e){(0,c.Wi)(this._resources)||this._resources.object.setVisible(e)}}]),i}(R.l),V=i(70619),I=i(58901),W=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e))._ray=(0,Z.Ue)(),a._externalResources=null,a._handles=new k.Z,a._isWorldDown=!1,a._start=(0,M.c)(),a._end=(0,M.f)(1,0,0),a._width=1,a._color=(0,S.f)(1,0,1,1),a._polygonOffset=!1,a._writeDepthEnabled=!0,a._innerWidth=0,a._innerColor=(0,S.f)(1,1,1,1),a._stipplePattern=null,a._stippleOffColor=null,a._stipplePreferContinuous=!0,a._falloff=0,a._extensionType=0,a._laserlineStyle=null,a._laserlineEnabled=!1,a._renderOccluded=4,a._fadedExtensions=j,a.applyProps(e),a}return(0,r.Z)(i,[{key:"createExternalResources",value:function(){var e=this,t=new I.U(this.materialParameters);this._handles.add(this.view.state.watch("camera",(function(){e.updateGeometry()})));var i=new G.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:t,laserline:i}}},{key:"destroyExternalResources",value:function(){(0,c.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){(0,c.pC)(this._externalResources)&&e(this._externalResources.material)}},{key:"createGeometries",value:function(e){var t=[(0,M.c)(),(0,M.c)()],i=3===this.extensionType;i&&t.push((0,M.c)(),(0,M.c)());var a=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,n=V.Z.createPolylineGeometry(t,null,a);e.addGeometry(n,(0,c.Wg)(this._externalResources).material),this.updateVertices(e)}},{key:"updateVisibility",value:function(e){(0,b.Z)((0,w.Z)(i.prototype),"updateVisibility",this).call(this,e),(0,c.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}},{key:"setStartEndFromWorldDownAtLocation",value:function(e){this._isWorldDown=!0,(0,_.g)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,_.f)(this._end,e,this._end),(0,Z.zk)(this._start,this._end,this._ray),this.updateGeometry()}},{key:"start",get:function(){return this._start},set:function(e){this._isWorldDown=!1,(0,_.k)(this._start,e)||((0,_.g)(this._start,e),(0,Z.zk)(this._start,this._end,this._ray),this.updateGeometry())}},{key:"end",get:function(){return this._end},set:function(e){this._isWorldDown=!1,(0,_.k)(this._end,e)||((0,_.g)(this._end,e),(0,Z.zk)(this._start,this._end,this._ray),this.updateGeometry())}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,x.g)(e,this._color)||((0,x.c)(this._color,e),this.updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,x.g)(e,this._innerColor)||((0,x.c)(this._innerColor,e),this.updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,c.pC)(e)!==(0,c.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){((0,c.Wi)(e)||(0,c.Wi)(this._stippleOffColor)||!(0,x.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,c.pC)(e)?(0,S.a)(e):null,this.updateMaterial())}},{key:"stipplePreferContinuous",get:function(){return this._stipplePreferContinuous},set:function(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}},{key:"extensionType",get:function(){return this._extensionType},set:function(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}},{key:"_laserlineAttached",get:function(){return this._laserlineEnabled&&(0,c.pC)(this._laserlineStyle)}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,(0,c.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,c.pC)(e)&&(this._externalResources.laserline.style=e))}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,c.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"fadedExtensions",get:function(){return this._fadedExtensions},set:function(e){this._fadedExtensions=(0,c.Pt)(e,j),this.recreateGeometry()}},{key:"updateMaterial",value:function(){(0,c.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"updateGeometry",value:function(){(0,c.pC)(this.object)&&this.updateVertices(this.object)}},{key:"updateVertices",value:function(e){var t=3===this._extensionType?this.updateLineSegmentFinite(U):this.updateLineSegmentInfinite(this._extensionType,U);this.updateVertexAttributes(e,t),(0,c.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}},{key:"updateLineSegmentFinite",value:function(e){return(0,E.zk)(this._start,this._end,e)}},{key:"updateLineSegmentInfinite",value:function(e,t){var i=this.view.state.camera;switch((0,C.iL)(this._ray,H),e){case 0:H.c0=-Number.MAX_VALUE;break;case 1:case 2:var a=this._ray.origin,n=(0,c.Pt)(this.view.elevationProvider.getElevation(a[0],a[1],a[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),r=this.view.renderCoordsHelper.getAltitude(a);this._isWorldDown&&r<n&&(0,_.o)(H.ray.direction,H.ray.direction),2===this._extensionType&&null!=n&&(H.c1=Math.abs(r-n))}if(!(0,O.zq)(i.frustum,H))return(0,E.zk)(this._start,this._end,t);var o=(0,C.Ws)(H,L),s=(0,C.S$)(H,F);return(0,E.zk)(o,s,t)}},{key:"updateVertexAttributes",value:function(e,t){var i=e.geometries[0].getMutableAttribute("position").data;if(3===this.extensionType){var a=(0,E.KU)(t,-this.fadedExtensions.start,L);i[0]=a[0],i[1]=a[1],i[2]=a[2];var n=(0,E.KU)(t,0,L);i[3]=n[0],i[4]=n[1],i[5]=n[2];var r=(0,E.KU)(t,1,L);i[6]=r[0],i[7]=r[1],i[8]=r[2];var o=(0,E.KU)(t,1+this.fadedExtensions.end,L);i[9]=o[0],i[10]=o[1],i[11]=o[2]}else{var s=(0,E.KU)(t,0,L);i[0]=s[0],i[1]=s[1],i[2]=s[2];var l=(0,E.KU)(t,1,L);i[3]=l[0],i[4]=l[1],i[5]=l[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}]),i}(T),H=(0,C.Ue)(),L=(0,M.c)(),F=(0,M.c)(),U=(0,E.Ue)(),B=1/3,j={start:B,end:B},q=i(17842),N=i(88396),Q=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e))._handles=new k.Z,a._location=(0,M.c)(),a._direction=(0,M.f)(1,0,0),a._width=1,a._offset=1,a._length=18,a._color=(0,S.f)(1,0,1,1),a._renderOccluded=4,a.applyProps(e),a}return(0,r.Z)(i,[{key:"location",get:function(){return this._location},set:function(e){(0,_.k)(this._location,e)||((0,_.g)(this._location,e),this.updateGeometry())}},{key:"direction",get:function(){return this._direction},set:function(e){(0,_.k)(this._direction,e)||((0,_.g)(this._direction,e),this.updateGeometry())}},{key:"setDirectionFromPoints",value:function(e,t){(0,_.n)(this._direction,(0,_.f)(this._direction,t,e)),this.updateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"offset",get:function(){return this._offset},set:function(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}},{key:"length",get:function(){return this._length},set:function(e){e!==this._length&&(this._length=e,this.updateGeometry())}},{key:"color",get:function(){return this._color},set:function(e){(0,x.g)(e,this._color)||((0,x.c)(this._color,e),this.updateMaterial())}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"createExternalResources",value:function(){var e=this,t=new I.U(this.materialParameters);this._handles.add(this.view.state.watch("camera",(function(){e.updateGeometry()}))),this._externalResources={material:t}}},{key:"destroyExternalResources",value:function(){this._handles.removeAll(),this._externalResources=null}},{key:"createGeometries",value:function(e){var t=V.Z.createPolylineGeometry([(0,M.c)(),(0,M.c)()]),i=V.Z.createPolylineGeometry([(0,M.c)(),(0,M.c)()]),a=(0,c.Wg)(this._externalResources).material;e.addGeometry(t,a),e.addGeometry(i,a),this.updateVertices(e)}},{key:"forEachExternalMaterial",value:function(e){(0,c.pC)(this._externalResources)&&e(this._externalResources.material)}},{key:"updateMaterial",value:function(){(0,c.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}},{key:"updateGeometry",value:function(){var e=this.object;(0,c.Wi)(e)||this.updateVertices(e)}},{key:"updateVertices",value:function(e){var t=this.view.state.camera;t.projectToScreen(this.location,X),(0,_.b)(Y,this.location,this.direction),t.projectToScreen(Y,J),(0,N.i)(J,(0,N.f)(J,J,X)),this.updateVertexAttributes(t,e,0,X,J,1),this.updateVertexAttributes(t,e,1,X,J,-1)}},{key:"updateVertexAttributes",value:function(e,t,i,a,n,r){var o=t.geometryRecords[i],s=o.geometry.getMutableAttribute("position").data,l=(0,N.g)(K,(0,N.s)(K,n[1]*r,n[0]*-r),this.offset+this.width/2),u=(0,N.m)($,(0,N.m)($,(0,N.m)($,a,(0,N.g)($,n,this.length/2)),l),l),c=(0,N.m)(ee,u,(0,N.g)(ee,n,-this.length));e.unprojectFromScreen(u,Y),s[0]=Y[0],s[1]=Y[1],s[2]=Y[2],e.unprojectFromScreen(c,Y),s[3]=Y[0],s[4]=Y[1],s[5]=Y[2],t.geometryVertexAttrsUpdated(o)}}]),i}(T),Y=(0,M.c)(),X=(0,q.s1)(),J=(0,q.s1)(),K=(0,q.s1)(),$=(0,q.s1)(),ee=(0,q.s1)(),te=i(16889),ie=i(67077),ae=i(60176),ne=i(41414),re=i(11185),oe=function(){function e(t){(0,n.Z)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return(0,r.Z)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"object",get:function(){return(0,c.pC)(this._resources)?this._resources.object:null}},{key:"resources",get:function(){return(0,c.pC)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncVisible())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){if(this.resourceFactory.recreateGeometry){var e=this.resourceFactory.view._stage;if(!(0,c.Wi)(this._resources)&&e){var t=this._resources.object;this._resources.external.forEach((function(t){2===t.type&&e.remove(t)})),t.removeAllGeometries();var i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}}else this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?this._resources||this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e=this;this._destroyResources();var t=this.resourceFactory.view._stage;if(t){var i=new z.F({isPickable:!1,updatePolicy:1});t.add(i);var a=new P.T({castShadow:!1}),n=this.resourceFactory.createResources(a,i);n.forEach((function(e){return t.add(e)})),t.add(a),i.add(a),this._syncVisible();var r=this.resourceFactory.cameraChanged?(0,h.S1)(this.resourceFactory.view.state,"camera",(function(t){return e.resourceFactory.cameraChanged(t)})):null;this._resources={layer:i,object:a,external:n,cameraHandle:r}}}},{key:"_destroyResources",value:function(){if(!(0,c.Wi)(this._resources)){var e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach((function(t){null==e||e.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}}},{key:"_syncVisible",value:function(){(0,c.Wi)(this._resources)||this._resources.object.setVisible(this._visible)}}]),e}(),se=i(69691),le=i(78935),ue=i(55360),ce=i(83602),he=i(9992),pe=function(){function e(t){var i=this;(0,n.Z)(this,e),this.view=null,this._geometry=null,this._size=3,this._color=(0,ie.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,ie.f)(1,1,1,1),this._elevationInfo=null,this.resources=new oe({view:t.view,createResources:function(e){return i.createResources(e)},recreateGeometry:function(e,t){return e.geometry=i.recreateGeometry(t,e.material),(0,c.pC)(e.geometry)?[e.geometry]:[]}});var a=!0;for(var r in t)r in this?"attached"===r?a=t[r]:this[r]=t[r]:console.error("Cannot set unknown property",r);this.attached=a}return(0,r.Z)(e,[{key:"destroy",value:function(){this.resources.destroy()}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e}},{key:"attached",get:function(){return this.resources.attached},set:function(e){this.resources.attached=e}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry()}},{key:"size",get:function(){return this._size},set:function(e){if(e!==this._size){var t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?(0,c.pC)(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}},{key:"color",get:function(){return this._color},set:function(e){(0,x.g)(e,this._color)||((0,x.c)(this._color,e),this.updateMaterial())}},{key:"pixelSnappingEnabled",get:function(){return this._pixelSnappingEnabled},set:function(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}},{key:"primitive",get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,(0,c.pC)(this.resources)&&this.resources.recreate())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,x.g)(e,this._outlineColor)||((0,x.c)(this._outlineColor,e),this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}},{key:"updateMaterial",value:function(){var e=this.resources.resources;(0,c.Wi)(e)||e.material.setParameters(this.materialParameters(e.texture.id))}},{key:"updateSizeAttribute",value:function(){var e=this.resources.resources,t=this.resources.object;if(!(0,c.Wi)(e)&&!(0,c.Wi)(t)){var i=e.geometry;if(!(0,c.Wi)(i)){var a=i.getMutableAttribute("size").data,n=this.geometrySize;a[0]=n,a[1]=n,t.geometryVertexAttrsUpdated(t.geometryRecords[0])}}}},{key:"materialParameters",value:function(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:fe,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}},{key:"geometrySize",get:function(){return this._size/de}},{key:"recreateGeometry",value:function(e,t){var i=this.createRenderGeometry();return(0,c.pC)(i)&&e.addGeometry(i,t),i}},{key:"createResources",value:function(e){var t=this.createTexture(),i=new he.A(this.materialParameters(t.id)),a=this.recreateGeometry(e,i);return{material:i,texture:t,geometry:a,forEach:function(e){e(t),e(i),(0,c.pC)(this.geometry)&&e(this.geometry)}}}},{key:"preferredTextureSize",get:function(){return(0,te.uZ)((0,te.Sf)(2*this.geometrySize),16,128)}},{key:"createTexture",value:function(){var e=this.preferredTextureSize;return new ce.x((0,ue.Z$)(this._primitive,e,e*de),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}},{key:"calculateMapBounds",value:function(e){if((0,c.Wi)(this.resources.resources)||(0,c.Wi)(this.resources.resources.geometry))return!1;var t=this.resources.resources.geometry.vertexAttributes.get("position");return(0,ae.SH)(t.data,this.view.renderCoordsHelper.spatialReference,ve,this.view.spatialReference),(0,ne.G1)(e,ve),!0}},{key:"createRenderGeometry",value:function(){var e=this.geometry;if((0,c.Wi)(e))return null;var t=this.view,i=t.renderCoordsHelper,a=t.elevationProvider,n=(0,se.w7)(e,a,le.o.fromElevationInfo(this.elevationInfo),i),r=(0,_.s)(re.WM.get(),e.x,e.y,n),o=re.WM.get();(0,ae.SH)(r,e.spatialReference,o,i.spatialReference);var s=this.geometrySize;return V.Z.createPointGeometry(null,o,null,[s,s],[0,0,0,1])}}]),e}(),de=.5,fe=[de/2,de/2,1-de/2,1-de/2],ve=(0,M.c)(),ge=i(93433),ye=i(74894),me=i(74818),_e=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e))._handles=new k.Z,a._quadMaterial=null,a._outlineMaterial=null,a._maxSize=0,a._position=(0,M.c)(),a._up=(0,M.c)(),a._right=(0,M.c)(),a._renderOccluded=4,a._color=(0,S.f)(1,0,0,1),a._outlineColor=(0,S.f)(0,0,0,1),a._outlineSize=0,a._size=32,a._outlineRenderOccluded=16,a.applyProps(e),a}return(0,r.Z)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,x.c)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,x.c)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,i=e.center,a=e.next;this._maxSize=Math.min((0,_.i)(i,t),(0,_.i)(i,a))/3,(0,_.n)(this._up,(0,_.f)(this._up,t,i)),(0,_.n)(this._right,(0,_.f)(this._right,a,i)),(0,_.g)(this._position,i),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new me.E(this.quadMaterialParameters),this._outlineMaterial=new I.U(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=(0,_.b)(re.WM.get(),this._up,this._right),i=V.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,i);(0,D.i)(Me),(0,D.a)(Me,Me,this._position),(0,D.f)(Me,Me,[a,a,a]),(0,c.pC)(e)&&(e.transformation=Me)}},{key:"_quadGeometryData",value:function(e,t){var i=(0,_.b)(re.WM.get(),e,t);return new ye.Z([["position",{size:3,data:[0,0,0].concat((0,ge.Z)(t),(0,ge.Z)(e),(0,ge.Z)(i)),exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}]),i}(T),Me=(0,A.c)(),be=i(76014),we=i(64674),ke=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,n.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"visualizeIntersectionPoint",value:function(e,t){var i=t.coordinateHelper,a=t.elevationInfo,n=t.view;return(0,u.ed)(new pe({view:n,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:a,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:m.Z.toUnitRGBA(be.c.orange),pixelSnappingEnabled:!1}))}},{key:"visualizePoint",value:function(e,t){var i=t.coordinateHelper,a=t.elevationInfo,n=t.view;return(0,u.ed)(new pe({view:n,primitive:"circle",geometry:i.vectorToPoint(e.point),elevationInfo:a,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:m.Z.toUnitRGBA(be.c.orange),pixelSnappingEnabled:!1}))}},{key:"visualizeLine",value:function(e,t){var i=t.coordinateHelper,a=t.elevationInfo,n=t.view;return(0,u.ed)(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,a,n,e.fadeLeft,e.fadeRight))}},{key:"visualizeParallelSign",value:function(e,t){var i=t.coordinateHelper,a=t.elevationInfo,n=t.view,r=(0,we.$r)(e.lineStart,i,a,t.view),o=(0,we.$r)(e.lineEnd,i,a,t.view),s=(0,_.e)(o,r,o,.5),l=new Q({view:n,attached:!1,offset:be.c.parallelLineHintOffset,length:be.c.parallelLineHintLength,width:be.c.parallelLineHintWidth,color:m.Z.toUnitRGBA(be.c.orange),location:s,renderOccluded:16});return l.setDirectionFromPoints(r,s),l.attached=!0,(0,u.ed)(l)}},{key:"visualizeRightAngleQuad",value:function(e,t){var i=t.coordinateHelper,a=t.elevationInfo,n=t.view;return(0,u.ed)(new _e({view:n,attached:!0,color:m.Z.toUnitRGBA(be.c.orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:m.Z.toUnitRGBA(be.c.orange),outlineSize:be.c.rightAngleHintOutlineSize,size:be.c.rightAngleHintSize,geometry:{previous:(0,we.$r)(e.previousVertex,i,a,n),center:(0,we.$r)(e.centerVertex,i,a,n),next:(0,we.$r)(e.nextVertex,i,a,n)}}))}},{key:"createLineSegmentHintFromMap",value:function(e,t,i,a,n,r){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=(0,M.c)(),u=(0,M.c)();return(0,we.gQ)(t,i,a,n,r,l,u),this.createLineSegmentHint(e,r,l,u,o,s)}},{key:"createLineSegmentHint",value:function(e,t,i,a){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=new W({view:t,extensionType:3,start:i,end:a,color:m.Z.toUnitRGBA(be.c.orange),renderOccluded:16});switch(e){case 0:o.width=be.c.lineHintWidthTarget,o.fadedExtensions={start:0,end:be.c.lineHintFadedExtensions};break;case 2:o.width=be.c.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case 1:o.width=be.c.lineHintWidthReference,o.fadedExtensions={start:n?be.c.lineHintFadedExtensions:0,end:r?be.c.lineHintFadedExtensions:0}}return o.attached=!0,o}}]),i}(i(38561).a),xe=i(97326),Se=i(86950),Ce=i(86700),Oe={main:new m.Z([255,127,0]),selected:new m.Z([255,255,255]),staged:new m.Z([12,207,255]),outline:new m.Z([0,0,0,.5]),selectedOutline:new m.Z([255,255,255])},Ee=.3;function Ze(e,t){var i=e.clone();return i.a*=t,i}function Ge(e,t){var i=e.clone(),a=(0,Se._Y)(i);a.s*=t;var n=(0,Se.xr)(a);return i.r=n.r,i.g=n.g,i.b=n.b,i}function De(e,t){if(t)for(var i in t)e[i]=t[i]}var Ae=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.color=Oe.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,De(this,t)})),Re=function(){function e(t){(0,n.Z)(this,e),this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=Oe.main,this.outlineColor=Oe.outline,this.renderOccluded=16,this.hoverOutlineColor=Oe.selectedOutline,De(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e,t){var i=this[e];t.setParameters({color:Ue(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}]),e}(),Pe=function(){function e(t){(0,n.Z)(this,e),this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Ze(Oe.main,.5),this.hoverColor=Oe.main,this.renderOccluded=2,this.minSquaredEdgeLength=900,De(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e,t){var i=this[e];t.setParameters({color:Ue(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}]),e}(),ze=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.vertex=new Re({color:Oe.main,outlineColor:Oe.outline}),this.edge=new Re({color:Ge(Ze(Oe.main,2/3),.5),outlineColor:Ze(Oe.outline,.5),size:8,collisionPadding:8}),this.selected=new Re({color:Oe.selected,outlineColor:Oe.outline}),this.edgeOffset=new Pe,De(this,t)})),Te=function(){function e(t){(0,n.Z)(this,e),this.color=Oe.selected,this.width=1.5,this.stipplePattern=(0,Ce.z5)(5),this.stippleOffColor=Oe.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=Oe.selected,this.renderOccluded=4,De(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e){e.color=Ue(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=Ue(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=Ue(this.innerColor),e.renderOccluded=this.renderOccluded}}]),e}(),Ve=function(){function e(t){(0,n.Z)(this,e),this.color=Oe.selected,this.size=4,this.outlineSize=1,this.outlineColor=Oe.outline,this.shape="square",De(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e){e.color=Ue(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=Ue(this.outlineColor),e.primitive=this.shape}}]),e}(),Ie=function(){function e(t){(0,n.Z)(this,e),this.innerColor=Oe.selected,this.innerWidth=1,this.glowColor=Oe.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Ee,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=Oe.main,De(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i={glowColor:m.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:m.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}]),e}(),We=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.outline=new Te({color:Oe.outline,renderOccluded:8,stippleOffColor:Oe.selected,stipplePattern:(0,Ce.z5)(5),width:1.5,innerWidth:0}),this.staged=new Te({color:Oe.selected,renderOccluded:8,innerColor:Oe.staged,stippleOffColor:Oe.outline,stipplePattern:(0,Ce.z5)(5),width:1.5}),this.shadowStyle=new Ie({globalAlpha:Ee,glowColor:Oe.main,glowFalloff:8,glowWidth:8,innerColor:Oe.selected,innerWidth:1}),De(this,t)})),He=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.outline=new Ve({color:Oe.selected,outlineColor:Oe.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Ie({globalAlpha:Ee,glowColor:Oe.main,glowFalloff:1.5,glowWidth:6,innerColor:Oe.selected,innerWidth:1,radius:2}),De(this,t)})),Le=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this)).extensionType=2,De((0,xe.Z)(a),e),a}return(0,r.Z)(i)}(Te),Fe=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.lineGraphics=new We,this.pointGraphics=new He,this.heightPlane=new Ie({globalAlpha:Ee,glowColor:Oe.main,glowFalloff:8,glowWidth:8,innerColor:Oe.selected,innerWidth:1}),this.heightBox=new Ie({globalAlpha:Ee,glowColor:Oe.main,glowFalloff:8,glowWidth:8,innerColor:Oe.selected,innerWidth:0,heightFillColor:Oe.main}),this.zVerticalLine=new Le({color:Ze(Oe.main,.5),falloff:2,innerColor:Ze(Oe.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,De(this,t)}));function Ue(e){return(0,ie.d)(m.Z.toUnitRGBA(e))}var Be=new(function(){function e(t){(0,n.Z)(this,e),this.visualElements=new Fe,this.reshapeManipulators=new ze,this.zManipulator=new Ae,De(this,t)}return(0,r.Z)(e,[{key:"colorToVec4",value:function(e){return Ue(e)}}]),e}()),je=i(37762),qe=i(91505),Ne=i(65618),Qe=i(85015),Ye=i(79056),Xe=function(){function e(t){(0,n.Z)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return(0,r.Z)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"resources",get:function(){return(0,c.pC)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){this.resourceFactory.recreateGeometry?(0,c.Wi)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?(0,c.Wi)(this._resources)&&this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e;this._destroyResources();var t=this.resourceFactory.createResources();this._resources={layerView:new Je({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();var i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}},{key:"_destroyResources",value:function(){var e;if(!(0,c.Wi)(this._resources)){this.ensureRenderGeometriesRemoved();var t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}}},{key:"_syncGeometriesToRenderer",value:function(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}},{key:"ensureRenderGeometriesRemoved",value:function(){var e;!(0,c.Wi)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}},{key:"ensureRenderGeometriesAdded",value:function(){(0,c.Wi)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}]),e}(),Je=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).drapeSourceType=1,a.updatePolicy=1,a}return(0,r.Z)(i)}((0,Ye.I)(Qe.Z));(0,l._)([(0,p.Cb)({constructOnly:!0})],Je.prototype,"view",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],Je.prototype,"drapeSourceType",void 0),Je=(0,l._)([(0,v.j)("DrapedVisualElementLayerView")],Je);var Ke=i(75558),$e=i(81935),et=i(39077),tt=function(){function e(t){var i=this;(0,n.Z)(this,e),this.view=null,this._attachmentOrigin=(0,Ne.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new qe.Z,this._isDraped=!1,this._geometry=null,this._width=1,this._color=(0,S.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,S.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new oe({view:t.view,createResources:function(e){return i.createResources(e)},recreateGeometry:function(e,t){return e.geometries.length=0,i.recreateGeometry(t,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this.drapedResources=new Xe({view:t.view,createResources:function(){return i._createDrapedResources()},recreateGeometry:function(e){e.geometries=i._createRenderGeometriesDraped(e.material),i.attachmentOriginChanged()}});var a=!0;for(var r in this._laserline=new G.W({view:t.view}),t)r in this?"attached"===r?a=t[r]:this[r]=t[r]:console.error("Cannot set unknown property",r);this.attached=a}return(0,r.Z)(e,[{key:"destroy",value:function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}},{key:"isDraped",get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}},{key:"laserlineAttached",get:function(){return this.attached&&this.visible&&(0,c.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}},{key:"attached",get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)}},{key:"updateAttached",value:function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,x.g)(e,this._color)||((0,x.c)(this._color,e),this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,x.g)(e,this._innerColor)||((0,x.c)(this._innerColor,e),this.updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,c.pC)(e)!==(0,c.pC)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&(0,x.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,S.a)(e):null,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,(0,c.pC)(e)&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=(0,c.pC)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;(0,_.s)(nt,0,0,0);var t,i=0,a=(0,je.Z)(e);try{for(a.s();!(t=a.n()).done;){var n=t.value,r=n.vertexAttributes.get("position"),o=n.indices.get("position"),s=(0,c.Wg)(this.resources.resources).material.isClosed(r.data,o);(0,$e.qZ)(r,o,s,at)&&((0,_.b)(nt,nt,at),i++)}}catch(l){a.e(l)}finally{a.f()}return 0===i?null:((0,_.a)(nt,nt,1/i),this.view.renderCoordsHelper.fromRenderCoords(nt,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}},{key:"updateMaterial",value:function(){(0,c.pC)(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),(0,c.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters)}},{key:"isClosed",get:function(){return(0,c.pC)(this.geometry)&&"polygon"===this.geometry.type}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}},{key:"normalizedRenderOccluded",get:function(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}},{key:"recreateGeometry",value:function(e,t,i){var a,n=this.createRenderGeometries(),r=(0,je.Z)(n);try{for(r.s();!(a=r.n()).done;){var o=a.value;e.addGeometry(o,t),i.push(o)}}catch(s){r.e(s)}finally{r.f()}this.attachmentOriginChanged()}},{key:"attachmentOriginChanged",value:function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}},{key:"createResources",value:function(e){var t=new I.U(this.materialParameters),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:function(e){e(t),i.forEach(e)}}}},{key:"_createDrapedResources",value:function(){var e=new I.U(this.materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}},{key:"_createRenderGeometriesDraped",value:function(e){var t=this.geometry;if((0,c.Wi)(t))return[];var i,a=(0,Ke.rm)(t,this.view.basemapTerrain.spatialReference),n=[],r=(0,je.Z)(a.lines);try{for(r.s();!(i=r.n()).done;){var o=i.value.position,s={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:o},removeDuplicateStartEnd:this.isClosed?1:0},l=new et.z((0,Ke.YU)(s),e),u=(0,ne.cS)(it);(0,ne.G1)(u,o),(0,x.s)(l.boundingSphere,.5*(u[0]+u[3]),.5*(u[1]+u[4]),0,.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1]))),n.push(l)}}catch(h){r.e(h)}finally{r.f()}return n}},{key:"calculateMapBounds",value:function(e){if((0,c.Wi)(this.resources.resources))return!1;var t,i=this.view.renderCoordsHelper,a=(0,je.Z)(this.resources.resources.geometries);try{for(a.s();!(t=a.n()).done;){var n=t.value.vertexAttributes.get("position"),r=new Float64Array(n.data.length);(0,ae.CM)(n.data,i.spatialReference,0,r,this.view.spatialReference,0,n.data.length/3),(0,ne.G1)(e,r)}}catch(o){a.e(o)}finally{a.f()}return!0}},{key:"createRenderGeometries",value:function(){var e,t=this.geometry;if((0,c.Wi)(t))return[];var i,a=(0,Ke.VP)(t,this.view.elevationProvider,this.view.renderCoordsHelper,le.o.fromElevationInfo(null!=(e=this.elevationInfo)?e:new y.Z({mode:(0,g.VW)(t,null)}))),n=[],r=[],o=(0,je.Z)(a.lines);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=s.position,u={overlayInfo:null,attributeData:{position:l,mapPosition:s.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0};n.push((0,Ke.YU)(u)),r.push(l)}}catch(h){o.e(h)}finally{o.f()}return this._laserline.pathVerticalPlane=r,n}}]),e}(),it=(0,ne.Ue)(),at=(0,M.c)(),nt=(0,M.c)(),rt=i(36759),ot=i(11606),st=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).view=null,a._renderOccluded=4,a._vertices=null,a._spatialReference=null,a._color=Be.colorToVec4(Be.reshapeManipulators.vertex.color),a._size=Be.reshapeManipulators.vertex.size,a._outlineColor=Be.colorToVec4(Be.reshapeManipulators.vertex.outlineColor),a._outlineSize=Be.reshapeManipulators.vertex.outlineSize,a._elevationInfo=null,a.applyProps(e),a}return(0,r.Z)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){(0,x.g)(e,this._color)||((0,x.c)(this._color,e),this.updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this.updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,x.g)(e,this._outlineColor)||((0,x.c)(this._outlineColor,e),this.updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"vertexMaterialParameters",get:function(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}},{key:"vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}},{key:"updateMaterial",value:function(){this.attached&&this.vertexMaterial.setParameters(this.vertexMaterialParameters)}},{key:"updateOutlineMaterial",value:function(){this.attached&&this.vertexOutlineMaterial.setParameters(this.vertexOutlineMaterialParameters)}},{key:"createRenderGeometries",value:function(){var e=this.vertices;if((0,c.Wi)(e)||0===e.length)return[];for(var t=(0,rt.VP)(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,le.o.fromElevationInfo(this.elevationInfo)),i=[],a=t.numVertices,n=t.position,r=0;r<a;++r){var o=(0,_.s)(lt,n[3*r+0],n[3*r+1],n[3*r+2]),s=ut(.5,o),l=ut(.5,o);i.push({vertexGeometry:s,vertexOutlineGeometry:l})}return i}},{key:"createGeometries",value:function(e){var t,i=this.createRenderGeometries(),a=(0,je.Z)(i);try{for(a.s();!(t=a.n()).done;){var n=t.value,r=n.vertexGeometry,o=n.vertexOutlineGeometry;e.addGeometry(r,this.vertexMaterial),e.addGeometry(o,this.vertexOutlineMaterial)}}catch(s){a.e(s)}finally{a.f()}}},{key:"createExternalResources",value:function(){this.vertexMaterial=new ot.Q((0,a.Z)((0,a.Z)({},this.vertexMaterialParameters),{},{writeDepth:!0,cullFace:2,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new ot.Q((0,a.Z)((0,a.Z)({},this.vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}]),i}(T),lt=(0,M.c)();function ut(e,t){return V.Z.createSphereGeometry(e,16,16,{offset:t})}var ct=i(94687),ht=i(89215),pt=i(66038),dt=i(54016),ft=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e))._activeVertexVisualElement=null,a._createGraphicState=null,a._outlineVisualElement=null,a._verticesVisualElement=null,a.geometryType=null,a.type="draw-3d",a}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this.elevationInfo,t=e.mode,i=e.offset;this.internalGraphicsLayer.elevationInfo=new y.Z({mode:t,offset:i})}},{key:"normalizeCtorArgs",value:function(e){if(!e.elevationInfo){var t,i=null==(t=e.hasZ)||t;return(0,a.Z)((0,a.Z)({},e),{},{elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}})}return e}},{key:"initializeGraphic",value:function(e){var t=this;return this._createGraphicState=new ct.F({graphic:e}),(0,u.AL)([this.view.maskOccludee(e),this.view.trackGraphicState(this._createGraphicState),(0,h.S1)(this._createGraphicState,"isDraped",(function(e){(0,c.pC)(t._outlineVisualElement)&&(t._outlineVisualElement.isDraped=e)}))])}},{key:"makeDrawOperation",value:function(){return new pt.w({view:this.view,manipulators:this.manipulators,geometryType:(0,ht.I)(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new dt.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new dt.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new ke})}},{key:"onActiveVertexChanged",value:function(e){var t=this;return(0,c.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new st({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:Be.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=Be.colorToVec4(Be.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,(0,u.kB)((function(){t._activeVertexVisualElement=(0,c.SC)(t._activeVertexVisualElement)})))}},{key:"onOutlineChanged",value:function(e){var t=this;if((0,c.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;var i=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new tt({view:this.view,geometry:e,elevationInfo:i,isDraped:(0,c.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,g.Zz)(this.hasZ,i),attached:!1}),Be.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),Be.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,u.kB)((function(){t._outlineVisualElement=(0,c.SC)(t._outlineVisualElement)}))}},{key:"onRegularVerticesChanged",value:function(e){var t=this;return(0,c.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new st({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:Be.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,u.kB)((function(){t._verticesVisualElement=(0,c.SC)(t._verticesVisualElement)})))}}]),i}(ht.T);(0,l._)([(0,p.Cb)({constructOnly:!0})],ft.prototype,"elevationInfo",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],ft.prototype,"geometryType",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],ft.prototype,"type",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],ft.prototype,"view",void 0),ft=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],ft);var vt=i(40110),gt=i(41691),yt=i(83639);function mt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.RL)(e);return"on-the-ground"!==t.mode&&!((0,c.Wi)(e.geometry)||!e.geometry.hasZ)}var _t=i(35284),Mt=function(){function e(){(0,n.Z)(this,e),this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return(0,r.Z)(e,[{key:"update",value:function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,i){if(0===i&&(t.zManipulator=e),e instanceof _t.Z&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),(0,c.Wi)(t.firstGrabbedXY)&&e.grabbing&&1===i&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,i){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}}))}}]),e}();function bt(e){var t=e.view,i=e.graphic,a=new ct.F({graphic:i}),n=function(e,t){var i=e.view,a=e.graphic,n=new tt({view:i,geometry:kt(a)?a.geometry:null,elevationInfo:(0,g.RL)(a),attached:!1});Be.visualElements.lineGraphics.shadowStyle.apply(n);var r=function(){n.attached=t.displaying};Be.visualElements.lineGraphics.outline.apply(n);var o=[t.watch("displaying",r),t.watch("isDraped",(function(e){return n.isDraped=e})),t.on("changed",(function(){return n.geometry=kt(a)?a.geometry:null})),(0,u.ed)(n)];return r(),{visualElement:n,remove:function(){return(0,u.AL)(o).remove()}}}(e,a),r=[n,wt(e,n.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:n.visualElement,remove:function(){return(0,u.AL)(r).remove()}}}function wt(e,t,i){var a=e.graphic,n=e.view,r=[],o=(0,g.RL)(a),s="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,l=new Mt,h=new W({view:n,extensionType:Be.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});Be.visualElements.pointGraphics.shadowStyle.apply(h);var p=(0,te.Vl)(Be.visualElements.heightPlaneAngleCutoff),d=new G.W({view:n,attached:!1,angleCutoff:p});Be.visualElements.heightPlane.apply(d);var f=1,v=1,y=function(){if(l.update(e),!i.displaying||s&&(i.isDraped||!kt(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(d.attached=!1);t.laserlineEnabled=!0;var n=4&l.grabbingState?Be.visualElements.laserlineAlphaMultiplier:1;n!==f&&(f=n,Be.visualElements.lineGraphics.shadowStyle.apply(t,n),Be.visualElements.pointGraphics.shadowStyle.apply(h,n));var r=2&l.grabbingState?Be.visualElements.laserlineAlphaMultiplier:1;r!==v&&(v=r,Be.visualElements.heightPlane.apply(d,r)),function(e,t){var i=1===t.numSelected?t.firstSelected:t.numSelected>1&&(0,c.pC)(t.firstGrabbedXY)?t.firstGrabbedXY:null;(0,c.pC)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(h,l),function(e,t,i,a){if(a.numSelected>0){(0,_.s)(xt,0,0,0);var n=0;e.forEachManipulator((function(e,t){1===t&&e.selected&&e instanceof _t.Z&&((0,_.b)(xt,xt,e.renderLocation),n++)})),n>0?(i.heightManifoldTarget=(0,_.a)(xt,xt,1/n),i.attached=!0):i.attached=!1}else{var r=t.attachmentOrigin;(0,c.pC)(r)&&e.view.renderCoordsHelper.toRenderCoords(r,xt)?(i.heightManifoldTarget=xt,i.attached=!0):i.attached=!1}}(e,t,d,l)};Be.visualElements.zVerticalLine.apply(h),r.push(i.on("changed",y),i.watch("displaying",y),t.events.on("attachment-origin-changed",y),(0,u.ed)(h),(0,u.ed)(d));var m=[],M=function(){(0,u.AL)(m).remove(),m.length=0,e.forEachManipulator((function(e){return m.push(e.events.on("grab-changed",y))})),e.forEachManipulator((function(e){return m.push(e.events.on("select-changed",y))})),y()};return M(),r.push(e.onManipulatorsChanged(M),(0,u.iU)((function(){return(0,u.AL)(m)}))),(0,u.AL)(r)}function kt(e){return(0,c.pC)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}var xt=(0,M.c)(),St=i(65156);function Ct(e){var t=e.view,i=e.graphic,a=new ct.F({graphic:i}),n=[],r=function(e,t,i){var a=e.view,n=e.graphic,r=new pe({view:a,geometry:Ot(n),elevationInfo:(0,g.RL)(n),attached:!1});return function(e,t,i,a){var n=function(){return t.attached=i.displaying};(function(e,t,i,a){var n=e.view,r=e.graphic,o=null,s=function(e){(0,c.pC)(o)&&(o.remove(),o=null),i.isDraped&&(0,c.pC)(e)&&(o=function(e,t,i){var a=e.elevationProvider.spatialReference;(0,ae.KC)(t,Et,a);var n=Et[0],r=Et[1];return e.elevationProvider.on("elevation-change",(function(e){(0,St.jE)(e.extent,n,r)&&i()}))}(n,e,(function(){t.geometry=e})))},l=function(){var e=Ot(r);s(e),t.geometry=e};a.push(i.on("changed",l),(0,u.iU)((function(){return o}))),l()})(e,t,i,a),Be.visualElements.pointGraphics.outline.apply(t),a.push((0,h.S1)(i,"displaying",n))}(e,r,t,i),i.push((0,u.ed)(r)),r}(e,a,n);return function(e,t,i,a){var n=e.view,r=e.graphic,o=new W({view:n,extensionType:Be.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});Be.visualElements.zVerticalLine.apply(o);var s=new G.W({view:n,intersectsLineInfinite:!0,attached:!1});Be.visualElements.pointGraphics.shadowStyle.apply(s);var l=(0,te.Vl)(Be.visualElements.heightPlaneAngleCutoff),h=new G.W({view:n,attached:!1,angleCutoff:l});Be.visualElements.heightPlane.apply(h);var p=(0,g.RL)(e.graphic),d=le.o.fromElevationInfo(p),f="on-the-ground"===p.mode||!p.offset&&"absolute-height"!==p.mode,v=new Mt,y=1,m=1,M=function(){v.update(e);var i=Ot(r),l=f&&(t.isDraped||(0,c.Wi)(i)||!i.hasZ),u=!0;if(!l&&(0,c.pC)(i)){var p=(0,se.w7)(i,n.elevationProvider,d,n.renderCoordsHelper);(0,_.s)(Et,i.x,i.y,p),(0,ae.SH)(Et,i.spatialReference,Et,n.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(Et),s.intersectsWorldUpAtLocation=Et}else u=!1;var g=2&v.grabbingState?Be.visualElements.laserlineAlphaMultiplier:1;g!==y&&(y=g,Be.visualElements.heightPlane.apply(h,g));var M=(0,ne.cS)(Zt);!l&&t.displaying&&a.calculateMapBounds(M)&&(0,ae.SH)((0,ne.KE)(M,Et),n.spatialReference,Et,n.renderCoordsHelper.spatialReference)?(h.heightManifoldTarget=Et,h.attached=!0):h.attached=!1;var b=4&v.grabbingState?Be.visualElements.laserlineAlphaMultiplier:1;b!==m&&(m=b,Be.visualElements.pointGraphics.shadowStyle.apply(s,b));var w=u&&t.displaying&&!l;s.attached=w,o.attached=w};i.push(t.watch(["displaying","isDraped"],M),t.on("changed",M)),e.forEachManipulator((function(e){i.push(e.events.on("grab-changed",M))})),i.push((0,u.ed)(s)),i.push((0,u.ed)(o)),i.push((0,u.ed)(h)),M()}(e,a,n,r),n.push(t.trackGraphicState(a)),{visualElement:r,remove:function(){(0,u.AL)(n).remove()}}}function Ot(e){var t=e.geometry;return(0,c.Wi)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}var Et=(0,M.c)(),Zt=(0,ne.Ue)();function Gt(e){switch((0,c.Wg)(e.graphic.geometry).type){case"point":case"mesh":return Ct(e);case"polygon":case"polyline":return bt(e);default:return null}}var Dt=[1,.5,0],At=70,Rt=Math.ceil(At/3*2),Pt=160,zt=5*Math.PI/12,Tt=1*Math.PI/3,Vt=function(){function e(){(0,n.Z)(this,e),this._available=!0}return(0,r.Z)(e,[{key:"location",set:function(e){this.forEachManipulator3D((function(t){return t.location=e}))}},{key:"elevationAlignedLocation",set:function(e){this.forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))}},{key:"elevationInfo",set:function(e){this.forEachManipulator3D((function(t){return t.elevationInfo=e}))}},{key:"renderLocation",get:function(){var e;return this.forEachManipulator3D((function(t){e||(e=t.renderLocation)})),e}},{key:"available",get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D((function(t){return t.available=e}))}},{key:"grabbing",get:function(){return this.someManipulator((function(e){return e.grabbing}))}},{key:"dragging",get:function(){return this.someManipulator((function(e){return e.dragging}))}},{key:"hasManipulator",value:function(e){return this.someManipulator((function(t){return t===e}))}},{key:"someManipulator",value:function(e){var t=!1;return this.forEachManipulator((function(i){!t&&e(i)&&(t=!0)})),t}},{key:"forEachManipulator3D",value:function(e){this.forEachManipulator((function(t,i){t instanceof _t.Z&&e(t,i)}))}}]),e}(),It=i(51328),Wt=i(74229);function Ht(e,t,i,a){var n=e.graphic,r=function(e,i){return t({action:e,graphic:n,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY})};return i((function(e,t,i){var o=t.next((function(e){return"start"===e.action&&r("start",e),e})).next((0,Wt.a9)(n,a)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e}));return i.next((0,Wt.bD)(n)).next((function(){r("end",{screenDeltaX:0,screenDeltaY:0})})),o}))}function Lt(e){if((0,c.Wi)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;var i=t[0],a=t[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}var Ft=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this))._handles=new k.Z,a._arrowManipulatorInfos=new Array,a._opaqueMaterial=a.createMaterial(),a._transparentMaterial=a.createMaterial(.5),a._angle=0,a._scale=1,a._radius=At,a._updateAfterDrag=!1,a.events=new qe.Z,a._tool=e.tool,a._view=e.view,null!=e.radius&&(a._radius=e.radius),a._createManipulators(),a.forEachManipulator((function(e){return a._tool.manipulators.add(e)})),a}return(0,r.Z)(i,[{key:"orthogonalAvailable",set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}},{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles=(0,c.SC)(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}},{key:"forEachManipulator",value:function(e){var t,i=(0,je.Z)(this._arrowManipulatorInfos);try{for(i.s();!(t=i.n()).done;){e(t.value.manipulator,1)}}catch(a){i.e(a)}finally{i.f()}}},{key:"createGraphicDragPipeline",value:function(e,t,i){var a=this,n=t.graphic,r=(0,g.RL)(n),o=(0,c.Wg)(n.geometry).spatialReference;return Ht(t,i,(function(t){return a.createDragPipeline((function(i,a,n,r,o){return t(i,e(i,a,n,r,o),n)}),r,o,n)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,i,n){var r=this;return(0,u.AL)(this._arrowManipulatorInfos.map((function(o,s){var l=o.manipulator;return(0,Wt.Xd)(l,(function(o,l,u,c,h){var p=l.next((function(e){return(0,a.Z)((0,a.Z)({},e),{},{manipulatorType:1})})).next((0,Wt.kY)(r._view,o.elevationAlignedLocation)).next((0,It.G)(r._view,o.elevationAlignedLocation,t,i,n)).next((0,Wt.M2)(o.location,r.angle+(s+1)*Math.PI*.5)).next((0,Wt.zh)());e(o,p,u,c,h)}))})))}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}},{key:"_updateManipulators",value:function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}},{key:"_updateArrowManipulator",value:function(e,t){var i=e.manipulator,a=e.transform,n=this._radius/At,r=54*n,o=r*Math.sqrt(3)/2,s=V.Z.createExtrudedTriangle(o,r/2,r/2,.02);V.Z.transformInPlace(s,(0,D.v)(re.MP.get(),(0,_.s)(re.WM.get(),0,-o/3,0))),i.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],i.radius=o/3*2*1.2;var l=(0,D.i)(re.MP.get());(0,D.A)(l,t*Math.PI/2);var u=(0,D.i)(re.MP.get());(0,D.v)(u,(0,_.s)(re.WM.get(),0,100*n,0)),(0,D.m)(a,l,u)}},{key:"_createManipulators",value:function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}},{key:"_updateManipulatorTransform",value:function(){var e=this.angle,t=(0,D.i)(re.MP.get());(0,D.e)(t,t,e,(0,M.f)(0,0,1));var i=(0,D.w)(re.MP.get(),(0,_.s)(re.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,D.i)(re.MP.get());(0,D.m)(a,i,t);var n,r=(0,je.Z)(this._arrowManipulatorInfos);try{for(r.s();!(n=r.n()).done;){var o=n.value,s=(0,D.m)(re.MP.get(),a,o.transform);o.manipulator.modelTransform=s}}catch(l){r.e(l)}finally{r.f()}}},{key:"_createArrowManipulator",value:function(e){var t=this,i=new _t.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,M.f)(0,0,1)}}),a={manipulator:i,transform:(0,A.c)()};return this._updateArrowManipulator(a,e),this._handles.add(i.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),a}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=m.Z.toUnitRGBA(Oe.main);return t[3]*=e,new me.E({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}}}]),i}(Vt),Ut=function(){function e(){(0,n.Z)(this,e),this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Wt.hM,this._enabled=!1}return(0,r.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(0,c.pC)(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if((0,c.pC)(i)){var a={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=e}},{key:"snap",value:function(e){var t=(0,c.pC)(this.view)?this.view.toMap(e,{exclude:[]}):null;return(0,c.pC)(t)&&(0,c.pC)(this.view)&&(t.z=(0,g.Ou)(t,this.view,this.elevationInfo)),t}},{key:"createDragEventPipelineStep",value:function(e,t){var i=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(i.lastDragEvent="end"!==e.action?(0,a.Z)({},e):null,i._enabled){var t=i.snap(e.screenEnd);return(0,c.pC)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}]),e}(),Bt=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this))._handles=new k.Z,a._snapToScene=new Ut,a._discMaterial=a._createMaterial(),a._discMaterialTransparent=a._createMaterial(.5),a._scale=1,a._radius=At,a._view=e.view,a._tool=e.tool,null!=e.snapToScene&&(a.snapToScene=e.snapToScene),null!=e.radius&&(a._radius=e.radius),a._createManipulator(),a.forEachManipulator((function(e){return a._tool.manipulators.add(e)})),a}return(0,r.Z)(i,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"snapToScene",get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"createGraphicDragPipeline",value:function(e,t,i){var a=this,n=t.graphic,r=(0,g.RL)(n),o=(0,c.Wg)(n.geometry).spatialReference;return Ht(t,i,(function(t){return a.createDragPipeline((function(i,a,n,r,o){return t(i,e(i,a,n,r,o),n)}),r,o,n)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,i,n){var r=this,o=this._view;return(0,Wt.Xd)(this._manipulator,(function(s,l,u,c,h){var p=l.next((0,Wt.kY)(o,s.elevationAlignedLocation)).next((0,It.G)(o,s.elevationAlignedLocation,t,i,n)).next(r._snapToScene.createDragEventPipelineStep(o,t),r._snapToScene.next).next((function(e){return(0,a.Z)((0,a.Z)({},e),{},{manipulatorType:1})})).next((0,Wt.zh)());e(s,p,u,c,h)}))}},{key:"_updateManipulatorTransform",value:function(){var e=(0,D.w)(re.MP.get(),(0,_.s)(re.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}},{key:"_createManipulator",value:function(){var e=this._view;this._manipulator=new _t.Z({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,M.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}},{key:"_updateManipulator",value:function(){var e=V.Z.createCylinderGeometry(.02,1,128,(0,M.f)(0,0,1),(0,M.f)(0,0,0)),t=(0,D.w)((0,A.c)(),(0,M.f)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/At*80}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=m.Z.toUnitRGBA(Oe.main);return t[3]*=e,new me.E({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{discManipulator:this._manipulator}}}]),i}(Vt),jt=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this))._handles=new k.Z,a._radius=At,a.events=new qe.Z,a._tool=e.tool,a._view=e.view,null!=e.radius&&(a._radius=e.radius),a.createManipulator(),a.forEachManipulator((function(e){return a._tool.manipulators.add(e)})),a}return(0,r.Z)(i,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))}},{key:"forEachManipulator",value:function(e){e(this._manipulator,0)}},{key:"createGraphicDragPipeline",value:function(e,t,i){var a=this,n=(0,c.Wg)(t.graphic.geometry).spatialReference;return Ht(t,i,(function(t){return a.createDragPipeline((function(i,a,n,r,o){return t(i,e(i,a,n,r,o),n)}),n)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t){var i=this._view;return(0,Wt.Xd)(this._manipulator,(function(n,r,o,s,l){var u=r.next((function(e){return(0,a.Z)((0,a.Z)({},e),{},{manipulatorType:0})})).next((0,It.Sp)(i,n.renderLocation,t)).next((0,Wt.zh)());e(n,u,o,s,l)}))}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}},{key:"updateManipulator",value:function(){var e=this._radius/At,t=Be.zManipulator.height*e,i=Be.zManipulator.coneHeight*e,a=Be.zManipulator.coneWidth*e,n=Be.zManipulator.width*e,r=[(0,M.f)(0,0,0),(0,M.f)(0,0,t)],o=V.Z.createTubeGeometry(r,n/2,16,!1),s=V.Z.createConeGeometry(i,a/2,16,!1),l=[(0,M.f)(0,0,0),(0,M.f)(0,0,t+i)],u=function(e){var i=(0,A.c)();if((0,D.a)(i,i,[0,0,t]),(0,D.d)(i,i,Math.PI/2),e){var n=1+2*e/a;(0,D.f)(i,i,[n,n,n])}return i}(0),c=function(e,t){var i=(0,Se._j)(Be.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,Be.zManipulator.color.a*e]},h=(0,yt.EA)(c(1,.25),1),p=(0,yt.EA)(c(1,0),1),d=(0,yt.EA)(c(.7,0),Be.zManipulator.renderOccluded),f=(0,yt.EA)(c(.85,0),Be.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:s,transform:u,material:h,stateMask:1},{geometry:o,material:h,stateMask:1},{geometry:s,transform:u,material:p,stateMask:2},{geometry:o,material:p,stateMask:2},{geometry:s,transform:u,material:d,stateMask:1},{geometry:o,material:d,stateMask:1},{geometry:s,transform:u,material:f,stateMask:2},{geometry:o,material:f,stateMask:2}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}},{key:"createManipulator",value:function(){var e=this,t=new _t.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var i=e._view.state.camera,a=qt;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,a);var n=(0,_.j)(i.eye,a),r=i.computeRenderPixelSizeAtDist(n),o=(0,_.f)(Nt,a,i.eye);(0,_.n)(o,o);var s=Qt;e._view.renderCoordsHelper.worldUpAtPosition(qt,s);var l=Math.abs((0,_.d)(o,s)),u=(0,_.c)(Nt,o,s),c=(0,_.c)(Nt,u,s),h=(0,te.uZ)(l,.01,1),p=1-Math.sqrt(1-h*h)/h/i.fullWidth,d=e._radius/At,f=Be.zManipulator.width*d;(0,_.a)(c,(0,_.n)(c,c),(1/p-1)*n+r*f),t[12]-=Nt[0],t[13]-=Nt[1],t[14]-=Nt[2]},this._manipulator=t,this.updateManipulator()}},{key:"test",get:function(){return{manipulator:this._manipulator}}}]),i}(Vt),qt=(0,M.c)(),Nt=(0,M.c)(),Qt=(0,M.c)(),Yt=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;(0,n.Z)(this,i),(a=t.call(this))._handles=new k.Z,a._angleDeferred=null,a._interactive=!0;var r=e.tool,o=e.view,s=e.snapToScene,l=e.radius;return a._view=o,a.xyManipulation=new Bt({tool:r,view:o,snapToScene:s,radius:l}),a.xyAxisManipulation=new Ft({tool:r,view:o,radius:l}),a.zManipulation=new jt({tool:r,view:o,radius:l}),a.xyManipulation.available=e.xyAvailable,a.xyAxisManipulation.available=e.xyAxisAvailable,a.zManipulation.available=e.zAvailable,a.autoHideXYAxis(),a.forEachManipulator((function(e){a._handles.add(e.events.on("grab-changed",(function(){return a.updateManipulatorInteractivity()})))})),a}return(0,r.Z)(i,[{key:"destroy",value:function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}},{key:"createGraphicDragPipeline",value:function(e,t,i){return(0,u.AL)([this.xyManipulation.createGraphicDragPipeline((function(t,i,a,n,r){return e(0,t,i,a,n,r)}),t,i),this.xyAxisManipulation.createGraphicDragPipeline((function(t,i,a,n,r){return e(1,t,i,a,n,r)}),t,i),this.zManipulation.createGraphicDragPipeline((function(t,i,a,n,r){return e(2,t,i,a,n,r)}),t,i)])}},{key:"createDragPipeline",value:function(e,t,i,a){return(0,u.AL)([this.xyManipulation.createDragPipeline((function(t,i,a,n,r){return e(0,t,i,a,n,r)}),t,i,a),this.xyAxisManipulation.createDragPipeline((function(t,i,a,n,r){return e(1,t,i,a,n,r)}),t,i,a),this.zManipulation.createDragPipeline((function(t,i,a,n,r){return e(2,t,i,a,n,r)}),i)])}},{key:"snapToScene",set:function(e){this.xyManipulation.snapToScene=e}},{key:"angle",set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}},{key:"angleDeferred",set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}},{key:"interactive",set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}},{key:"radius",set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}},{key:"displayScale",set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}},{key:"forEachManipulator",value:function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,1)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,1)})),this.zManipulation.forEachManipulator((function(t){return e(t,0)}))}},{key:"xyAxisVisible",get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}},{key:"autoHideXYAxis",value:function(){var e=this,t=this.xyAxisManipulation,i=this.xyManipulation;if(!(0,d.Z)("esri-mobile")){var a=[];i.forEachManipulator((function(e){return a.push(e)})),t.forEachManipulator((function(e){return a.push(e)}));for(var n=function(){var i=[];e.xyAxisVisible?(0,c.pC)(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return i.push(e.disableDisplay())})),e._handles.remove(Xt),e._handles.add(i,Xt)},r=0,o=a;r<o.length;r++){var s=o[r];this._handles.add(s.events.on("focus-changed",n))}this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",n)),n()}}},{key:"updateManipulatorInteractivity",value:function(){var e=this,t=this.grabbing;this.forEachManipulator((function(i){i.interactive=!t&&e._interactive||i.grabbing}))}}],[{key:"radiusForSymbol",value:function(e){var t=(0,c.pC)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?Rt:At}}]),i}(Vt),Xt="disable-xy-axis-display",Jt=i(2346),Kt=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this))._handles=new k.Z,a._view=e.view,a._tool=e.tool,a._graphicState=e.graphicState,a._createManipulator(),a.forEachManipulator((function(e){return a._tool.manipulators.add(e)})),a}return(0,r.Z)(i,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"createGraphicDragPipeline",value:function(e){var t=this;return Ht(this._graphicState,e,(function(e){return t.createDragPipeline(e)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e){var t=this._view,i=this._graphicState.graphic,a=(0,c.pC)(i.geometry)?i.geometry.spatialReference:null;return(0,Wt.Xd)(this._manipulator,(function(n,r,o,s,l){var u=r.next((0,It._y)(l,t,i,a)).next((0,Wt.AN)()).next((0,Wt.zh)());e(n,u,o,s,l)}))}},{key:"_createManipulator",value:function(){var e=this._view,t=this._graphicState.graphic;this._manipulator=new Jt.L({graphic:t,view:e,selectable:!0,cursor:"move"})}}]),i}(Vt),$t=i(57889),ei=i(45900),ti=i(87268),ii=i(34019),ai=i(80151),ni=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.allGraphics=t,this.type="graphic-move-start"})),ri=(0,r.Z)((function e(t,i,a){(0,n.Z)(this,e),this.dx=t,this.dy=i,this.allGraphics=a,this.type="graphic-move"})),oi=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.allGraphics=t,this.type="graphic-move-stop"})),si=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).graphics=new vt.Z,a.enableZ=!0,a.type="move-3d",a._toolHandles=new k.Z,a.snappingPipeline=new ai.n,a}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this;this._toolHandles.add([this.graphics.on("change",(function(){return e._refreshManipulators()}))]),this._refreshManipulators(),this.complete()}},{key:"destroy",value:function(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"reset",value:function(){}},{key:"_refreshManipulators",value:function(){var e=this;this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return 0===(0,$t.P)(e)})).map((function(e){return new li(e)}));t.length&&(this.createManipulators(t),this.createVisualElements(t),this.handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this.updateMoveManipulation(t))}},{key:"createManipulators",value:function(e){var t,i=this,n=(0,je.Z)(e);try{var r=function(){var n=t.value,r=n.state;n.manipulationXY=new Kt({tool:i,view:i.view,graphicState:r}),n.manipulationXY.forEachManipulator((function(e){return i.handles.add(e.events.on("immediate-click",(function(e){i.emit("immediate-click",(0,a.Z)((0,a.Z)({},e),{},{graphic:r.graphic})),e.stopPropagation()})))})),i.handles.add(n.manipulationXY.createDragPipeline((function(t,a,n,r){return i.buildDragEventPipeline(e,0,t,a,n,r)})))};for(n.s();!(t=n.n()).done;)r()}catch(o){n.e(o)}finally{n.f()}this.createMoveManipulation(e)}},{key:"createMoveManipulation",value:function(e){var t=this,i=new Yt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Yt.radiusForSymbol(e[0].graphic.symbol):At});this._moveManipulation=i,i.elevationInfo={mode:"absolute-height",offset:0},i.forEachManipulator((function(e){t.handles.add(e.events.on("immediate-click",(function(n){i.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",(0,a.Z)((0,a.Z)({},n),{},{graphic:t.graphics.getItemAt(0)})),n.stopPropagation()})))}));var n,r=function(){return t.updateMoveManipulation(e)},o=(0,je.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;this.handles.add([s.state.on("changed",r),s.state.watch("displaying",r)])}}catch(u){o.e(u)}finally{o.f()}var l=e[e.length-1];this.handles.add(l.state.on("changed",(function(){return t.updateMoveManipulationAngle(l)}))),this.handles.add(i.createDragPipeline((function(i,a,n,r,o){return t.buildDragEventPipeline(e,i,a,n,r,o)}),(0,g.RL)(l.graphic),(0,c.Wg)(l.graphic.geometry).spatialReference,l.graphic)),this.updateMoveManipulationAngle(l)}},{key:"createVisualElements",value:function(e){var t,i=this,a=(0,je.Z)(e);try{var n=function(){var a=t.value,n=a.graphic,r=Gt({view:i.view,graphic:n,forEachManipulator:function(e){a.manipulationXY.forEachManipulator(e),i._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return(0,u.kB)()}});(0,c.Wi)(r)||(a.geometryRepresentation=r.visualElement,a.geometryRepresentation instanceof tt&&i.handles.add([a.geometryRepresentation.events.on("attachment-origin-changed",(function(){a.state.isDraped||i.updateMoveManipulation(e)})),a.state.watch("isDraped",(function(){return i.updateMoveManipulation(e)}))]),i.handles.add(r))};for(a.s();!(t=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}}},{key:"updateMoveManipulationAngle",value:function(e){this._moveManipulation.angleDeferred=function(){return Lt(e.graphic.geometry)}}},{key:"updateMoveManipulation",value:function(e){var t,i=(0,Ne.Tx)(0,0,0,this.view.spatialReference),a=0,n=!1,r=this._moveManipulation,o=(0,je.Z)(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(s.state.displaying){var l=s.state.graphic;this.enableZ&&mt(l)&&(n=!0);var u=s.geometryRepresentation instanceof tt&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:(0,yt.du)(this.view,l);(0,c.pC)(u)&&(i.x+=u.x,i.y+=u.y,i.z+=u.z,a++)}}}catch(h){o.e(h)}finally{o.f()}a>0?(i.x/=a,i.y/=a,i.z/=a,r.location=i,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=n):r.available=!1}},{key:"buildDragEventPipeline",value:function(e,t,i,a,n,r){var o=this,s=[],l=[],u=null,c=null,h=function(){var e,t=(0,je.Z)(s);try{for(t.s();!(e=t.n()).done;){e.value.dragging=!1}}catch(i){t.e(i)}finally{t.f()}s.length=0,l.length=0,u=null,c=null,o._moveManipulation.interactive=!0};if(1===e.length&&0===t){var p=e[0].graphic;a=this.buildSnappingPipelineSteps(p,(0,g.RL)(p),a,n,r)}var d=a.next((function(t){if("start"===t.action){s.length=0,l.length=0;var a,n=(0,je.Z)(e);try{for(n.s();!(a=n.n()).done;){var r=a.value;r.dragging||!r.manipulationXY.hasManipulator(i)&&r.manipulationXY.grabbing||(s.push(r),l.push(r.graphic),r.dragging=!0)}}catch(h){n.e(h)}finally{n.f()}if(0!==l.length&&(o._moveManipulation.interactive=!1,u=(0,Wt.oq)(l,o.view.state.viewingMode),c=(0,Wt.QY)(l),o.emit("graphic-move-start",new ni(l)),o.destroyed))return null}return 0!==l.length?t:null})).next((function(e){return u(e)})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=o.view.toScreen(e.mapStart),i=o.view.toScreen(e.mapEnd),a=i.x-t.x,n=i.y-t.y;if(o.emit("graphic-move",new ri(a,n,l)),o.destroyed)return null}break;case"end":if(o.emit("graphic-move-stop",new oi(l)),o.destroyed)return null;h()}}));return n.next((function(e){return c(e)})).next((function(){if(o.emit("graphic-move-stop",new oi(l)),o.destroyed)return null;h()})),d}},{key:"buildSnappingPipelineSteps",value:function(e,t,i,n,r){var o=this,s=e.geometry;if((0,c.Wi)(s)||"point"!==s.type&&"mesh"!==s.type)return i;var l=("point"===s.type?s:s.anchor).clone(),u=new ii.N({elevationInfo:t,pointer:r,editGeometryOperations:ti.c.fromGeometry(l,this.view.state.viewingMode),visualizer:new ke,excludeFeature:e}),h=this.snappingManager;return i.next((function(t){return l.z=(0,g.vQ)(o.view,l,(0,g.RL)(e),{mode:"absolute-height",offset:0}),(0,a.Z)((0,a.Z)({},t),{},{snapOrigin:u.coordinateHelper.pointToVector(l)})})).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:u,snappingManager:h,cancel:n,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}}]),i}((0,gt.p)(qe.Z.EventedMixin(ei.m)));(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],si.prototype,"view",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],si.prototype,"graphics",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],si.prototype,"enableZ",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],si.prototype,"snappingManager",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],si.prototype,"type",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],si.prototype,"updating",null),si=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],si);var li=function(){function e(t){(0,n.Z)(this,e),this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new ct.F({graphic:t})}return(0,r.Z)(e,[{key:"graphic",get:function(){return this.state.graphic}}]),e}(),ui=i(46684),ci=i(29909),hi=i(74579),pi=i(55652),di=i(3711);function fi(e,t,i){var a="on-the-ground"===i.mode?1:0;return new di.A(e,a,t,0)}function vi(e,t,i){var a=(0,M.c)();if(!e.renderCoordsHelper.toRenderCoords(t,a))return null;var n=gi(e,t,(0,pi.mJ)(i.plane)),r=gi(e,t,i.edgeDirection);if((0,c.Wi)(n)||(0,c.Wi)(r))return null;var o=(0,_.c)((0,M.c)(),n,r);return(0,pi.Yq)(a,o,(0,pi.Ue)())}function gi(e,t,i){var a=(0,Ne.Tx)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),n=(0,M.c)(),r=(0,M.c)();return e.renderCoordsHelper.toRenderCoords(t,n)&&e.renderCoordsHelper.toRenderCoords(a,r)?(0,_.r)(r,n,r):null}var yi=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e))._vertexManipulatorMaterial=(0,yt.EA)(Be.colorToVec4(Be.reshapeManipulators.vertex.color),Be.reshapeManipulators.vertex.renderOccluded),a._vertexManipulatorOutlineMaterial=(0,yt.qJ)(Be.colorToVec4(Be.reshapeManipulators.vertex.outlineColor),Be.reshapeManipulators.vertex.renderOccluded),a._vertexManipulatorHoverOutlineMaterial=(0,yt.qJ)(Be.colorToVec4(Be.reshapeManipulators.vertex.hoverOutlineColor),Be.reshapeManipulators.vertex.renderOccluded),a._edgeManipulatorMaterial=(0,yt.EA)(Be.colorToVec4(Be.reshapeManipulators.edge.color),Be.reshapeManipulators.edge.renderOccluded),a._edgeManipulatorOutlineMaterial=(0,yt.qJ)(Be.colorToVec4(Be.reshapeManipulators.edge.outlineColor),Be.reshapeManipulators.edge.renderOccluded),a._edgeOffsetManipulatorMaterial=(0,yt.EA)(Be.colorToVec4(Be.reshapeManipulators.edgeOffset.color),Be.reshapeManipulators.edgeOffset.renderOccluded,!1),a._edgeOffsetManipulatorHoverMaterial=(0,yt.EA)(Be.colorToVec4(Be.reshapeManipulators.edgeOffset.hoverColor),Be.reshapeManipulators.edgeOffset.renderOccluded,!1),a._selectedManipulatorMaterial=(0,yt.EA)(Be.colorToVec4(Be.reshapeManipulators.selected.color),Be.reshapeManipulators.selected.renderOccluded),a._selectedManipulatorOutlineMaterial=(0,yt.qJ)(Be.colorToVec4(Be.reshapeManipulators.selected.outlineColor),Be.reshapeManipulators.selected.renderOccluded),a._selectedManipulatorHoverOutlineMaterial=(0,yt.qJ)(Be.colorToVec4(Be.reshapeManipulators.selected.hoverOutlineColor),Be.reshapeManipulators.selected.renderOccluded),a._selectedIndex=0,a._vertexManipulatorGeometry=null,a._vertexManipulatorOutlineGeometry=null,a._edgeManipulatorGeometry=null,a._edgeManipulatorOutlineGeometry=null,a._edgeOffsetManipulatorGeometryInside=null,a._edgeOffsetManipulatorGeometryOutside=null,a._manipulatorHandles=new k.Z,a._manipulatorInfos=[],a._editGeometryOperations=null,a._graphicMoveManipulation=null,a._moveManipulation=null,a._numGrabbing=0,a._numDragging=0,a._reshapeEventState=0,a._outlineVisualElement=null,a.tool=null,a.outputGeometry=null,a._snappingPipeline=new ai.n,a._snappingPipelineHandle=new ai.n,a._vertexLaserLineVisualElement=null,a}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this,t=new ct.F({graphic:this.graphic});this._graphicState=t,this.handles.add([t.watch("displaying",(function(t){var i,a=(0,je.Z)(e._manipulatorInfos);try{for(a.s();!(i=a.n()).done;){i.value.manipulator.available=t}}catch(n){a.e(n)}finally{a.f()}})),this.view.trackGraphicState(t)])}},{key:"destroy",value:function(){this._editGeometryOperations=(0,c.SC)(this._editGeometryOperations),this._moveManipulation=(0,c.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,c.SC)(this._graphicMoveManipulation),this._manipulatorHandles=(0,c.SC)(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}},{key:"inputGeometry",get:function(){return(0,c.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null},set:function(e){this._recreateEditGeometryAndManipulators(e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZShape",get:function(){return this.tool.enableZShape}},{key:"enableZVertex",get:function(){return this.tool.enableZVertex}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"enableMidpoints",get:function(){return this.tool.enableMidpoints}},{key:"enableEdgeOffset",get:function(){return this.tool.enableEdgeOffset}},{key:"removeSelectedVertices",value:function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.handle.type}));this._removeVertices(e)}},{key:"manipulatorSelectionChanged",value:function(){this.emit("manipulators-changed")}},{key:"_removeManipulators",value:function(){this._moveManipulation=(0,c.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,c.SC)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}},{key:"_resetGrabbingDragging",value:function(){this._numGrabbing=0,this._numDragging=0}},{key:"_createManipulators",value:function(){if(!(0,c.Wi)(this._editGeometryOperations)){var e,t=(0,g.RL)(this.graphic),i=(0,je.Z)(this._editGeometryOperations.data.components);try{for(i.s();!(e=i.n()).done;){var a,n=e.value,r=(0,je.Z)(n.vertices);try{for(r.s();!(a=r.n()).done;){var o=a.value;this._createVertexOrEdgeManipulator(o,t)}}catch(h){r.e(h)}finally{r.f()}var s,l=(0,je.Z)(n.edges);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._createVertexOrEdgeManipulator(u,t)}}catch(h){l.e(h)}finally{l.f()}}}catch(h){i.e(h)}finally{i.f()}this._createGraphicMoveManipulators(t)}}},{key:"canRedo",get:function(){return(0,c.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}},{key:"canUndo",get:function(){return(0,c.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}},{key:"redo",value:function(){if((0,c.Wi)(this._editGeometryOperations))return null;var e=this._editGeometryOperations.redo();return(0,c.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}},{key:"undo",value:function(){if((0,c.Wi)(this._editGeometryOperations))return null;this.emit("undo");var e=this._editGeometryOperations.undo();return(0,c.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}},{key:"_recreateManipulators",value:function(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators()}},{key:"_recreateEditGeometryAndManipulators",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputGeometry;this._removeManipulators(),this._resetGrabbingDragging(),(0,c.Wi)(e)||((0,c.SC)(this._editGeometryOperations),this._editGeometryOperations=ti.c.fromGeometry(e,this.view.state.viewingMode),this._createManipulators())}},{key:"_perGraphicManipulatorDragAction",value:function(e,t){if("end"!==t.action){var i,a=0,n=[],r=this._manipulatorInfos.some((function(e){return"vertex"===e.handle.type&&e.manipulator.selected})),o=1===e&&r,s=(0,je.Z)(this._manipulatorInfos);try{for(s.s();!(i=s.n()).done;){var l=i.value;_i(l)&&(l.manipulator.grabbing||o&&!l.manipulator.selected||n.push(l),a++)}}catch(u){s.e(u)}finally{s.f()}if(0!==n.length)if(this._moveVertices(n,t),n.length===a){if(this._updateEventState(1),this.destroyed)return;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(2),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_isMultiVertexSelection",value:function(){var e,t=0,i=(0,je.Z)(this._manipulatorInfos);try{for(i.s();!(e=i.n()).done;){var a=e.value;_i(a)&&a.manipulator.selected&&t++}}catch(n){i.e(n)}finally{i.f()}return t>1}},{key:"_perVertexManipulatorDragAction",value:function(e){if(this._updateEventState(2),!this.destroyed){var t=e.mapDeltaX,i=e.mapDeltaY,a=e.mapDeltaZ;if(t||i||a){var n,r=[],o=(0,je.Z)(this._manipulatorInfos);try{for(o.s();!(n=o.n()).done;){var s=n.value;_i(s)&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&r.push(s)}}catch(l){o.e(l)}finally{o.f()}this._moveVertices(r,e,1),this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_updateEventState",value:function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}},{key:"_createGraphicMoveManipulators",value:function(e){var t=this;if(this._graphicMoveManipulation=new Kt({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){var i=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,a,n){a.next((function(e){return t._trackNumDragging(e)})).next((function(e){return"start"===e.action&&(i=(0,c.Wg)(t._editGeometryOperations).createUndoGroup()),e})).next((function(e){t._perGraphicManipulatorDragAction(0,e),"end"===e.action&&(i=(0,c.hw)(i))})),n.next(t._cancelDragOperation((function(){return i=(0,c.hw)(i)})))})))}else this._graphicMoveManipulation.forEachManipulator((function(e){e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click",(0,a.Z)((0,a.Z)({},e),{},{graphic:t.graphic})),e.stopPropagation()}))])})),this._moveManipulation=new Yt({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&mt(this.graphic),snapToScene:!1,radius:Yt.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((function(e){t.handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(i){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click",(0,a.Z)((0,a.Z)({},i),{},{graphic:t.graphic})),i.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var n=(0,c.Wg)(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline((function(i,n,r,o,s){var l=r.next((function(e){return t._trackNumDragging(e)})).next((function(e){var i=t._manipulatorInfos.filter((function(e){return _i(e)&&e.manipulator.selected}));return 1===e.manipulatorType&&1===i.length?(0,a.Z)((0,a.Z)({},e),{},{info:i[0],snapOrigin:i[0].handle.pos}):(0,a.Z)((0,a.Z)({},e),{},{info:null})})).next(t._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:function(e){return!!e.info},cancel:o,snappingManager:t.tool.snappingManager,snappingContext:new ii.N({editGeometryOperations:(0,c.Wg)(t._editGeometryOperations),elevationInfo:e,pointer:s,excludeFeature:t.graphic,visualizer:new ke}),updatingHandles:t.updatingHandles}),t._snappingPipelineHandle.next).next((0,Wt.AN)()).next((function(e){return t._perGraphicManipulatorDragAction(1,e),e}));return o.next(t._cancelDragOperation()),l}),e,n,this.graphic),(0,h.S1)(this._graphicState,"displaying",(function(){t._updateMoveManipulationPosition()})),this._graphicState.on("changed",(function(){return t._updateMoveManipulationPosition()})),(0,h.S1)(this._graphicState,"isDraped",(function(){var e="align-move-manipulation";t._graphicState.isDraped?t.handles.add(t.view.elevationProvider.on("elevation-change",(function(){return t._updateMoveManipulationPosition()})),e):t.handles.remove(e)}))]),this._updateMoveManipulationPosition();var r=Gt({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){(0,c.pC)(t._graphicMoveManipulation)&&t._graphicMoveManipulation.forEachManipulator(e);var i,a=(0,je.Z)(t._manipulatorInfos);try{for(a.s();!(i=a.n()).done;){e(i.value.manipulator,1)}}catch(n){a.e(n)}finally{a.f()}t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});(0,c.pC)(r)&&(this._outlineVisualElement=r.visualElement instanceof tt?r.visualElement:null),(0,c.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(r)}},{key:"_createEdgeOffsetManipulator",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.RL)(this.graphic),n=Be.reshapeManipulators.edgeOffset,r=n.size/2,o=r+n.collisionPadding;if((0,c.Wi)(this._edgeOffsetManipulatorGeometryInside)||(0,c.Wi)(this._edgeOffsetManipulatorGeometryOutside)){var s=r/o,l=s*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=V.Z.createExtrudedTriangle(l,s/2,s/2,n.height,n.offset),this._edgeOffsetManipulatorGeometryOutside=V.Z.createExtrudedTriangle(-l,s/2,s/2,n.height,-n.offset)}var h=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2}],p=new _t.Z({view:this.view,renderObjects:h,elevationInfo:"on-the-ground"!==i.mode||(0,hi.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i,worldOriented:!1,focusMultiplier:1,radius:o,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:(0,M.f)(0,0,1)},collisionPriority:1}),d=new _t.Z({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),f={manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:d,elevationInfo:i,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(f,n.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(f);var v=this._getManipulatorInfoFromHandle(f.handle.leftVertex).manipulator.events.on("location-update",(function(){return t._updateEdgeOffsetManipulator(f)})),y=this._getManipulatorInfoFromHandle(f.handle.rightVertex).manipulator.events.on("location-update",(function(){return t._updateEdgeOffsetManipulator(f)}));f.locationUpdateHandle=(0,u.AL)([v,y]),this._manipulatorHandles.add(f.locationUpdateHandle,p),this._manipulatorHandles.add([this._watchAndUpdateGrabState(p,!0),this._watchAndUpdateGrabState(d,!0)],p),this._manipulatorHandles.add((0,Wt.Xd)(p,this._createEdgeOffsetPipeline(f,i)),p),this._manipulatorHandles.add((0,Wt.Xd)(d,(function(e,a,n,r){if("touch"===r)t._createEdgeOffsetPipeline(f,i)(e,a,n);else if(t.enableMoveGraphic){var o=t.graphic,s=(0,c.pC)(o.geometry)?o.geometry.spatialReference:null;a.next((function(e){return t._trackNumDragging(e)})).next((0,Wt.kY)(t.view,e.elevationAlignedLocation)).next((0,It.G)(t.view,e.elevationAlignedLocation,i,s,o)).next((0,Wt.zh)()).next((0,Wt.AN)()).next((function(e){return t._perGraphicManipulatorDragAction(0,e)})),n.next(t._cancelDragOperation())}})),p);var m=function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click",(0,a.Z)((0,a.Z)({},e),{},{graphic:t.graphic})),e.stopPropagation()};return this._manipulatorHandles.add([p.events.on("immediate-click",m),d.events.on("immediate-click",m)],p),this._manipulatorInfos.push(f),this.manipulators.add(p),this.manipulators.add(d),this.emit("manipulators-changed"),f}},{key:"_autoHideEdgeOffsetManipulator",value:function(e,t){var i=this,a=e.manipulator,n=e.edgeManipulator,r=function(){(0,c.hw)(e.visibilityHandle);var r=function(e,t,i){var a=i.projectToRenderScreen(e,(0,q.J$)()),n=i.projectToRenderScreen(t,(0,q.J$)());return(0,c.pC)(a)&&(0,c.pC)(n)?(0,_.p)((0,_.f)(a,a,n)):0}(i._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,i._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,i.view.state.camera)<t;(!a.focused&&!n.focused||r)&&(a.grabbable=!r,n.grabbable=!r,e.visibilityHandle=(0,u.AL)([a.disableDisplay(),{remove:function(){a.grabbable=!0,n.grabbable=i.enableMoveGraphic}}]))};this._manipulatorHandles.add([a.events.on("focus-changed",r),n.events.on("focus-changed",r),{remove:function(){(0,c.hw)(e.visibilityHandle),i.manipulators.remove(n)}}],a),r()}},{key:"_updateEdgeOffsetManipulator",value:function(e){this._updateManipulatorPosition(e);var t=(0,c.Wg)(this._editGeometryOperations).data.coordinateHelper,i=vi(this.view,e.manipulator.elevationAlignedLocation,fi(t,e.handle,(0,c.Wg)(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,n=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,r=(0,c.pC)(i)?function(e,t,i){var a=(0,pi.mJ)(e),n=(0,_.r)((0,M.c)(),t,i),r=(0,_.c)((0,M.c)(),n,a),o=(0,_.c)((0,M.c)(),n,r);return(0,A.f)(n[0],n[1],n[2],0,r[0],r[1],r[2],0,o[0],o[1],o[2],0,0,0,0,1)}(i,a,n):A.I;e.manipulator.modelTransform=r,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=r;var o=(0,_.l)((0,_.f)(ki,a,n))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]}}},{key:"_createEdgeOffsetPipeline",value:function(e,t){var i=this;return function(a,n,r){i._clearSelection();var o=i._initializeEdgeOffset(e,t),s=o.step,l=o.cleanup;n.next((function(e){return i._trackNumDragging(e)})).next((0,Wt.kY)(i.view,a.elevationAlignedLocation)).next(s).next((0,It.bB)(i.view)).next((0,It.zP)(i.view,(0,c.Wg)(i._editGeometryOperations).data.spatialReference)).next((0,Wt.AN)()).next(i._applyEdgeOffsetStep(e)).next((function(e){"end"===e.action&&l()})),r.next((function(e){return l(),e})).next(i._cancelDragOperation())}}},{key:"_initializeEdgeOffset",value:function(e,t){var i=this,n=(0,c.Wg)(this._editGeometryOperations),r=fi(n.data.coordinateHelper,e.handle,t),o=n.createUndoGroup(),s=vi(this.view,e.manipulator.elevationAlignedLocation,r);r.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),r.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);var l,h=function(){return new ci.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:(0,c.Wg)(i._editGeometryOperations).data.spatialReference})},p=new tt({view:this.view,isDraped:this._graphicState.isDraped,geometry:h(),elevationInfo:e.elevationInfo,width:Be.visualElements.lineGraphics.outline.width,color:Be.colorToVec4(Oe.main),attached:!0}),d=function(){i._cleanEdgeOffsetCollapsedEdges(e),l=(0,c.hw)(l)},f=this.on("undo",d);return l=(0,u.AL)([(0,u.ed)(p),this._graphicState.watch("isDraped",(function(e){return p.isDraped=e})),this._graphicState.on("changed",(function(){return p.geometry=h()})),o,f]),{step:function(e){return(0,c.Wi)(r)||(0,c.Wi)(s)?(d(),null):(0,a.Z)((0,a.Z)({},e),{},{operation:r,plane:s})},cleanup:d}}},{key:"_applyEdgeOffsetStep",value:function(e){var t=this;return function(i){if(t.destroyed||(0,c.Wi)(i.operation))return i;t._updateEventState(2);var a=i.mapDeltaX,n=i.mapDeltaY,r=i.mapDeltaZ;return(a||n||r)&&(t._offsetEdge(e,i),t.emit("reshape",{type:"reshape",mover:t.graphic})),i}}},{key:"_cleanEdgeOffsetCollapsedEdges",value:function(e){var t,i,a=null==(t=e.handle.leftVertex.leftEdge)?void 0:t.leftVertex,n=e.handle.leftVertex,r=null==(i=e.handle.rightVertex.rightEdge)?void 0:i.rightVertex,o=e.handle.rightVertex,s=(0,c.Wg)(this._editGeometryOperations).data.coordinateHelper,l=1e-6,u=[];a&&s.distance(a.pos,n.pos)<l&&u.push(this._getManipulatorInfoFromHandle(n)),(s.distance(n.pos,o.pos)<l||r&&s.distance(r.pos,o.pos)<l)&&u.push(this._getManipulatorInfoFromHandle(o)),u.length&&this._removeVertices(u)}},{key:"_computeVertexManipulatorSizeAndOutline",value:function(e){var t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}},{key:"_createVertexOrEdgeManipulator",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.RL)(this.graphic);if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,i);if(!this.enableMidpoints)return null}if((0,c.Wi)(this._vertexManipulatorGeometry)||(0,c.Wi)(this._vertexManipulatorOutlineGeometry)){var n=this._computeVertexManipulatorSizeAndOutline(Be.reshapeManipulators.vertex),r=n.size,o=n.outlineSize;this._vertexManipulatorGeometry=V.Z.createSphereGeometry(r,16,16),this._vertexManipulatorOutlineGeometry=V.Z.createSphereGeometry(o,16,16)}if((0,c.Wi)(this._edgeManipulatorGeometry)||(0,c.Wi)(this._edgeManipulatorOutlineGeometry)){var s=this._computeVertexManipulatorSizeAndOutline(Be.reshapeManipulators.edge),l=s.size,h=s.outlineSize;this._edgeManipulatorGeometry=V.Z.createSphereGeometry(l,16,16),this._edgeManipulatorOutlineGeometry=V.Z.createSphereGeometry(h,16,16)}var p=(0,c.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|bi.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|bi.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|bi.Vertex},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}];this.enableMidpoints&&p.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|bi.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|bi.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|bi.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|bi.Edge});var d=new _t.Z({view:this.view,renderObjects:p,elevationInfo:i,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(d,e,i);var f="edge"===e.type?{manipulator:d,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:d,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(f),this.manipulators.add(d),this._updateManipulatorPosition(f),"edge"===f.type){var v=this._getManipulatorInfoFromHandle(f.handle.leftVertex).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(f)})),y=this._getManipulatorInfoFromHandle(f.handle.rightVertex).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(f)}));f.locationUpdateHandle=(0,u.AL)([v,y]),this._manipulatorHandles.add(f.locationUpdateHandle,d)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(d,!0),d);var m=(0,Wt.Xd)(d,(function(e,n,r,o){var s=null;n.next((function(e){return t._trackNumDragging(e)})).next((function(e){if("start"===e.action&&(s=(0,c.Wg)(t._editGeometryOperations).createUndoGroup()),Mi(f)){var i=t._splitEdgeManipulator(f);return(0,a.Z)((0,a.Z)({},e),{},{info:i,snapOrigin:i.handle.pos})}return(0,a.Z)((0,a.Z)({},e),{},{info:f,snapOrigin:f.handle.pos})})).next((0,Wt.kY)(t.view,e.elevationAlignedLocation)).next((0,It.VG)(t.view,t.graphic,e.elevationAlignedLocation,e.location.spatialReference,t.graphic)).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return!t._isMultiVertexSelection()},cancel:r,snappingManager:t.tool.snappingManager,snappingContext:new ii.N({editGeometryOperations:(0,c.Wg)(t._editGeometryOperations),elevationInfo:i,pointer:o,excludeFeature:t.graphic,visualizer:new ke}),updatingHandles:t.updatingHandles}),t._snappingPipeline.next).next((0,Wt.AN)()).next((function(e){t._perVertexManipulatorDragAction(e),"end"===e.action&&(s=(0,c.hw)(s))})),r.next(t._cancelDragOperation((function(){return s=(0,c.hw)(s)})))}));return this._manipulatorHandles.add(m,d),this._manipulatorHandles.add([d.events.on("immediate-click",(function(e){return t._manipulatorClickCallback(e,f)})),d.events.on("select-changed",(function(){f.selectedIndex=++t._selectedIndex,t._updateMoveManipulationPosition()}))],d),this.emit("manipulators-changed"),f}},{key:"_trackNumDragging",value:function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}},{key:"_cancelDragOperation",value:function(e){var t=this;return function(){switch(t._numDragging--,t.undo(),t.outputGeometry=(0,c.pC)(t._editGeometryOperations)?t._editGeometryOperations.data.geometry:null,(0,c.pC)(t.tool.snappingManager)&&t.tool.snappingManager.doneSnapping(),t._reshapeEventState){case 0:break;case 1:t.emit("move",{type:"move",dx:0,dy:0,mover:t.graphic});break;case 2:t.emit("reshape",{type:"reshape",mover:t.graphic})}e&&e(),t.destroyed||t._updateEventState(0)}}},{key:"_setTypeSpecificManipulatorSettings",value:function(e,t,i){switch(t.type){case"vertex":e.state=bi.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=Be.reshapeManipulators.vertex.size/2+Be.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=(0,c.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=bi.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=Be.reshapeManipulators.edge.size/2+Be.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||(0,hi.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}},{key:"_watchAndUpdateGrabState",value:function(e,t){var i=this;return e.events.on("grab-changed",(function(a){if("start"===a.action)t&&i._updateSelection(e),i._numGrabbing++;else if(i._numGrabbing--,i._updateEventState(0),i.destroyed)return;i._moveManipulation.interactive=!i._numGrabbing,("touch"!==a.pointerType||i.enableEdgeOffset)&&(i._manipulatorInfos.forEach((function(e){e.manipulator.interactive=!i._numGrabbing&&(0,c.pC)(i.graphic.geometry)&&"point"!==i.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=!i._numGrabbing)})),(0,c.Wg)(i._graphicMoveManipulation).forEachManipulator((function(e){return e.interactive=!i._numGrabbing})))}))}},{key:"_clearSelection",value:function(){var e,t=(0,je.Z)(this._manipulatorInfos);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.manipulator.grabbing||(i.manipulator.selected=!1)}}catch(a){t.e(a)}finally{t.f()}}},{key:"_updateSelection",value:function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}},{key:"_removeManipulator",value:function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}},{key:"_getManipulatorInfoFromHandle",value:function(e){if(e){var t,i=(0,je.Z)(this._manipulatorInfos);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(e===a.handle)return a}}catch(n){i.e(n)}finally{i.f()}}return null}},{key:"_updateManipulatorPosition",value:function(e){if(e){var t=(0,c.Wg)(this._editGeometryOperations);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,wi),e.manipulator.grabbing&&(0,c.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if((0,c.pC)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){var n=i.location,r=a.location,o=n.x+.5*(r.x-n.x),s=n.y+.5*(r.y-n.y),l=n.hasZ&&r.hasZ?0:void 0;e.manipulator.location=(0,Ne.Tx)(o,s,l,t.data.spatialReference)}else(0,_.e)(ki,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=ki}}}},{key:"_splitEdgeManipulator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=(0,c.Wg)(this._editGeometryOperations),a=(0,c.Wg)(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var n,r=(0,g.RL)(this.graphic);this.enableEdgeOffset?(this._removeManipulator(e),n=this._createVertexOrEdgeManipulator(a)):((n=e).handle=a,n.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(n),this._updateSelection(e.manipulator);var o=this._updateEventState(2),s=i.data.coordinateHelper.vectorToArray(n.handle.pos),l=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:l,vertexIndex:(0,c.Wg)(a.index)}],added:s}),o&&this._updateEventState(0),n}},{key:"_updateMoveManipulationPosition",value:function(){var e,t=this,i=(0,_.s)(ki,0,0,0),a=0,n=!1,r=null,o=null,s=(0,je.Z)(this._manipulatorInfos);try{for(s.s();!(e=s.n()).done;){var l=e.value;_i(l)&&(l.manipulator.selected?(a++,(0,_.b)(i,i,l.manipulator.renderLocation),(0,c.Wi)(r)||l.selectedIndex>r.selectedIndex?(o=r,r=l):((0,c.Wi)(o)||l.selectedIndex>o.selectedIndex)&&(o=l)):n=!0)}}catch(g){s.e(g)}finally{s.f()}if(0!==a){var u=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=u,this._moveManipulation.xyAxisManipulation.available=u,this._moveManipulation.zManipulation.available=u&&this.enableZVertex&&mt(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=u&&1!==a}else{var h=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=h,this._moveManipulation.xyAxisManipulation.available=h,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=h,this._moveManipulation.zManipulation.available=h&&this.enableZShape&&mt(this.graphic)}if(0!==a){var p=0;if((0,c.pC)(r)){var d=r.handle.pos,f=(0,c.pC)(o)?o.handle.pos:r.handle.leftEdge&&r.handle.leftEdge.leftVertex?r.handle.leftEdge.leftVertex.pos:null,v=!(0,c.pC)(o)&&r.handle.rightEdge&&r.handle.rightEdge.rightVertex?r.handle.rightEdge.rightVertex.pos:null;f&&v?this._moveManipulation.xyAxisManipulation.available=!1:f?p=mi(f,d):v&&(p=mi(d,v))}this._moveManipulation.angle=p,this._moveManipulation.radius=Rt}else this._moveManipulation.angleDeferred=function(){return Lt((0,c.Wg)(t.graphic.geometry))},this._moveManipulation.radius=Yt.radiusForSymbol(this.graphic.symbol);0!==a&&n?((0,_.a)(i,i,1/a),wi.spatialReference=(0,c.Wg)(this._editGeometryOperations).data.spatialReference,wi.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(i,wi),this._moveManipulation.elevationAlignedLocation=wi):(0,c.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,c.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,yt.u2)(this.view,this._moveManipulation,this.graphic)}},{key:"_removeVertices",value:function(e){var t,i=[],a=(0,c.Wg)(this._editGeometryOperations),n=(0,je.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("vertex"===r.handle.type&&a.canRemoveVertex()){i.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.rightEdge));var o=(0,c.Wg)(a.removeVertices([r.handle]).removedVertices[0].createdEdge);o&&this._createVertexOrEdgeManipulator(o)}}}catch(u){n.e(u)}finally{n.f()}if(i.length>0){var s=i.map((function(e){var t=a.data.components.indexOf(e.component);return{coordinates:a.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:(0,c.Wg)(e.index)}}));this.outputGeometry=a.data.geometry;var l=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:s.map((function(e){return e.coordinates})),vertices:s}),this.destroyed)return;if(l&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}},{key:"_moveVertices",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===t.action?0:1,a=(0,c.Wg)(this._editGeometryOperations);a.moveVertices(e.map((function(e){return e.handle})),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.data.geometry;var n,r=(0,je.Z)(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;this._updateManipulatorPosition(o)}}catch(s){r.e(s)}finally{r.f()}}},{key:"_offsetEdge",value:function(e,t){if(!(0,c.Wi)(t.operation)){var i=(0,c.Wg)(this._editGeometryOperations),a=t.operation.clone();a.distance=t.operation.signedDistanceToPoint(t.mapEnd),i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}}},{key:"_manipulatorClickCallback",value:function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Mi(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}}]),i}(qe.Z.EventedMixin(gt.r));function mi(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function _i(e){return"vertex"===e.handle.type}function Mi(e){return"edge"===e.handle.type}(0,l._)([(0,p.Cb)({constructOnly:!0})],yi.prototype,"tool",void 0),(0,l._)([(0,p.Cb)()],yi.prototype,"inputGeometry",null),(0,l._)([(0,p.Cb)()],yi.prototype,"outputGeometry",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],yi.prototype,"updating",null),yi=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],yi);var bi,wi=(0,Ne.Tx)(0,0,null,null),ki=(0,M.c)();!function(e){e.Vertex=16,e.Edge=32}(bi||(bi={}));var xi=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e))._handles=new k.Z,a._reshapeOperation=null,a._internalGeometryUpdate=!1,a.enableZShape=!0,a.enableZVertex=!0,a.enableMoveGraphic=!0,a.enableMidpoints=!0,a.enableEdgeOffset=!1,a.type="reshape-3d",a.snappingManager=null,a.automaticManipulatorSelection=!1,a}return(0,r.Z)(i,[{key:"destroy",value:function(){this._handles=(0,c.SC)(this._handles),this._reshapeOperation=(0,c.SC)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}},{key:"updating",get:function(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}},{key:"_updateGeometry",value:function(){var e=(0,ui.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,c.pC)(e)?e.clone():null}},{key:"_updateGraphic",value:function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===(0,ui.P)(this.graphic)){var t=this.watch("graphic.geometry",(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),!0);this._handles.add(t,"onGraphicGeometryChange")}}},{key:"manipulatorSelectionChanged",value:function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}},{key:"_updateGeometryInternally",value:function(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}},{key:"_onReshapeGeometryChanged",value:function(){(0,c.Wi)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"initialize",value:function(){var e=this;this._reshapeOperation=new yi({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),this._reshapeOperation.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),this._reshapeOperation.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),this._reshapeOperation.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),this._reshapeOperation.on("immediate-click",(function(t){return e.emit("immediate-click",t)})),this.view.on("pointer-down",["Shift"],(function(e){e.stopPropagation()})),(0,h.S1)(this,"graphic",(function(){e._updateGraphic()}),!0)]),this.complete()}},{key:"canUndo",get:function(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}},{key:"undo",value:function(){(0,c.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,c.pC)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"canRedo",get:function(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}},{key:"redo",value:function(){(0,c.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,c.pC)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"onInputEvent",value:function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}},{key:"reset",value:function(){}},{key:"test",get:function(){return{snappingManager:this.snappingManager}}}]),i}(qe.Z.EventedMixin(ei.m));(0,l._)([(0,p.Cb)()],xi.prototype,"_reshapeOperation",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],xi.prototype,"view",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],xi.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],xi.prototype,"enableZShape",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],xi.prototype,"enableZVertex",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],xi.prototype,"enableMoveGraphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],xi.prototype,"enableMidpoints",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],xi.prototype,"enableEdgeOffset",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],xi.prototype,"type",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],xi.prototype,"snappingManager",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],xi.prototype,"updating",null),(0,l._)([(0,p.Cb)()],xi.prototype,"automaticManipulatorSelection",void 0),xi=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],xi);var Si,Ci=i(7882),Oi=i(99346),Ei=i(80064);!function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(Si||(Si={}));var Zi=function(){function e(t){var i=this;(0,n.Z)(this,e),this.mode=null,this._handles=new k.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new qe.Z,this.getFocused=function(){return i.ringManipulator.focused},this.getScale=function(){return(0,c.pC)(i._scaleRotateDragData)&&"scale"===i._scaleRotateDragData.mode?i.adapter.scale:1},this.tool=t.tool,this.mode=t.mode,this.adapter=t.adapter,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return(0,r.Z)(e,[{key:"angle",get:function(){return this.adapter.angle}},{key:"scale",get:function(){return this.adapter.scale}},{key:"location",set:function(e){this.ringManipulator.location=e}},{key:"elevationAlignedLocation",set:function(e){this.ringManipulator.elevationAlignedLocation=e}},{key:"grabbing",get:function(){return this.ringManipulator.grabbing}},{key:"interactive",set:function(e){this.ringManipulator.interactive=e}},{key:"destroy",value:function(){(0,c.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,c.SC)(this._handles),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}},{key:"startAnimation",value:function(e){var t=this;this.cancelActiveAnimation(),e.start();var i=(0,Oi.A)({update:function(i){var a=i.deltaTime;e.update(a)&&t.cancelActiveAnimation()}});this._activeAnimation=(0,a.Z)((0,a.Z)({},e),{},{frameTask:i})}},{key:"cancelActiveAnimation",value:function(){(0,c.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,c.SC)(this._activeAnimation))}},{key:"forEachManipulator",value:function(e){e(this.ringManipulator,4)}},{key:"createManipulator",value:function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.ringManipulator,i=this.tool.graphicState.graphic,a=(0,Wt.Xd)(t,(function(t,a,n){e._scaleRotateDragData=null,e.adapter.restart();var r={mode:"none",origin:(0,M.a)(t.renderLocation),initialAngle:e.adapter.angle,angle:0,angleDir:0,scaleDir:0};e._scaleRotateDragData=r,e.updateDragState();var o=re.WM.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,o),a.next((0,It._N)(e.tool.view,(0,pi.Yq)(t.renderLocation,o,(0,pi.Ue)()))).next((function(t){var a=(0,pi.mJ)(t.plane),n=(0,yt.Gd)(t.renderStart,t.renderEnd,r.origin,a),o=Ei.Q4.shortestSignedDiff(r.angle,n);r.angleDir=(0,te.uZ)(r.angleDir+o,-.3,.3),r.angle=n;var s=function(e,t){var i=(0,_.f)(re.WM.get(),t.renderStart,e.origin),a=(0,_.f)(re.WM.get(),t.renderEnd,e.origin),n=(0,_.l)(i),r=(0,_.l)(a);return 0===n?0:r/n}(r,t),l=s-e.adapter.scale;if(r.scaleDir=(0,te.uZ)(r.scaleDir+l,-.2,.2),e.onScaleChanged(),"none"===r.mode){var u=e.mode||function(e,t,i,a){var n=e.renderStart,r=e.renderEnd,o=Gi(n,a,re.WM.get()),s=Gi(r,a,re.WM.get());if((0,_.h)(o,s)<100)return null;var l=(0,_.f)(re.WM.get(),n,i),u=(0,_.c)(re.WM.get(),l,(0,pi.mJ)(t)),c=n,h=(0,_.b)(re.WM.get(),c,u),p=Gi(i,a,re.WM.get()),d=o,f=Gi(h,a,re.WM.get()),v=(0,_.f)(re.WM.get(),f,d),g=(0,_.f)(re.WM.get(),o,p),y=(0,Z.re)(d,v),m=(0,Z.re)(p,g);return(0,Z.Jk)(y,s)<(0,Z.Jk)(m,s)?"rotate":"scale"}(t,t.plane,r.origin,e.tool.view.state.camera);if((0,c.pC)(u)){switch(u){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:i,angle:0}),e.tool.emit("record-undo",{record:e.adapter.createUndoRecord()});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:i,xScale:1,yScale:1}),e.tool.emit("record-undo",{record:e.adapter.createUndoRecord()})}r.mode=u}}switch(r.mode){case"rotate":e.adapter.angle=r.initialAngle+n;break;case"scale":e.adapter.scale=s,e.onScaleChanged()}switch(e.updateDragState(),e.updateManipulatorTransform(),t.action){case"start":case"update":switch(r.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:i,angle:(0,te.BV)(r.angle)});break;case"scale":e.tool.emit("graphic-scale",{graphic:i,xScale:s,yScale:s})}break;case"end":switch(r.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:i,angle:(0,te.BV)(r.angle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:i,xScale:s,yScale:s})}}"end"===t.action&&(e.startAnimation(Di(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState())})),n.next((function(){if(e.adapter.cancel(),(0,c.pC)(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:i,angle:0});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:i,xScale:1,yScale:1})}e.startAnimation(Di(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState()}}))}));this._handles.add(a),this._handles.add([this.ringManipulator.events.on("focus-changed",(function(t){"focus"===t.action?e.startAnimation(function(e,t){var i=0,a=null,n=function(){return!1};return{start:function(){a=e.getFocused,e.getFocused=n,i=0,t()},update:function(e){return i+=e,!a()||i>200?1:0},destroy:function(){e.getFocused=a,t()}}}(e,(function(){return e.updateDelayedFocusedState()}))):e.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(function(e){e.stopPropagation()})),(0,h.S1)(this.tool.graphicState,"displaying",(function(t){return e.ringManipulator.available=t}))])}},{key:"onScaleChanged",value:function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}},{key:"updateDelayedFocusedState",value:function(){this.ringManipulator.updateStateEnabled(Si.DelayedFocused,this.getFocused())}},{key:"updateDragState",value:function(){if(this.ringManipulator.updateStateEnabled(Si.Unlocked,!((0,c.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,c.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Si.ScaleIn|Si.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Si.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Si.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Si.RotateLeft|Si.RotateRight,!1),this.ringManipulator.updateStateEnabled(Si.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Si.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Si.ScaleIn|Si.ScaleOut|Si.RotateLeft|Si.RotateRight,!1)}},{key:"updateManipulatorTransform",value:function(){var e=(0,D.i)(re.MP.get()),t=this.adapter.angle;(0,D.e)(e,e,t,(0,M.f)(0,0,1));var i=this.getScale(),a=(0,D.w)(re.MP.get(),(0,_.s)(re.WM.get(),i,i,i)),n=(0,D.i)(re.MP.get());(0,D.m)(n,a,e),this.ringManipulator.modelTransform=n}},{key:"createRingManipulator",value:function(){for(var e=function(e,t,i){for(var a=[],n=Math.ceil(128*(t-e)/(2*Math.PI)),r=0;r<n+1;r++){var o=e+r*(t-e)/n;a.push((0,M.f)(i*Math.cos(o),i*Math.sin(o),0))}return a},t=function(t){return e(0,2*Math.PI,t)},i=function(e,t){return V.Z.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]]}(t),e,[],[],!1)},a=t(Pt),n=i(a,24),r={left:[],right:[]},o=[],s=0;s<2;s++){var l=s*Math.PI-Math.PI/4,u=Math.PI/2-zt,c=l+u,h=l+Math.PI/2-u,p=e(c,h,190),d=i(p,9);o.push(p),o.push(e(c,h,201)),r.left.push(d),r.right.push(d);for(var f=0;f<2;f++){var v=0===f,y=(0,A.c)();if(v){(0,D.f)(y,y,[1,-1,1]),(0,D.e)(y,y,-c,[0,0,1]);var m=Math.round(.2*(p.length-1));y[12]=p[m][0],y[13]=p[m][1],y[14]=p[m][2]}else{(0,D.e)(y,y,h,[0,0,1]);var _=Math.round(.8*(p.length-1));y[12]=p[_][0],y[13]=p[_][1],y[14]=p[_][2]}var b=V.Z.createExtrudedTriangle(60,0,23,.5);V.Z.transformInPlace(b,y),(v?r.left:r.right).push(b)}}for(var w=[],k=0;k<2;k++){var x=k*Math.PI-Math.PI/4,S=Math.PI/2-Tt,C=x+S,O=x+Math.PI/2-S,E=e(C,O,213);w.push(i(E,9))}var Z=t(190),G=t(213),R=i(Z,9),P=i(G,9),z=t(130),T=t(107),I=i(z,9),W=i(T,9),H=this.createMaterial(),L=this.createMaterial(.66),F=this.createMaterial(.5),U=this.createMaterial(.33),B=[{geometry:n,material:H,stateMask:Si.DelayedFocused},{geometry:n,material:F,stateMask:0}];this.mode&&"scale"!==this.mode||(B=B.concat([{geometry:w,material:H,stateMask:Si.DelayedFocused|Si.Unlocked},{geometry:R,material:L,stateMask:Si.DelayedFocused|Si.ScaleIn},{geometry:P,material:U,stateMask:Si.DelayedFocused|Si.ScaleIn},{geometry:I,material:L,stateMask:Si.DelayedFocused|Si.ScaleOut},{geometry:W,material:U,stateMask:Si.DelayedFocused|Si.ScaleOut}])),this.mode&&"rotate"!==this.mode||(B=B.concat([{geometry:r.right,material:H,stateMask:Si.DelayedFocused|Si.Unlocked},{geometry:r.left,material:H,stateMask:Si.DelayedFocused|Si.RotateLeft},{geometry:r.right,material:H,stateMask:Si.DelayedFocused|Si.RotateRight}]));var j=[a].concat(o);return new _t.Z({view:this.tool.view,renderObjects:B,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,g.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:j,direction:(0,M.f)(0,0,1)}})}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[].concat((0,ge.Z)(Dt),[e]);return new me.E({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{ringManipulator:this.ringManipulator}}}]),e}();function Gi(e,t,i){return t.projectToScreen(e,Ai),(0,_.s)(i,Ai[0],Ai[1],0)}function Di(e,t){var i=null,a=1,n=function(){return a};return{start:function(){a=e.getScale(),i=e.getScale,e.getScale=n,t()},update:function(e){return a+=((a+1)/2-a)*Math.min(3*e,1),t(),Math.abs(a-1)<.01?1:0},destroy:function(){e.getScale=i,t()}}}var Ai=(0,q.s1)(),Ri=i(94172),Pi=i(45238);function zi(e){return(0,c.pC)(e.geometry)&&"mesh"===e.geometry.type?function(e){return(0,c.pC)(e.transform)?function(e,t){var i=t.clone(),a=null;return{undo:function(t){a=(0,c.pC)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:function(t){i=(0,c.pC)(e.transform)?e.transform.clone():null,e.transform=a,t.notifyGeometryChanged()}}}(e,e.transform):function(e){var t,i=e.vertexAttributes.clonePositional();return{undo:function(a){t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,a.notifyGeometryChanged()},redo:function(a){i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,a.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){var t=e.geometry,i=c.YP;return{undo:function(e){i=e.geometry,e.geometry=t},redo:function(e){t=e.geometry,e.geometry=i}}}(e)}var Ti=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).angle=0,a.scale=1,a.initialAngle=0,a.previousAngle=0,a.previousScale=1,a}return(0,r.Z)(i,[{key:"initialize",value:function(){this.restart()}},{key:"restart",value:function(){var e=this;this.handles.remove(Vi);var t=this.geometry.transform;if(this.scale=1,(0,c.pC)(t)){var i=(0,Pi.ZZ)(t.rotation)[2];Math.abs(i)>.999999&&(this.angle=(0,te.Vl)((0,Pi.EU)(t.rotation))*Math.sign(i))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add((0,Ri.Ym)((function(){return{angle:e.angle,scale:e.scale}}),(function(t){return e.update(t)}),Ri.Z_),Vi)}},{key:"cancel",value:function(){this.scale=1,this.angle=this.initialAngle}},{key:"createUndoRecord",value:function(){return zi(this.graphic)}},{key:"update",value:function(e){var t=e.scale,i=e.angle,a=this.geometry.anchor,n=1===this.viewingMode;t!==this.previousScale&&(this.geometry.scale(t/this.previousScale,{origin:a,geographic:n}),this.previousScale=t,this.graphic.notifyGeometryChanged()),i!==this.previousAngle&&(this.geometry.rotate(0,0,(0,te.BV)(i-this.previousAngle),{origin:a,geographic:n}),this.previousAngle=i,this.graphic.notifyGeometryChanged())}}]),i}(gt.r);(0,l._)([(0,p.Cb)({constructOnly:!0})],Ti.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Ti.prototype,"geometry",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Ti.prototype,"viewingMode",void 0),(0,l._)([(0,p.Cb)()],Ti.prototype,"angle",void 0),(0,l._)([(0,p.Cb)()],Ti.prototype,"scale",void 0),Ti=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Ti);var Vi="scale-heading-update-key",Ii=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).angle=0,a.scale=1,a.symbol=null,a.initialAngle=0,a}return(0,r.Z)(i,[{key:"initialize",value:function(){this.restart()}},{key:"restart",value:function(){var e=this;this.handles.remove(Wi);var t=(0,c.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:c.YP;if(this.symbol=(0,c.pC)(t)?t.clone():null,this.initialSizes=[],(0,c.pC)(t)){var i=this.findLayerView();(0,c.pC)(i)&&(this.initialSizes=t.symbolLayers.map((function(e){return"object"===e.type?i.getSymbolLayerSize(t,e):null})).toArray())}this.angle=0,(0,c.pC)(t)&&t.symbolLayers.some((function(t){return!("object"!==t.type||!(0,c.pC)(t.heading))&&(e.angle=-(0,te.Vl)(t.heading),!0)})),this.initialAngle=this.angle,this.scale=1,this.handles.add((0,Ri.Ym)((function(){return{angle:e.angle,scale:e.scale}}),(function(t){return e.updateSymbol(t)}),Ri.Z_),Wi)}},{key:"cancel",value:function(){this.graphic.symbol=this.symbol}},{key:"createUndoRecord",value:function(){var e=this,t=this.graphic.symbol,i=null;return{undo:function(a){i=a.symbol,a.symbol=t,e.restart()},redo:function(a){t=a.symbol,a.symbol=i,e.restart()}}}},{key:"updateSymbol",value:function(e){var t=this,i=e.scale,a=e.angle,n=this.graphic.symbol;if(!(0,c.Wi)(this.symbol)&&!(0,c.Wi)(n)&&"point-3d"===n.type){var r=n.clone(),o=-(0,te.BV)(a-this.initialAngle),s=!1;this.forEachObjectSymbolLayerPair(this.symbol,r,(function(e,a,n){var r=(0,c.Pt)(e.heading,0)+o;a.heading!==r&&(a.heading=r,s=!0);var l=t.initialSizes[n];if((0,c.pC)(l)&&"width"in l){l.width=t.sizeFilter(l.width),l.height=t.sizeFilter(l.height),l.depth=t.sizeFilter(l.depth);var u=l.width*i;a.width!==u&&(a.width=u,s=!0);var h=l.depth*i;a.depth!==h&&(a.depth=h,s=!0);var p=l.height*i;a.height!==p&&(a.height=p,s=!0)}})),s&&(this.graphic.symbol=r)}}},{key:"forEachObjectSymbolLayerPair",value:function(e,t,i){e.symbolLayers.forEach((function(e,a){var n=t.symbolLayers.getItemAt(a);"object"===e.type&&"object"===n.type&&i(e,n,a)}))}}]),i}(gt.r);(0,l._)([(0,p.Cb)()],Ii.prototype,"angle",void 0),(0,l._)([(0,p.Cb)()],Ii.prototype,"scale",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Ii.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)()],Ii.prototype,"symbol",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Ii.prototype,"findLayerView",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Ii.prototype,"sizeFilter",void 0),Ii=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Ii);var Wi="scale-heading-update-key",Hi=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).enableZ=!0,a.enableRotation=!0,a.enableScaling=!0,a.type="transform-3d",a.scaleRotate=null,a.snappingPipeline=new ai.n,a}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this;this.graphicState=new ct.F({graphic:this.graphic}),this.moveManipulation=new Yt({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&mt(this.graphic),radius:Yt.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((function(t){return e.handles.add(t.events.on("immediate-click",(function(t){e.emit("immediate-click",(0,a.Z)((0,a.Z)({},t),{},{graphic:e.graphicState.graphic})),t.stopPropagation()})))})),this.moveManipulation.elevationInfo=(0,g.RL)(this.graphic);var t=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline((function(i,a,n,r,o){return(0,c.pC)(t)&&0===i&&(n=n.next(e.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new ii.N({elevationInfo:(0,g.RL)(e.graphic),pointer:o,editGeometryOperations:ti.c.fromGeometry(new Ci.Z({spatialReference:t.spatialReference}),e.view.state.viewingMode),visualizer:new ke,excludeFeature:e.graphic}),snappingManager:e.snappingManager,updatingHandles:e.updatingHandles,cancel:r}),e.snappingPipeline.next)),n}),this.graphicState,(function(t){var i=t.action,a={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(i){case"start":e.emit("graphic-translate-start",a),e.emit("record-undo",{record:e.createGeometryUndoRecord()});break;case"update":e.emit("graphic-translate",a);break;case"end":e.emit("graphic-translate-stop",a)}})),this.moveManipulation.angle=(0,c.pC)(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this.createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",(function(){return e.updateMoveAngle()}))),this.enableScaling||this.enableRotation){var i=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new Zi({tool:this,mode:i,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",(function(){return e.onScaleChanged()})))}this.handles.add([Gt({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return(0,u.kB)()}}),this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(function(){return e.updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged(),this.updateMoveAngle(),this.forEachManipulator((function(t){t instanceof _t.Z&&e.handles.add(t.events.on("grab-changed",(function(){return e.updateManipulatorsInteractive()})))})),this.complete()}},{key:"updateManipulatorsInteractive",value:function(){(0,c.Wi)(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)}},{key:"createScaleRotateAdapter",value:function(){var e=this;return(0,c.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Ti({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Ii({graphic:this.graphic,sizeFilter:function(t){return e.enforceNonZeroSize(t)},findLayerView:function(){return e.view.allLayerViews.find((function(t){return t.layer===e.graphic.layer}))}})}},{key:"forEachManipulator",value:function(e){this.moveManipulation.forEachManipulator(e),(0,c.pC)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}},{key:"hideManipulatorsForGraphicState",value:function(){var e=this;return this.graphicState.watch("displaying",(function(t){e.forEachManipulator((function(e){return e.available=t})),e.moveManipulation.zManipulation.available=t&&e.enableZ&&mt(e.graphic)}))}},{key:"createGeometryUndoRecord",value:function(){return zi(this.graphic)}},{key:"destroy",value:function(){this.moveManipulation.destroy(),this.scaleRotate=(0,c.SC)(this.scaleRotate),this.scaleRotateAdapter=(0,c.SC)(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}},{key:"snapToScene",set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"location",set:function(e){this.moveManipulation.location=e,(0,c.pC)(this.scaleRotate)&&(this.scaleRotate.location=e)}},{key:"elevationAlignedLocation",set:function(e){this.moveManipulation.elevationAlignedLocation=e,(0,c.pC)(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=e)}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){(0,c.pC)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onHide",value:function(){(0,c.pC)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onScaleChanged",value:function(){if(!(0,c.Wi)(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}}},{key:"updateMoveAngle",value:function(){2===this.view.state.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0}},{key:"onGeometryChanged",value:function(){(0,yt.u2)(this.view,this,this.graphic)}},{key:"enforceNonZeroSize",value:function(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}},{key:"test",get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,c.pC)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}}]),i}((0,gt.p)(qe.Z.EventedMixin(ei.m)));(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],Hi.prototype,"view",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],Hi.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],Hi.prototype,"enableZ",void 0),(0,l._)([(0,p.Cb)()],Hi.prototype,"enableRotation",void 0),(0,l._)([(0,p.Cb)()],Hi.prototype,"enableScaling",void 0),(0,l._)([(0,p.Cb)({value:!1})],Hi.prototype,"snapToScene",null),(0,l._)([(0,p.Cb)({constructOnly:!0})],Hi.prototype,"snappingManager",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],Hi.prototype,"type",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],Hi.prototype,"updating",null),Hi=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Hi);var Li=i(68860),Fi=i(6394),Ui=i(82218),Bi=(i(59486),i(41644),i(32718)),ji=i(48976),qi=i(40927),Ni=((0,d.Z)("mac"),Math.cos((0,te.Vl)(45)),Math.cos((0,te.Vl)(5)),[1,.5,0]),Qi=([].concat(Ni,[.7]),[].concat(Ni,[.5]),[].concat(Ni,[1])),Yi=[1,1,1,1],Xi=[1,.8,.6,1],Ji=[1,.93,.86,1],Ki=[].concat(Ni,[1]),$i=[].concat(Ni,[1]),ea=40,ta=[].concat(Ni,[1]),ia=((0,A.c)(),i(33559)),aa=i(23620),na=i(56529),ra=i(64226),oa=i(22909),sa=i(41012),la=i(82144),ua=i(31132),ca=i(7566),ha=i(27627),pa=i(11316),da=i(36207),fa=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,n.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build();return new ha.$(e.rctx,t,ca.i)}},{key:"bindPass",value:function(e,t){(0,sa.II)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}},{key:"bindDraw",value:function(e){(0,sa.id)(this.program,e),this.program.rebindTextures()}},{key:"initializePipeline",value:function(){return(0,da.sm)({blending:(0,da.wK)(1,1,771,771),depthTest:{func:513},colorWrite:da.BK})}}]),i}(ua.A);fa.shader=new la.J(pa.S,(function(){return i.e(8492).then(i.bind(i,18492))}));na.F;var va=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).ensureTechnique(fa,null),a}return(0,r.Z)(i,[{key:"updateParameters",value:function(){return(0,c.Wg)(this.technique)}},{key:"beginSlot",value:function(){return(0,c.Wg)(this.technique)}},{key:"bind",value:function(e,t){t.bindPass(this._material.parameters,e)}}]),i}(aa.Z),ga=(0,a.Z)({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},na.z);i(78952),i(92183),i(23470);Math.pow(2,50);(0,M.c)();(0,M.c)();var ya=i(81703),ma=i(94425),_a=i(40485),Ma=i(78041),ba=i(33280),wa=i(15226),ka=i(50411),xa=i(32500),Sa=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,n.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get(),a=this.configuration,n=t.build({output:a.output,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===a.transparencyPassType,multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround});return new ha.$(e.rctx,n,ca.i)}},{key:"bindPass",value:function(e,t){(0,sa.II)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("opacity",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,wa.p)(this.program,t))}},{key:"bindDraw",value:function(e){(0,sa.id)(this.program,e),(0,ba.DA)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e,t){var i=this.configuration,a=3===e,n=2===e;return(0,da.sm)({blending:0!==i.output&&7!==i.output||!i.transparent?null:a?Ca:(0,Ma.$L)(e),culling:(0,da.zp)(i.cullFace),depthTest:{func:(0,Ma.$x)(e)},depthWrite:a?i.writeDepth&&da.LZ:(0,Ma.Vc)(e),colorWrite:da.BK,stencilWrite:i.sceneHasOcludees?ka.s3:null,stencilTest:i.sceneHasOcludees?t?ka.eD:ka.RY:null,polygonOffset:a||n?null:(0,Ma.je)(i.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,b.Z)((0,w.Z)(i.prototype),"getPipelineState",this).call(this,e,t)}}]),i}(ua.A);Sa.shader=new la.J(xa.I,(function(){return i.e(8957).then(i.bind(i,18957))}));var Ca=(0,da.if)(1,771),Oa=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,r.Z)(i)}(ia.m);(0,l._)([(0,ia.o)({count:8})],Oa.prototype,"output",void 0),(0,l._)([(0,ia.o)({count:3})],Oa.prototype,"cullFace",void 0),(0,l._)([(0,ia.o)()],Oa.prototype,"slicePlaneEnabled",void 0),(0,l._)([(0,ia.o)()],Oa.prototype,"transparent",void 0),(0,l._)([(0,ia.o)()],Oa.prototype,"enableOffset",void 0),(0,l._)([(0,ia.o)()],Oa.prototype,"writeDepth",void 0),(0,l._)([(0,ia.o)()],Oa.prototype,"sceneHasOcludees",void 0),(0,l._)([(0,ia.o)({count:4})],Oa.prototype,"transparencyPassType",void 0),(0,l._)([(0,ia.o)()],Oa.prototype,"multipassTerrainEnabled",void 0),(0,l._)([(0,ia.o)()],Oa.prototype,"cullAboveGround",void 0);var Ea,Za=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e,Da)).supportsEdges=!0,a.techniqueConfig=new Oa,a}return(0,r.Z)(i,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<Ma.ve,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,i,a,n,r,o){(0,oa.Bw)(e,t,a,n,r,void 0,o)}},{key:"requiresSlot",value:function(e,t){return 20===e||(4===(0,ma.S)(t)?2===e:e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2))}},{key:"createGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new Ga(e):void 0}},{key:"createBufferWriter",value:function(){return new ra.G_(ra.W1)}}]),i}(na.F),Ga=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){return(0,n.Z)(this,i),t.call(this,(0,a.Z)((0,a.Z)({},e),e.material.parameters))}return(0,r.Z)(i,[{key:"updateParameters",value:function(e){var t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(Sa,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&(this._material.setParameters({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}},{key:"beginSlot",value:function(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}]),i}(_a.Z),Da=(0,a.Z)({transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0},na.z),Aa=i(99196),Ra=i(67123),Pa=i(84652),za=i(89125),Ta=i(66576),Va=Ea=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).type="plane",a.position=null,a.heading=0,a.tilt=0,a.width=10,a.height=10,a}return(0,r.Z)(i,[{key:"clone",value:function(){return new Ea({position:(0,Pa.d9)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}},{key:"equals",value:function(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,c._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}}]),i}(Ra.wq);(0,l._)([(0,p.Cb)({readOnly:!0,json:{read:!1,write:!0}})],Va.prototype,"type",void 0),(0,l._)([(0,p.Cb)({type:Ci.Z}),(0,Ta.B)()],Va.prototype,"position",void 0),(0,l._)([(0,p.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Ta.B)(),(0,za.p)((function(e){return Ei.LU.normalize((0,f.q9)(e),0,!0)}))],Va.prototype,"heading",void 0),(0,l._)([(0,p.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Ta.B)(),(0,za.p)((function(e){return Ei.LU.normalize((0,f.q9)(e),0,!0)}))],Va.prototype,"tilt",void 0),(0,l._)([(0,p.Cb)({type:Number,nonNullable:!0}),(0,Ta.B)()],Va.prototype,"width",void 0),(0,l._)([(0,p.Cb)({type:Number,nonNullable:!0}),(0,Ta.B)()],Va.prototype,"height",void 0),Va=Ea=(0,l._)([(0,v.j)("esri.widgets.Slice.SlicePlane")],Va);i(53866),Bi.Z.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Ia(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:(0,_.b)(re.WM.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:(0,_.b)(re.WM.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:(0,_.f)(re.WM.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:(0,_.f)(re.WM.get(),e.origin,e.basis2),edge:t}}}function Wa(e){var t=(0,_.l)(e.basis1),i=(0,_.l)(e.basis2);return.3*Math.min(t,i)}function Ha(e){return Wa(e)}function La(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Fa(e,t){var i=La(t),a=i?[(0,M.f)(1,0,0),(0,M.f)(0,0,0),(0,M.f)(0,1,0)]:[(0,M.f)(1,0,0),(0,M.f)(-1,0,0)],n=V.Z.createPolylineGeometry(a),r=ta,o=i?4:1,s=2*o,l=function(e){return e>1?function(e){return new I.U({color:r,width:e,renderOccluded:4})}(e):new Aa.Y({color:r,renderOccluded:4})},u=[{geometry:n,material:l(o),stateMask:1|Xa},{geometry:n,material:l(s),stateMask:2|Xa},{geometry:n,material:l(1),stateMask:Ja}],c=new _t.Z({view:e,renderObjects:u,collisionType:{type:"line",paths:[a]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4});return c.state=Xa,c}function Ua(e,t,i){var a=function(a){var n=(a?t:e).slice(0),r=(0,_.f)(re.WM.get(),n[0],n[1]);(0,_.n)(r,r);var o=(0,_.f)(re.WM.get(),n[n.length-1],n[n.length-2]);if((0,_.n)(o,o),i.padding>0){var s=(0,_.a)((0,M.c)(),o,-i.padding);if(n[n.length-1]=(0,_.b)(s,s,n[n.length-1]),i.bothEnds){var l=(0,_.a)((0,M.c)(),r,-i.padding);n[0]=(0,_.b)(l,l,n[0])}}var u=a?i.tipFocusMultiplier:1,h=i.tipLength*(i.focusTipLength?u:1),p=i.tipRadius*u,d=(0,D.i)(re.MP.get());if(i.padding>0){var f=h/4,v=(0,_.s)(re.WM.get(),0,f,0),g=1+i.padding/f;(0,D.a)(d,d,v),(0,D.f)(d,d,(0,_.s)(re.WM.get(),g,g,g)),(0,D.a)(d,d,(0,_.a)(v,v,-1/g))}var y=(0,D.i)((0,A.c)()),m=(0,M.f)(0,1,0),b=(0,D.g)((0,A.c)(),(0,ji.r)(re.vD.get(),m,o));b[12]=n[n.length-1][0],b[13]=n[n.length-1][1],b[14]=n[n.length-1][2],(0,D.m)(b,b,d);var w,k,x=[{part:"tube",geometry:Ba(i.tubeRadius*(a?i.tubeFocusMultiplier:1)+i.padding,i.flat,n),transform:y}];if((0,c.pC)(i.flat)?w=V.Z.createExtrudedTriangle(h,p,p,i.flat.thickness):(w=V.Z.createConeGeometry(h,p,24,!1,!1,!0),k=V.Z.createConeGeometry(h,p,24,!1,!0,!1)),x.push({part:"tip",geometry:w,transform:b}),k&&x.push({part:"cap",geometry:k,transform:b}),i.bothEnds){var S=(0,D.g)((0,A.c)(),(0,ji.r)(re.vD.get(),m,r));S[12]=n[0][0],S[13]=n[0][1],S[14]=n[0][2],(0,D.m)(S,S,d),x.push({part:"tip",geometry:w,transform:S}),k&&x.push({part:"cap",geometry:k,transform:S})}return x};return{normal:a(!1),focused:a(!0)}}function Ba(e,t,i){var a=[];if((0,c.pC)(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(var n=0;n<12;n++){var r=n/12*2*Math.PI;a.push([Math.cos(r)*e,Math.sin(r)*e])}return V.Z.createPathExtrusionGeometry(a,i,[],[],!1)}function ja(e,t){var i=(0,_.f)((0,M.c)(),e[e.length-1],e[e.length-2]);if((0,_.n)(i,i),(0,_.a)(i,i,12),(0,_.b)(i,i,e[e.length-1]),t){var a=(0,_.f)((0,M.c)(),e[0],e[1]);return(0,_.n)(a,a),(0,_.a)(a,a,12),(0,_.b)(a,a,e[0]),[a].concat((0,ge.Z)(e),[i])}return[].concat((0,ge.Z)(e),[i])}function qa(e,t){return(0,qi.cp)(t,e.basis2,e.basis1)+Ya}var Na=16,Qa=32,Ya=((0,Z.Ue)(),Math.PI/2),Xa=16,Ja=32;var Ka="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACuFBMVEUAAAD/AAD/gAD/VQD/gAD/bQD/gAD/cQD/gAD/dAD/eAD/gAD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fQD/gAD/fQD/fQD/egD/fQD/gAD/fQD/ewD/fQD/gAD/gAD/fQD/gAD/fAD/fgD/fgD/fAD/fgD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fQD/fgD/fgD/fQD/fgD/fgD/fQD/fgD/fQD/fQD/fgD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fgD/gAL/fgD/gAb/gAT/gwr/gQj/hA7/hAz/hxH/iBP/ixn/iRf/jBz/jR7/jyP/kCX/kyr/lS7/lCz/li//mTT/mTf/nDr/mjn/nTz/n0H/nT//oET/oEL/okf/oEX/o0r/pU3/o0v/pU//qFL/plH/qFX/qFP/qVb/q1n/rV3/rFz/rmD/rl7/sGL/rmH/tW3/s2v/tW//tW7/t3L/tnD/uHT/unb/unn/unf/vHv/vX3/v4D/vX7/w4n/xY3/xIv/x4//xY3/x5H/yZP/x5H/yJP/y5f/yZX/zZv/y5n/zZ3/zJv/z5//z6D/z6H/0aT/0KP/0qb/06j/1av/06r/1q3/1q//17H/2rb/2rb/2rj/3bz/4MH/38D/38H/4sX/4MT/48f/4sb/4sf/5Mr/5s3/5cz/5s3/59D/59D/6dT/6dP/6dT/6tb/6tX/6tf/69n/69j/7dr/7Nn/7dz/7dv/7t3/7t7/7t3/7+H/8eL/8uX/8eP/8+j/8+f/9On/8+j/9Or/9ez/9e3/9ez/9e3/9+//9+7/+PD/9+//+PH/+PD/+fL/+PH/+fT/+vX/+fT/+vb/+vX/+/b/+vb/+/j/+/j//Pr//Pn//fv//v3//vz//fz//fv//v3//fz//////v7//v3///9vf1WOAAAA53RSTlMAAQIDBgcICQoLERIYGRobKCkqKywtLzAxMjM4OTo+P0BAQUVGR0hPUFFSUlNUWlthYmNlZmdoamtvcHR1dnd4eXx9f4CAgYGCgoODhIWGhoeIiYqLjIyNjo+QkJGSkpOTlJSVlpaXmJiZmZqbnJydnZ6eoqKjo6Skpaanp6ipqqqvsLCxsbKzs7S1tbe3uLi5uru8vL2+wMDBwsTGx8jLzc3O0NDR0dLT1dXW19ja2tvc3N3e3t/f4ODh4uLl5ufn6urr6+zt7u7v8PDx8fLy8/P09fX29vf3+Pn6+vv8/Pz8/f3+/v7EBDCzAAADmklEQVR42qXXd3sUVRQG8BNDKkU3KLYUIFkLLBo0yRJNBszuuwQlGISIDUTFhljAhhUbtlXEYEcjoEJUNCqKPXZUUCDU0FvI+RpkZpa5c9iZzMzD7+/d88yde+95z5CbvIIhIyqrtbo6rboyUlKQR4GcGI7GIMSi4QHkU1bRKDgaVZRF3nKGanClDc4hD4Nq0CvtzAzqRd8L4GlkX3IVGg0fxpxMzjLOgk9hx2VkRuBbJNPh/+cjpQnezkuvcC6Q8vVseItkkKTWP6Pr17HwVkbCQFg+YJ4P3U0vtrS1t//c9u6zM+DgFLH/av+m7Gfe1IhpLf+ysmbxVBxrdD4ptvPzDvdY2trNUvfytBLlZDkdloZt3GPvPk5z8K0EpFMpJacWlmTqmdnBd1dBqMkm01BY4n+waTsb1nd0drHl/2kQSsiQpcHyKKd0MP/YfOt4AJfPWtTOKRumw04z+0MRlNV81PezoNz5JZv+boRdIemisMxkS+ck2M3rZMPHskcZ/Q/KR6y8D2HqWjbMh11/IgrDfoiU7lsgXGNW6GgQB1quYPrClk9+WnuITash3WGWfw02VUR5MUCKX3n7w8m3P1z121xIzazbMg5KLJcK4Ntl5vV4EDYhGgz/XmDdcnmWRsC/iQeM1wibYVSBAL5g3WQoF9JFCOBN1t0PpZo0BDCPdU9BqaU6BPAA65JQLglWYDbrFooCGgJ4jHXPiSUEeokvse4hKNXBtnEF624W2xiBf/GN3GP3pVCG0xAIE57+9h64uZd1bbApFpcpMXfFLuaVcLOKdS/DJiSu87UHucfhOb0+wIEmeZ0pCqWVdX+Nh5MJ61i3BDaVsqVhphkCnyaQrt68SYdvhE0pEQ2AzRI2LBuX3k1a2fAe7PoRyTU0/seGb66ANPkHNqxpEG1dBIvhvkNs2PLMWCiJ5FY27LlbBouMNsOTXWz6p/lqmK57fR2buh+HjDYVrsqCLhWmK5cuXvbZBhUVzzuGK+XUwO6J3exs5yMQLs6mlNMg3PY7O/nlBkiDyDISQv2CHXysrckEpHI5ZEmTXpUzyp+vTOx1yHLIp/icN74y927z54vuiiNNiISwc5hNub6pHoo8xNI5CCSS4T5sw/ewLZ1wNnwbnklOyuBPrJRcnKTBhzEDyVV+OTyV5x/fZ98Z5CG7RIOr2pJs8tanMApH0cI+5FP/sqoYhFhVaT8KJDdUHKkwP/8rhhWHct1+dwRTps/cplDIpwAAAABJRU5ErkJggg==",$a={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};var en=function(){function e(){(0,n.Z)(this,e),this.lastDragEvent=null,this.next=new Wt.hM,this._enabled=!1}return(0,r.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(0,c.pC)(this.lastDragEvent)){var t=(0,a.Z)((0,a.Z)({},this.lastDragEvent),{},{action:"update"});e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;return this.lastDragEvent=null,function(t){return e.lastDragEvent="end"!==t.action?(0,a.Z)({},t):null,e._enabled&&e.adjustScaleFactors(t),t}}},{key:"adjustScaleFactors",value:function(e){var t=La(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}},{key:"test",get:function(){var e=this;return{adjustScaleFactors:function(t){return e.adjustScaleFactors(t)}}}}]),e}(),tn=i(254),an=i(12225),nn=i(29014),rn=i(34778);function on(e,t){return ln(e,t,!1)}function sn(e,t){return ln(e,t,!0)}function ln(e,t,i){if(e instanceof rn.y){if(e.operation instanceof tn.z)return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-1:1,a=(0,M.f)(i*e.dx,i*e.dy,i*e.dz);(0,_.b)(t.origin,t.origin,a)}(e.operation,t,i),!0;if(e.operation instanceof an.S)return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-e.angle:e.angle;(0,_.G)(t.basis1,t.basis1,M.Z,i),(0,_.G)(t.basis2,t.basis2,M.Z,i)}(e.operation,t,i),!0;if(e.operation instanceof nn.q)return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=i?1/e.factor1:e.factor1,n=i?1/e.factor2:e.factor2;(0,_.a)(t.basis1,t.basis1,a),(0,_.a)(t.basis2,t.basis2,n),(0,N.q)(t.origin,t.origin,e.origin,e.axis1,a),(0,N.q)(t.origin,t.origin,e.origin,e.axis2,n)}(e.operation,t,i),!0}return!1}var un=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).enableZ=!0,a.enableRotation=!0,a.enableScaling=!0,a._preserveAspectRatio=new en,a.grabbing=!1,a.inputState=null,a.type="transform-3d",a.handles=new k.Z,a.moveZManipulator=null,a.resizeManipulators=null,a.rotateManipulator=null,a.attachmentOrigin=null,a.outlineVisualElement=null,a.mapBounds=(0,Ui.c)(),a.mapBoundsStart=(0,Ui.c)(),a.displayBounds=(0,Ui.c)(),a.displayBoundsStart=(0,Ui.c)(),a.displayBoundsMarginStart=0,a.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],a}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this;this.graphicState=new ct.F({graphic:this.graphic});var t=this.graphic.geometry;this.editGeometryOperations=ti.c.fromGeometry(t,this.view.state.viewingMode),this.graphicMoveManipulation=new Kt({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this.createMoveXYGraphicDragPipeline()),this.moveZManipulator=function(e){var t=0===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)?ea:0,i=[(0,M.f)(t,0,-24),(0,M.f)(t,0,24)],a=ja(i,!0),n=function(e,t){return Ua(i,i,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t})},r=n(0,!1),o=n(2.25,!0),s=new me.E({color:Yi,cullFace:2,renderOccluded:16}),l=new me.E({color:Xi,cullFace:2,renderOccluded:16}),u=new me.E({color:Ji,cullFace:2,renderOccluded:16}),c=new me.E({color:$i,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),h=V.Z.createPolylineGeometry([[t,0,0],[t-ea,0,0]]),p=V.Z.createPolylineGeometry([[t,0,0],[t-ea,0,0]]),d=new Aa.Y({color:Ki,renderOccluded:4});return new _t.Z({view:e,renderObjects:[].concat((0,ge.Z)(r.normal.map((function(e){var t=e.part,i=e.geometry,a=e.transform;return{geometry:i,material:"tip"===t?s:"cap"===t?l:u,transform:a,stateMask:1|Na}}))),(0,ge.Z)(o.normal.map((function(e){var t=e.geometry,i=e.transform;return{geometry:t,material:c,transform:i,stateMask:1|Na}}))),[{geometry:h,material:d,stateMask:1|Na|Qa}],(0,ge.Z)(r.focused.map((function(e){var t=e.part,i=e.geometry,a=e.transform;return{geometry:i,material:"tip"===t?s:"cap"===t?l:u,transform:a,stateMask:2|Na}}))),(0,ge.Z)(o.focused.map((function(e){var t=e.geometry,i=e.transform;return{geometry:t,material:c,transform:i,stateMask:2|Na}}))),[{geometry:p,material:d,stateMask:2|Na|Qa}]),autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[a]},collisionPriority:1,radius:11,state:Na})}(this.view,0),this.moveZManipulator.state|=Qa,this.handles.add(this.watch("enableZ",(function(){return e.updateManipulatorAvailability(e.moveZManipulator,0)}))),this.handles.add(this.createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((function(t){var i=Fa(e.view,t);return e.handles.add(e.watch("enableScaling",(function(){return e.updateManipulatorAvailability(i,2)}))),i.events.on("grab-changed",(function(t){return e.onResizeGrab(t)})),e.handles.add(e.createResizeDragPipeline(i,t)),i})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=function(e){return e.fromData(Ka,(function(){return new ce.x(Ka,$a)}))}(this.view.toolViewManager.textures),this.rotateManipulator=function(e,t){var i=new Za({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),a=40,n=27*1.1,r=function(e){var t=new Uint32Array([0,1,2,2,3,0]);return new ye.Z([["position",{size:3,data:[a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},o=V.Z.createPolylineGeometry([[0,0,0],[13,0,0]]),s=V.Z.createPolylineGeometry([[0,0,0],[a-n,0,0]]),l=new Aa.Y({color:Qi,renderOccluded:4}),u=[{geometry:r(27),material:i,stateMask:1|Na},{geometry:o,material:l,stateMask:1|Na},{geometry:r(n),material:i,stateMask:2|Na},{geometry:s,material:l,stateMask:2|Na}];return new _t.Z({view:e,renderObjects:u,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},collisionPriority:1,radius:13.5,state:Na})}(this.view,this.rotateManipulatorTexture.texture),this.handles.add(this.watch("enableRotation",(function(){return e.updateManipulatorAvailability(e.rotateManipulator,3)}))),this.rotateManipulator.events.on("grab-changed",(function(t){e.onRotateGrab(t)})),this.handles.add(this.createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds();var i=Gt({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return(0,u.kB)()}});(0,c.pC)(i)&&(this.outlineVisualElement=i.visualElement instanceof tt?i.visualElement:null),(0,c.pC)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(function(){return e.updateDisplayBounds()}))),this.handles.add(i),this.handles.add([this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.graphicState.watch("displaying",(function(){return e.updateAllManipulatorAvailability()})),(0,h.S1)(this.graphicState,"isDraped",(function(){return e.graphicDrapedChanged()})),this.view.trackGraphicState(this.graphicState)]);var n=this.view.pointsOfInterest;n&&this.handles.add(n.centerOnSurfaceFrequent.watch("location",(function(){return e.updateDisplayBounds()})));this.forEachManipulator((function(t){e.handles.add(t.events.on("grab-changed",(function(){e.grabbing=t.grabbing,e.updateAllManipulatorAvailability()})))}));this.forEachManipulator((function(t,i){e.handles.add(t.events.on("immediate-click",(function(t){1===i&&e.emit("immediate-click",(0,a.Z)((0,a.Z)({},t),{},{graphic:e.graphic})),t.stopPropagation()})))})),this.onGeometryChanged(),this.updateAllManipulatorAvailability(),this.complete()}},{key:"graphicDrapedChanged",value:function(){var e=this;this.handles.remove(cn),this.updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(function(t){(0,c.pC)(e.attachmentOrigin)&&(0,St.jE)(t.extent,e.attachmentOrigin.x,e.attachmentOrigin.y)&&e.updateDisplayBounds()})),cn)}},{key:"updateAllManipulatorAvailability",value:function(){var e=this;this.forEachManipulator((function(t,i){return e.updateManipulatorAvailability(t,i)}))}},{key:"updateManipulatorAvailability",value:function(e,t){var i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof _t.Z){var a=this.graphicState.displaying,n=this.enableZ&&mt(this.graphic);switch(t){case 3:e.available=a&&this.enableRotation;break;case 2:e.available=a&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Xa:Ja;break;case 0:e.available=a&&n;break;default:e.available=a}}}},{key:"forEachManipulator",value:function(e){this.graphicMoveManipulation.forEachManipulator(e),this.resizeManipulators.forEach((function(t){return e(t,2)})),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}},{key:"destroy",value:function(){this.rotateManipulatorTexture.release(),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._set("view",null),this._set("graphic",null)}},{key:"preserveAspectRatio",get:function(){return this._preserveAspectRatio.enabled},set:function(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){this.mapBounds=null,this.displayBounds=null}},{key:"onGeometryChanged",value:function(){this.updateDisplayBounds()}},{key:"calculateMapBounds",value:function(){var e=this.graphic.geometry,t=this.editGeometryOperations.data,i=t.components[0].edges[0],a=(0,N.f)(re.qW.get(),i.leftVertex.pos,i.rightVertex.pos);(0,N.i)(a,a);var n=(0,c.Pt)((0,yt.du)(this.view,this.graphic),e.extent.center),r=pn*this.view.pixelSizeAt(n),o=this.view.spatialReference;o!==e.spatialReference&&(r*=(0,Li.c9)(o)/(0,Li.c9)(e.spatialReference)),function(e,t,i,a){a||(a=(0,Ui.c)());var n=(0,N.s)(re.qW.get(),e[1],-e[0]),r=(0,N.s)(re.qW.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=(0,N.s)(re.qW.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),s=re.qW.get();t.components.forEach((function(t){return t.vertices.forEach((function(t){var i=t.pos;(0,N.s)(s,(0,N.k)(e,i),(0,N.k)(n,i)),(0,N.x)(r,r,s),(0,N.y)(o,o,s)}))}));var l=1e-6,u=(0,N.s)(re.qW.get(),o[0]-r[0]<l?i/2:0,o[1]-r[1]<l?i/2:0);(0,N.f)(r,r,u),(0,N.m)(o,o,u),(0,N.g)(a.basis1,e,(o[0]-r[0])/2),(0,N.g)(a.basis2,n,(o[1]-r[1])/2),(0,N.s)(a.origin,r[0]*e[0]+r[1]*n[0],r[0]*e[1]+r[1]*n[1]),(0,N.m)(a.origin,a.origin,a.basis1),(0,N.m)(a.origin,a.origin,a.basis2)}(a,t,r,this.mapBounds)}},{key:"updateDisplayBounds",value:function(){var e=this.graphic.geometry;if(!(0,c.Wi)(e)){var t=(0,c.pC)(this.outlineVisualElement)&&!this.graphicState.isDraped&&(0,c.pC)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:(0,yt.du)(this.view,this.graphic);this.attachmentOrigin=(0,c.Pt)(t,e.extent.center);var i=(0,c.pC)(t)?t.z:(0,se.w7)(this.mapBounds.origin,this.view.elevationProvider,le.o.fromElevationInfo((0,g.RL)(this.graphic)),this.view.renderCoordsHelper),a=(0,Ui.a)(this.mapBounds);a.origin[2]=i,function(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;n||(n=(0,Ui.c)()),t.toRenderCoords(e.origin,i,n.origin);var r=re.WM.get();(0,_.b)(r,e.origin,e.basis1),(0,_.b)(r,r,e.basis2),t.toRenderCoords(r,i,r);var o=re.WM.get();(0,_.b)(o,e.origin,e.basis1),(0,_.f)(o,o,e.basis2),t.toRenderCoords(o,i,o);var s=re.WM.get();(0,_.f)(s,e.origin,e.basis1),(0,_.f)(s,s,e.basis2),t.toRenderCoords(s,i,s);var l=re.WM.get();(0,_.f)(l,e.origin,e.basis1),(0,_.b)(l,l,e.basis2),t.toRenderCoords(l,i,l);var u=(0,_.e)(re.WM.get(),r,o,.5);(0,_.f)(u,u,n.origin);var c=(0,_.e)(re.WM.get(),s,l,.5);(0,_.f)(c,n.origin,c),(0,_.e)(n.basis1,u,c,.5);var h=(0,_.e)(re.WM.get(),l,r,.5);(0,_.f)(h,h,n.origin);var p=(0,_.e)(re.WM.get(),o,s,.5);(0,_.f)(p,n.origin,p),(0,_.e)(n.basis2,h,p,.5);var d=(0,_.c)(re.WM.get(),n.basis1,n.basis2),f=(0,_.c)(d,d,n.basis1);(0,_.n)(f,f),(0,_.a)(n.basis2,f,(0,_.d)(n.basis2,f)),(0,_.a)(n.basis1,n.basis1,1+a/(0,_.l)(n.basis1)),(0,_.a)(n.basis2,n.basis2,1+a/(0,_.l)(n.basis2)),(0,Ui.u)(n)}(a,this.view.renderCoordsHelper,e.spatialReference,this.displayBoundsMargin,this.displayBounds),this.updateManipulators()}}},{key:"displayBoundsMargin",get:function(){var e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return hn*this.view.pixelSizeAt(t)}},{key:"createMoveXYGraphicDragPipeline",value:function(){var e=this;return this.graphicMoveManipulation.createDragPipeline((function(t,i,a){return e.applyGraphicMoveSteps(i,a)}))}},{key:"createMoveZDragPipeline",value:function(){var e=this,t=this.view,i=this.editGeometryOperations.data.spatialReference;return(0,Wt.Xd)(this.moveZManipulator,(function(a,n,r){var o=(0,M.a)(a.renderLocation),s=n.next((0,It.Sp)(t,o,i)).next((0,Wt.zh)());e.applyGraphicMoveSteps(s,r)}))}},{key:"applyGraphicMoveSteps",value:function(e,t){var i=this,a=e.next((function(e){return"start"===e.action&&(i.inputState={type:"move"},(0,Ui.a)(i.mapBounds,i.mapBoundsStart),i.emit("graphic-translate-start",{graphic:i.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e})).next((0,Wt.AN)()).next(this.moveDragUpdateGeometry()).next((function(e){var t={graphic:i.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&i.emit("graphic-translate",t);break;case"end":i.inputState=null,i.emit("graphic-translate-stop",t)}return e}));return t.next((function(){(0,c.pC)(i.inputState)&&i.emit("graphic-translate-stop",{graphic:i.graphic,dxScreen:0,dyScreen:0}),i.cancel()})),a}},{key:"moveDragUpdateGeometry",value:function(){var e=this;return function(t){if((0,c.Wi)(e.inputState)||"move"!==e.inputState.type)return t;var i,a=[],n=(0,je.Z)(e.editGeometryOperations.data.components);try{for(n.s();!(i=n.n()).done;){var r=i.value;a.push.apply(a,(0,ge.Z)(r.vertices))}}catch(s){n.e(s)}finally{n.f()}var o="start"===t.action?0:1;return on(e.editGeometryOperations.moveVertices(a,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,o),e.mapBounds),e.graphic.geometry=e.editGeometryOperations.data.geometry,t}}},{key:"onResizeGrab",value:function(e){if("start"===e.action){var t=this.calculatePickRay(e.screenPoint);(0,pi.BR)(this.displayBounds.plane,t,re.WM.get())&&((0,Ui.a)(this.displayBounds,this.displayBoundsStart),(0,Ui.a)(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}}},{key:"createResizeDragPipeline",value:function(e,t){var i=this;return(0,Wt.Xd)(e,(function(e,n,r){(0,c.Wi)(i.inputState)||(n.next((function(e){return"start"===e.action&&i.emit("graphic-scale-start",{graphic:i.graphic,xScale:1,yScale:1}),e})).next((0,It._N)(i.view,i.displayBoundsStart.plane)).next((function(e){return(0,a.Z)((0,a.Z)({},e),{},{handle:t})})).next(i.resizeDragRenderPlaneToFactors()).next(i._preserveAspectRatio.createDragEventPipelineStep(),i._preserveAspectRatio.next).next(i.resizeDragUpdateGeometry()).next((function(e){var t={graphic:i.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":i.emit("graphic-scale",t);break;case"end":i.inputState=null,i.emit("graphic-scale-stop",t)}return e})),r.next((function(){(0,c.pC)(i.inputState)&&i.emit("graphic-scale-stop",{graphic:i.graphic,xScale:1,yScale:1}),i.cancel()})))}))}},{key:"resizeDragRenderPlaneToFactors",value:function(){var e=this;return function(t){var i=e.displayBoundsStart,n=t.handle.direction,r=e.displayBoundsMargin,o=e.displayBoundsMarginStart,s=(0,_.g)(re.WM.get(),i.origin);(0,_.F)(s,s,i.basis1,-n[0]),(0,_.F)(s,s,i.basis2,-n[1]);var l=(0,_.f)(re.WM.get(),t.renderEnd,s),u=(0,_.f)(re.WM.get(),t.renderStart,s),c=La(t.handle),h=Ha(i),p=Ha(e.displayBounds)/h,d=function(e,t){if(0===e)return 1;var i=(0,_.l)(t),a=.5*e*(0,_.d)(t,l)/i,n=a<0?-1:1;c&&(a+=(i-.5*e*(0,_.d)(t,u)/i)*n*p);var s=i<1.5*o?1:dn;return i=Math.max(i-o,dn),n>0&&(a-=r),n*Math.max(n*(a/i),s)};return(0,a.Z)((0,a.Z)({},t),{},{factor1:d(n[0],i.basis1),factor2:d(n[1],i.basis2)})}}},{key:"resizeDragUpdateGeometry",value:function(){var e=this;return function(t){var i=(0,_.g)((0,M.c)(),e.mapBoundsStart.origin);(0,_.F)(i,i,e.mapBoundsStart.basis1,-t.handle.direction[0]),(0,_.F)(i,i,e.mapBoundsStart.basis2,-t.handle.direction[1]);var a=(0,N.s)((0,Fi.a)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);(0,N.i)(a,a);var n,r=[],o=(0,je.Z)(e.editGeometryOperations.data.components);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.push.apply(r,(0,ge.Z)(s.vertices))}}catch(c){o.e(c)}finally{o.f()}var l="start"===t.action?0:1,u=e.editGeometryOperations.scaleVertices(r,i,a,t.factor1,t.factor2,l,1);return(0,Ui.a)(e.mapBoundsStart,e.mapBounds),on(u,e.mapBounds),e.graphic.geometry=e.editGeometryOperations.data.geometry,t}}},{key:"onRotateGrab",value:function(e){if("start"===e.action){var t=function(e,t,i,a){var n=t.worldUpAtPosition(e.origin,re.WM.get()),r=re.WM.get();switch(i){case 1:(0,_.g)(r,n);break;case 2:(0,_.g)(r,e.basis1)}return(0,pi.Yq)(e.origin,r,a)}(this.displayBounds,this.view.renderCoordsHelper,1,(0,pi.Ue)()),i=this.calculatePickRay(e.screenPoint);(0,pi.BR)(t,i,re.WM.get())&&((0,Ui.a)(this.displayBounds,this.displayBoundsStart),(0,Ui.a)(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}}},{key:"createRotateDragPipeline",value:function(e){var t=this;return(0,Wt.Xd)(e,(function(e,i,a){var n=t.inputState;(0,c.Wi)(n)||(i.next((function(e){return"start"===e.action&&t.emit("graphic-rotate-start",{graphic:t.graphic,angle:0}),e})).next((0,It._N)(t.view,n.rotatePlane)).next(t.rotateDragRenderPlaneToRotate(n)).next(t.rotateDragUpdateGeometry()).next((function(e){var i={graphic:t.graphic,angle:(0,te.BV)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",i);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",i)}return e})),a.next((function(){(0,c.pC)(t.inputState)&&t.emit("graphic-rotate-stop",{graphic:t.graphic,angle:0}),t.cancel()})))}))}},{key:"rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(i){var n=(0,pi.mJ)(e.rotatePlane),r=(0,yt.Gd)(i.renderStart,i.renderEnd,t.displayBounds.origin,n);return(0,a.Z)((0,a.Z)({},i),{},{rotateAxis:n,rotateAngle:r})}}},{key:"rotateDragUpdateGeometry",value:function(){var e=this;return function(t){var i,a=(0,_.g)((0,M.c)(),e.mapBoundsStart.origin),n=[],r=(0,je.Z)(e.editGeometryOperations.data.components);try{for(r.s();!(i=r.n()).done;){var o=i.value;n.push.apply(n,(0,ge.Z)(o.vertices))}}catch(u){r.e(u)}finally{r.f()}var s="start"===t.action?0:1,l=e.editGeometryOperations.rotateVertices(n,a,t.rotateAngle,s,1);return(0,Ui.a)(e.mapBoundsStart,e.mapBounds),on(l,e.mapBounds),e.graphic.geometry=e.editGeometryOperations.data.geometry,t}}},{key:"calculatePickRay",value:function(e){var t=(0,Z.Ue)(),i=(0,q.md)(e);return(0,ya.u4)(this.view.state.camera,i,t),(0,_.n)(t.direction,t.direction),t}},{key:"updateManipulators",value:function(){var e=this;if(this.visible){var t=function(e,t){return(0,yt.Aq)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,re.MP.get());(function(e,t,i,a){var n=a.worldUpAtPosition(i.origin,re.WM.get()),r=Ia(i,0),o=(0,D.i)(re.MP.get());(0,D.r)(o,o,r.edge*Math.PI/2),(0,D.d)(o,o,-qa(i,n)),(0,D.m)(o,t,o),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=r.position})(this.rotateManipulator,t,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,t),this.resizeManipulators.forEach((function(i,a){!function(e,t,i,a){var n=(0,_.l)(a.basis1),r=(0,_.l)(a.basis2),o=Wa(a),s=Ha(a),l=(0,_.s)(re.WM.get(),0,0,0);(0,_.b)(l,(0,_.a)(re.WM.get(),a.basis1,t.direction[0]),(0,_.a)(re.WM.get(),a.basis2,t.direction[1])),(0,_.b)(l,a.origin,l);var u=0,c=1;if(La(t))1===t.direction[0]&&-1===t.direction[1]?u=Ya:1===t.direction[0]&&1===t.direction[1]?u=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(u=3*Math.PI/2),c=s;else{var h=0!==t.direction[0]?1:2;u=1===h?Ya:0,c=(1===h?r:n)-o}var p=(0,D.i)(re.MP.get());(0,D.r)(p,p,u),(0,D.f)(p,p,(0,_.s)(re.WM.get(),c,c,c)),(0,D.m)(p,i,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=l}(i,e.resizeHandles[a],t,e.displayBounds)}))}}},{key:"updateZMoveHandle",value:function(e,t){var i=this.displayBounds,a={basis:i.basis1,direction:-1,position:(0,_.f)(re.WM.get(),i.origin,i.basis1),edge:2},n=re.MP.get();(0,D.r)(n,t,a.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=a.position}},{key:"cancel",value:function(){var e=this.editGeometryOperations.lastOperation;(0,c.Wi)(e)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,sn(e,this.mapBounds),this.updateDisplayBounds(),this.inputState=null)}},{key:"canUndo",get:function(){return this.editGeometryOperations.canUndo}},{key:"undo",value:function(){if((0,c.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){var e=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,sn((0,c.Wg)(e),this.mapBounds),this.updateDisplayBounds()}}},{key:"canRedo",get:function(){return this.editGeometryOperations.canRedo}},{key:"redo",value:function(){if(this.canRedo){var e=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,on((0,c.Wg)(e),this.mapBounds),this.updateDisplayBounds()}}},{key:"test",get:function(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}}]),i}(qe.Z.EventedMixin(ei.m));(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],un.prototype,"view",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],un.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],un.prototype,"enableZ",void 0),(0,l._)([(0,p.Cb)()],un.prototype,"enableRotation",void 0),(0,l._)([(0,p.Cb)()],un.prototype,"enableScaling",void 0),(0,l._)([(0,p.Cb)()],un.prototype,"preserveAspectRatio",null),(0,l._)([(0,p.Cb)()],un.prototype,"grabbing",void 0),(0,l._)([(0,p.Cb)()],un.prototype,"inputState",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],un.prototype,"type",void 0),un=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],un);var cn="draped-elevation-changes",hn=10,pn=80,dn=1e-6},89215:function(e,t,i){i.d(t,{T:function(){return I},I:function(){return L}});var a=i(1413),n=i(15671),r=i(43144),o=i(60136),s=i(29388),l=i(27366),u=i(52639),c=(i(93169),i(91505)),h=i(41691),p=i(42537),d=i(92026),f=i(49861),v=i(63780),g=(i(25243),i(69912)),y=i(93655),m=(i(59486),i(84652)),_=i(68860),M=i(42137),b=i(2170),w=i(69662),k=i(92975),x=i(3826),S=i(77577),C=i(7882),O=i(29909),E=i(80885);function Z(e,t){var i=new C.Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function G(e,t){return new S.Z({points:e,spatialReference:t})}function D(e,t,i){var a=new O.Z({paths:e,spatialReference:t});return i&&(0,w.nc)(a),a}function A(e,t,i){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=(0,m.d9)(e);n.forEach((function(e){var t=e[0],i=e[e.length-1];(0,v.fS)(t,i)&&1!==e.length||e.push(e[0])}));var r=new E.Z({rings:n,spatialReference:t});return r.rings.forEach((function(e){(0,w.bu)(e,!1,!1)||e.reverse()})),i&&(0,w.nc)(r),a&&r.isSelfIntersecting&&(0,k.JY)(t)&&(r=(0,b.simplify)(r)),r}function R(e,t,i){var a=t.mapToLocalMultiple(e),n=[],r={x:a[0].x,y:a[0].y},o=a[1].x,s=a[1].y,l=Math.round(o-r.x),u=Math.round(s-r.y),c=Math.max(Math.abs(l),Math.abs(u));if(i){var h={x:r.x+c,y:r.y+c},p={x:r.x-c,y:r.y-c};n.push((0,x.Q8)(h.x,p.y),(0,x.Q8)(p.x,p.y),(0,x.Q8)(p.x,h.y),(0,x.Q8)(h.x,h.y))}else{var f={x:l>0?r.x+c:r.x-c,y:u>0?r.y+c:r.y-c};n.push((0,x.Q8)(r.x,r.y),(0,x.Q8)(f.x,r.y),(0,x.Q8)(f.x,f.y),(0,x.Q8)(r.x,f.y))}return A([(0,d.lV)(n.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function P(e,t,i){var a=t.mapToLocalMultiple(e);if(1===a.length){var n=48,r=a[0];a=[(0,x.Q8)(r.x-n,r.y+n),(0,x.Q8)(r.x+n,r.y-n),(0,x.Q8)(r.x+n,r.y-n),(0,x.Q8)(r.x-n,r.y+n)]}var o=[],s={x:a[0].x,y:a[0].y},l={x:a[1].x,y:a[1].y};if(i){var u=Math.round(l.x-s.x),c=Math.round(l.y-s.y);o.push((0,x.Q8)(s.x-u,s.y-c),(0,x.Q8)(l.x,s.y-c),(0,x.Q8)(l.x,l.y),(0,x.Q8)(s.x-u,l.y))}else o.push((0,x.Q8)(s.x,s.y),(0,x.Q8)(l.x,s.y),(0,x.Q8)(l.x,l.y),(0,x.Q8)(s.x,l.y));return A([(0,d.lV)(o.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function z(e,t,i,a){var n=t.mapToLocalMultiple(e),r=null,o=null;if(i)r=n[0],o=n[1];else{var s=n[0],l=n[1],u=Math.round(l.x-s.x),c=Math.round(l.y-s.y),h=Math.max(Math.abs(u),Math.abs(c));r=(0,x.Q8)(u>0?s.x+h/2:s.x-h/2,c>0?s.y+h/2:s.y-h/2),o=(0,x.Q8)(Math.abs(u)>Math.abs(c)?r.x-h/2:r.x,Math.abs(u)>Math.abs(c)?r.y:r.y-h/2)}var p=t.localToMap(r),f=t.localToMap(o);if((0,d.Wi)(p)||(0,d.Wi)(f))return null;t.doUnnormalization&&(0,w.Sq)([[p,f]],t.spatialReference);var v=Z(p,t.spatialReference),g=Z(f,t.spatialReference),y=(0,_.c9)(t.spatialReference),m=0;if((0,k.JY)(t.spatialReference))m=y*(0,b.distance)(v,g,null);else{var S=r.x-o.x,C=r.y-o.y;m=y*Math.sqrt(S*S+C*C)*(a||1)}var O=new M.Z({center:v,radius:m,radiusUnit:"meters",spatialReference:t.spatialReference});return A(O.rings,O.spatialReference,!1)}function T(e,t,i){for(var a=t.mapToLocalMultiple(e),n=a[0],r=a[1],o=Math.round(r.x-n.x),s=Math.round(r.y-n.y),l=(0,x.Q8)(i?n.x:n.x+o/2,i?n.y:n.y+s/2),u=i?o:o/2,c=i?s:s/2,h=[],p=2*Math.PI/60,f=0;f<60;f++){var v=Math.cos(f*p),g=Math.sin(f*p),y=(0,x.Q8)(u*v+l.x,c*g+l.y);h.push(y)}return h.push(h[0]),A([(0,d.lV)(h.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!1)}var V=i(45900),I=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e))._graphic=null,a.defaultZ=0,a.geometryType=null,a.hasZ=!0,a.mode=null,a.snappingManager=null,a.snapToScene=!1,a}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this;this.internalGraphicsLayer=new y.Z({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)}))]),this.complete()}},{key:"destroy",value:function(){this.drawOperation=(0,d.SC)(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,d.SC)(this.internalGraphicsLayer),this._set("view",null)}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"centered",set:function(e){this._set("centered",e),this._updateGraphic()}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"forceUniformSize",set:function(e){this._set("forceUniformSize",e),this._updateGraphic()}},{key:"graphic",get:function(){return this._graphic}},{key:"graphicSymbol",set:function(e){this._set("graphicSymbol",e),(0,d.pC)(this._graphic)&&(this._graphic.symbol=e)}},{key:"updating",get:function(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"reset",value:function(){}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"_createGraphic",value:function(e){var t=this;this._graphic=new u.Z({geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add((0,p.kB)((function(){(0,d.pC)(t._graphic)&&(t.internalGraphicsLayer.remove(t._graphic),t._graphic=(0,d.SC)(t._graphic))})),W)}},{key:"_destroyAllVisualisations",value:function(){this.handles.remove(H.outline),this.handles.remove(H.regularVertices),this.handles.remove(H.activeVertex),this.handles.remove(W)}},{key:"_getCreateOperationGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;var t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,a=i.slice();(0,d.pC)(t)&&a.push(this.drawOperation.coordinateHelper.pointToArray(t));var n=(0,d.pC)(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],r={regularVertices:null,activeVertex:null,full:null,outline:null},o=a.length,s=this.drawOperation.spatialReference,l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":r.regularVertices=i,r.activeVertex=n,r.full=this.drawOperation.coordinateHelper.arrayToPoint(a[0]);break;case"multipoint":r.regularVertices=i,r.activeVertex=n,o>0&&(r.full=G(a,s));break;case"polyline":r.regularVertices=i,r.activeVertex=n,o>0&&(r.full=D([a],s,l));break;case"polygon":r.regularVertices=i,r.activeVertex=n,o>0&&(r.full=A([a],s,l,!0));break;case"circle":if(o>0){var u=(0,x.Gn)(this.view,a[0]);if(1===o&&e.operationComplete){var c=a[0],h=u.makeMapPoint(c[0]+F*this.view.resolution,c[1]);r.full=z([c,h],u,!0)}else 2===o&&(r.full=this.forceUniformSize?z(a,u,this.centered):T(a,u,this.centered))}break;case"rectangle":if(o>0){var p=(0,x.Gn)(this.view,a[0]);if(1===o&&e.operationComplete){var f=a[0],v=p.makeMapPoint(f[0]+F*this.view.resolution,f[1]);r.full=R([f,v],p,!0)}else 2===o&&(r.full=this.forceUniformSize?R(a,p,this.centered):P(a,p,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":o>1&&(r.outline=D([a],s,l));break;case"circle":case"rectangle":(0,d.pC)(r.full)&&"polygon"===r.full.type&&(r.outline=A(r.full.rings,s,l))}return r}},{key:"initializeGraphic",value:function(e){return null}},{key:"onComplete",value:function(e){this._updateGraphic();var t=null;if(this.drawOperation.isCompleted){var i=this._getCreateOperationGeometry({operationComplete:!0});(0,d.pC)(i)&&(t=new u.Z((0,a.Z)({geometry:i.full,symbol:this.graphicSymbol,sourceLayer:this.internalGraphicsLayer},this.graphicProperties)))}this.emit("complete",(0,a.Z)({graphic:t},e))}},{key:"onCursorUpdate",value:function(e){this._updateGraphic(),this.emit("cursor-update",e)}},{key:"onDeactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"onVertexAdd",value:function(e){this._updateGraphic(),this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this._updateGraphic(),this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this._updateGraphic(),this.emit("vertex-update",e)}},{key:"_updateGraphic",value:function(){var e=this._getCreateOperationGeometry();(0,d.Wi)(e)?this._destroyAllVisualisations():((0,d.pC)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),H.outline):this.handles.remove(H.outline),(0,d.pC)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),H.regularVertices):this.handles.remove(H.regularVertices),(0,d.pC)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),H.activeVertex):this.handles.remove(H.activeVertex),(0,d.pC)(e.full)?(0,d.Wi)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(W))}}]),i}((0,h.p)(c.Z.EventedMixin(V.m)));(0,l._)([(0,f.Cb)({value:!0})],I.prototype,"centered",null),(0,l._)([(0,f.Cb)({nonNullable:!0})],I.prototype,"defaultZ",void 0),(0,l._)([(0,f.Cb)()],I.prototype,"drawOperation",void 0),(0,l._)([(0,f.Cb)({value:!0})],I.prototype,"enabled",null),(0,l._)([(0,f.Cb)({value:!0})],I.prototype,"forceUniformSize",null),(0,l._)([(0,f.Cb)({constructOnly:!0})],I.prototype,"geometryType",void 0),(0,l._)([(0,f.Cb)()],I.prototype,"graphic",null),(0,l._)([(0,f.Cb)({constructOnly:!0})],I.prototype,"graphicProperties",void 0),(0,l._)([(0,f.Cb)()],I.prototype,"graphicSymbol",null),(0,l._)([(0,f.Cb)({constructOnly:!0})],I.prototype,"hasZ",void 0),(0,l._)([(0,f.Cb)({constructOnly:!0})],I.prototype,"mode",void 0),(0,l._)([(0,f.Cb)()],I.prototype,"snappingManager",void 0),(0,l._)([(0,f.Cb)()],I.prototype,"snapToScene",void 0),(0,l._)([(0,f.Cb)({readOnly:!0})],I.prototype,"type",void 0),(0,l._)([(0,f.Cb)({readOnly:!0})],I.prototype,"updating",null),(0,l._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],I.prototype,"view",void 0),I=(0,l._)([(0,g.j)("esri.views.draw.DrawGraphicTool")],I);var W="create-operation-graphic",H={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function L(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}var F=48},2346:function(e,t,i){i.d(t,{L:function(){return w}});var a=i(15671),n=i(43144),r=i(60136),o=i(29388),s=i(27366),l=i(85015),u=i(91505),c=i(92026),h=i(17842),p=i(49861),d=(i(63780),i(93169),i(25243),i(69912)),f=i(88396),v=i(11186),g=i(71353),y=i(60176),m=i(74509),_=i(61574),M=i(64575),b=i(45008),w=function(e){(0,r.Z)(i,e);var t=(0,o.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).layer=null,n.interactive=!0,n.selectable=!1,n.grabbable=!0,n.dragging=!1,n.cursor=null,n.events=new u.Z.EventEmitter,n._circleCollisionCache=null,n._graphicSymbolChangedHandle=null,n._originalSymbol=null,n}return(0,n.Z)(i,[{key:"graphic",set:function(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}},{key:"elevationInfo",get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=(0,m.vu)(this.graphic),i=e?e.offset:0;return new M.Z({mode:t,offset:i})}},{key:"focusedSymbol",set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}},{key:"hovering",set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}},{key:"selected",set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}},{key:"destroy",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.graphic;if(!1===t.visible)return null;var i=t.geometry;if((0,c.Wi)(i))return null;var a=this._get("focusedSymbol"),n=(0,c.pC)(a)?a:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,n):this._intersectDistance3D(this.view,e,t)}},{key:"attach",value:function(){this.attachSymbolChanged(),(0,c.pC)(this.layer)&&this.layer.add(this.graphic)}},{key:"detach",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,c.pC)(this.layer)&&this.layer.remove(this.graphic)}},{key:"attachSymbolChanged",value:function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){(0,c.pC)(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&(0,c.pC)(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)}},{key:"detachSymbolChanged",value:function(){(0,c.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}},{key:"_updateGraphicSymbol",value:function(){this.graphic.symbol=this._focused&&(0,c.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}},{key:"_resetGraphicSymbol",value:function(){this.graphic.symbol=this._originalSymbol}},{key:"_intersectDistance2D",value:function(e,t,i,a){if(a=a||(0,_.js)(i),(0,c.Wi)(a))return null;var n=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==a.type)return(0,b.D)(t,i,e)?1:null;if((0,c.Wi)(n)||!n.originalPoint.equals(i)){var r=i,o=e.spatialReference;if((0,y.Up)(r.spatialReference,o)){var s=(0,y.iV)(r,o);n={originalPoint:r.clone(),mapPoint:s,radiusPx:(0,h.F2)(a.size)},this._circleCollisionCache=n}}if((0,c.pC)(n)){var l=(0,h.md)(t,x),u=e.toScreen(n.mapPoint),p=n.radiusPx,d=u.x+(0,h.F2)(a.xoffset),v=u.y-(0,h.F2)(a.yoffset);return(0,f.a)(l,[d,v])<p*p?1:null}return null}},{key:"_intersectDistance3D",value:function(e,t,i){var a=e.toMap(t,{include:[i]});return a&&(0,y.KC)(a,k,e.renderSpatialReference)?(0,v.i)(k,e.state.camera.eye):null}}]),i}(l.Z);(0,s._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],w.prototype,"graphic",null),(0,s._)([(0,p.Cb)({readOnly:!0})],w.prototype,"elevationInfo",null),(0,s._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],w.prototype,"view",void 0),(0,s._)([(0,p.Cb)({value:null})],w.prototype,"focusedSymbol",null),(0,s._)([(0,p.Cb)({constructOnly:!0})],w.prototype,"layer",void 0),(0,s._)([(0,p.Cb)()],w.prototype,"interactive",void 0),(0,s._)([(0,p.Cb)()],w.prototype,"selectable",void 0),(0,s._)([(0,p.Cb)()],w.prototype,"grabbable",void 0),(0,s._)([(0,p.Cb)({value:!1})],w.prototype,"grabbing",null),(0,s._)([(0,p.Cb)()],w.prototype,"dragging",void 0),(0,s._)([(0,p.Cb)()],w.prototype,"hovering",null),(0,s._)([(0,p.Cb)({value:!1})],w.prototype,"selected",null),(0,s._)([(0,p.Cb)()],w.prototype,"cursor",void 0),w=(0,s._)([(0,d.j)("esri.views.interactive.GraphicManipulator")],w);var k=(0,g.c)(),x=(0,h.s1)()}}]);
//# sourceMappingURL=1771.7f5198db.chunk.js.map